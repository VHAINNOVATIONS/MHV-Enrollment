KIDS Distribution saved on Oct 29, 2014@16:56:07
DG*5.3*903 Sprint 2
**KIDS**:DG*5.3*903^

**INSTALL NAME**
DG*5.3*903
"BLD",9062,0)
DG*5.3*903^REGISTRATION^0^3141029^y
"BLD",9062,1,0)
^^27^27^3141007^^
"BLD",9062,1,1,0)
Increase Enrollment in My HealtheVet (IEMHV)
"BLD",9062,1,2,0)
 
"BLD",9062,1,3,0)
This patch contains enhancements to Pre-Registration functionality in the
"BLD",9062,1,4,0)
Preregister a Patient [DGPRE PRE-REGISTER] option in the VistA
"BLD",9062,1,5,0)
Registration V.5.3 package to increase patient enrollment in My 
"BLD",9062,1,6,0)
HealtheVet.
"BLD",9062,1,7,0)
 
"BLD",9062,1,8,0)
My HealtheVet Enrollment Alert/Reminder
"BLD",9062,1,9,0)
---------------------------------------
"BLD",9062,1,10,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"BLD",9062,1,11,0)
to display a message alerting the clerk that the selected patient 
"BLD",9062,1,12,0)
has neither completed My HealtheVet enrollment, nor documented their 
"BLD",9062,1,13,0)
desire to be excluded from My HealtheVet enrollment. Recent assistance 
"BLD",9062,1,14,0)
provided by Pre-Registration clerks with the patient's My HealtheVet
"BLD",9062,1,15,0)
enrollment is displayed within the alert/reminder.
"BLD",9062,1,16,0)
 
"BLD",9062,1,17,0)
Socialization Questions and Responses
"BLD",9062,1,18,0)
-------------------------------------
"BLD",9062,1,19,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"BLD",9062,1,20,0)
to capture a patient's My HealtheVet enrollment status during the 
"BLD",9062,1,21,0)
pre-registration process.
"BLD",9062,1,22,0)
 
"BLD",9062,1,23,0)
My HealtheVet Enrollment Actions
"BLD",9062,1,24,0)
--------------------------------
"BLD",9062,1,25,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"BLD",9062,1,26,0)
to capture actions Pre-Registration clerks performed to assist with a
"BLD",9062,1,27,0)
patient's My HealtheVet enrollment.
"BLD",9062,4,0)
^9.64PA^390.04^5
"BLD",9062,4,2,0)
2
"BLD",9062,4,2,2,0)
^9.641^2.0537042^5
"BLD",9062,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",9062,4,2,2,2,1,0)
^9.6411^537038^10
"BLD",9062,4,2,2,2,1,537027,0)
MHV ENROLLED
"BLD",9062,4,2,2,2,1,537028,0)
MHV AUTHENTICATED
"BLD",9062,4,2,2,2,1,537029,0)
MHV SECURE MESSAGING
"BLD",9062,4,2,2,2,1,537030,0)
MHVEN UPDATE DATE/TIME
"BLD",9062,4,2,2,2,1,537031,0)
MHVAUTH UPDATE DATE/TIME
"BLD",9062,4,2,2,2,1,537032,0)
MHVSM UPDATE DATE/TIME
"BLD",9062,4,2,2,2,1,537033,0)
MHV ENROLL DECLINED TEXT
"BLD",9062,4,2,2,2,1,537034,0)
MHV AUTH DECLINED TEXT
"BLD",9062,4,2,2,2,1,537035,0)
MHV MSG DECLINED TEXT
"BLD",9062,4,2,2,2,1,537038,0)
MHV MSG DECLINED REASON
"BLD",9062,4,2,2,2.0537026,0)
MHV SOCIALIZATION  (sub-file)
"BLD",9062,4,2,2,2.0537026,1,0)
^9.6411^1^2
"BLD",9062,4,2,2,2.0537026,1,.01,0)
SOCIALIZATION DATE
"BLD",9062,4,2,2,2.0537026,1,1,0)
SOCIALIZATION RESPONSE
"BLD",9062,4,2,2,2.0537041,0)
MHV MSG ACTIONS  (sub-file)
"BLD",9062,4,2,2,2.0537041,1,0)
^9.6411^.01^1
"BLD",9062,4,2,2,2.0537041,1,.01,0)
MHV MSG ACTIONS
"BLD",9062,4,2,2,2.0537042,0)
MHV AUTH ACTIONS  (sub-file)
"BLD",9062,4,2,2,2.0537042,1,0)
^9.6411^.01^1
"BLD",9062,4,2,2,2.0537042,1,.01,0)
MHV AUTH ACTIONS
"BLD",9062,4,2,2,2.5370262,0)
SOCIALIZATION ACTIONS  (sub-file)
"BLD",9062,4,2,2,2.5370262,1,0)
^9.6411^.01^1
"BLD",9062,4,2,2,2.5370262,1,.01,0)
SOCIALIZATION ACTIONS
"BLD",9062,4,2,222)
y^y^p^^^^n^^n
"BLD",9062,4,2,224)

"BLD",9062,4,390.01,0)
390.01
"BLD",9062,4,390.01,222)
y^y^f^^n^^y^o^n
"BLD",9062,4,390.01,224)

"BLD",9062,4,390.02,0)
390.02
"BLD",9062,4,390.02,222)
y^y^f^^n^^y^o^n
"BLD",9062,4,390.03,0)
390.03
"BLD",9062,4,390.03,222)
y^n^f^^n^^y^o^n
"BLD",9062,4,390.04,0)
390.04
"BLD",9062,4,390.04,222)
y^y^f^^n^^y^o^n
"BLD",9062,4,"APDD",2,2)

"BLD",9062,4,"APDD",2,2,537027)

"BLD",9062,4,"APDD",2,2,537028)

"BLD",9062,4,"APDD",2,2,537029)

"BLD",9062,4,"APDD",2,2,537030)

"BLD",9062,4,"APDD",2,2,537031)

"BLD",9062,4,"APDD",2,2,537032)

"BLD",9062,4,"APDD",2,2,537033)

"BLD",9062,4,"APDD",2,2,537034)

"BLD",9062,4,"APDD",2,2,537035)

"BLD",9062,4,"APDD",2,2,537038)

"BLD",9062,4,"APDD",2,2.0537026)

"BLD",9062,4,"APDD",2,2.0537026,.01)

"BLD",9062,4,"APDD",2,2.0537026,1)

"BLD",9062,4,"APDD",2,2.0537041)

"BLD",9062,4,"APDD",2,2.0537041,.01)

"BLD",9062,4,"APDD",2,2.0537042)

"BLD",9062,4,"APDD",2,2.0537042,.01)

"BLD",9062,4,"APDD",2,2.5370262)

"BLD",9062,4,"APDD",2,2.5370262,.01)

"BLD",9062,4,"B",2,2)

"BLD",9062,4,"B",390.01,390.01)

"BLD",9062,4,"B",390.02,390.02)

"BLD",9062,4,"B",390.03,390.03)

"BLD",9062,4,"B",390.04,390.04)

"BLD",9062,6.3)
26
"BLD",9062,"ABPKG")
n
"BLD",9062,"KRN",0)
^9.67PA^779.2^20
"BLD",9062,"KRN",.4,0)
.4
"BLD",9062,"KRN",.401,0)
.401
"BLD",9062,"KRN",.402,0)
.402
"BLD",9062,"KRN",.403,0)
.403
"BLD",9062,"KRN",.5,0)
.5
"BLD",9062,"KRN",.84,0)
.84
"BLD",9062,"KRN",3.6,0)
3.6
"BLD",9062,"KRN",3.8,0)
3.8
"BLD",9062,"KRN",9.2,0)
9.2
"BLD",9062,"KRN",9.8,0)
9.8
"BLD",9062,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",9062,"KRN",9.8,"NM",1,0)
DGMHV^^0^B109645277
"BLD",9062,"KRN",9.8,"NM",2,0)
DGPREP1^^0^B37209454
"BLD",9062,"KRN",9.8,"NM",3,0)
DGMHVAC^^0^B125835256
"BLD",9062,"KRN",9.8,"NM",4,0)
DGMHVUTL^^0^B13845318
"BLD",9062,"KRN",9.8,"NM","B","DGMHV",1)

"BLD",9062,"KRN",9.8,"NM","B","DGMHVAC",3)

"BLD",9062,"KRN",9.8,"NM","B","DGMHVUTL",4)

"BLD",9062,"KRN",9.8,"NM","B","DGPREP1",2)

"BLD",9062,"KRN",19,0)
19
"BLD",9062,"KRN",19.1,0)
19.1
"BLD",9062,"KRN",101,0)
101
"BLD",9062,"KRN",409.61,0)
409.61
"BLD",9062,"KRN",771,0)
771
"BLD",9062,"KRN",779.2,0)
779.2
"BLD",9062,"KRN",870,0)
870
"BLD",9062,"KRN",8989.51,0)
8989.51
"BLD",9062,"KRN",8989.52,0)
8989.52
"BLD",9062,"KRN",8994,0)
8994
"BLD",9062,"KRN","B",.4,.4)

"BLD",9062,"KRN","B",.401,.401)

"BLD",9062,"KRN","B",.402,.402)

"BLD",9062,"KRN","B",.403,.403)

"BLD",9062,"KRN","B",.5,.5)

"BLD",9062,"KRN","B",.84,.84)

"BLD",9062,"KRN","B",3.6,3.6)

"BLD",9062,"KRN","B",3.8,3.8)

"BLD",9062,"KRN","B",9.2,9.2)

"BLD",9062,"KRN","B",9.8,9.8)

"BLD",9062,"KRN","B",19,19)

"BLD",9062,"KRN","B",19.1,19.1)

"BLD",9062,"KRN","B",101,101)

"BLD",9062,"KRN","B",409.61,409.61)

"BLD",9062,"KRN","B",771,771)

"BLD",9062,"KRN","B",779.2,779.2)

"BLD",9062,"KRN","B",870,870)

"BLD",9062,"KRN","B",8989.51,8989.51)

"BLD",9062,"KRN","B",8989.52,8989.52)

"BLD",9062,"KRN","B",8994,8994)

"BLD",9062,"QUES",0)
^9.62^^
"BLD",9062,"REQB",0)
^9.611^^
"DATA",390.01,1,0)
Yes - I am already enrolled.
"DATA",390.01,1,1)
1
"DATA",390.01,1,1,0)
^390.011^1^1
"DATA",390.01,1,1,1,0)
Yes - I am already enrolled.
"DATA",390.01,1,2,0)
^^4^4^3141027^
"DATA",390.01,1,2,1,0)
We are strongly encouraging patients to use My HealtheVet. 
"DATA",390.01,1,2,2,0)
With My HealtheVet you can refill prescriptions and track 
"DATA",390.01,1,2,3,0)
their delivery, view lab results, and communicate securely 
"DATA",390.01,1,2,4,0)
with your Health Care teams.
"DATA",390.01,1,3)
Yes - I am already enrolled.
"DATA",390.01,2,0)
Yes - I would like to enroll.
"DATA",390.01,2,1)
2
"DATA",390.01,2,2,0)
^390.12^4^4^3141027^^^^
"DATA",390.01,2,2,1,0)
We are strongly encouraging patients to enroll in My HealtheVet.  With My 
"DATA",390.01,2,2,2,0)
HealtheVet you can refill prescriptions and track their delivery, view 
"DATA",390.01,2,2,3,0)
lab results, and communicate securely with your Health Care teams.  Can 
"DATA",390.01,2,2,4,0)
we assist you in creating your account today?
"DATA",390.01,2,3)
Yes - I would like to enroll.
"DATA",390.01,2,4)
D ACTIONS^DGMHV(.DGMSACT,.ACTSEL,,"S")
"DATA",390.01,3,0)
Yes - But I do not want to enroll right now.
"DATA",390.01,3,1)
3
"DATA",390.01,3,2,0)
^^8^8^3141027^
"DATA",390.01,3,2,1,0)
We are strongly encouraging patients to enroll in My HealtheVet.  With My 
"DATA",390.01,3,2,2,0)
HealtheVet you can refill prescriptions and track their delivery, view 
"DATA",390.01,3,2,3,0)
lab results, and communicate securely with your health care teams.
"DATA",390.01,3,2,4,0)
 
"DATA",390.01,3,2,5,0)
I will give you some easy-to-follow instructions to take home and enroll
"DATA",390.01,3,2,6,0)
or I can schedule a time for you to enroll with a My HealtheVet assistant.
"DATA",390.01,3,2,7,0)
Once you have registered you will need to come back to the clinic to sign 
"DATA",390.01,3,2,8,0)
a Release of Information form.
"DATA",390.01,3,3)
Yes - But I do not want to enroll right now.
"DATA",390.01,3,4)
D ACTIONS^DGMHV(.DGMSACT,.ACTSEL,,"S")
"DATA",390.01,4,0)
No - No one has spoken to me/I don't know what MHV is.
"DATA",390.01,4,1)
4
"DATA",390.01,4,2,0)
^390.12^5^5^3141023^^^^
"DATA",390.01,4,2,1,0)
We are strongly encouraging patients to enroll in My HealtheVet.  With My 
"DATA",390.01,4,2,2,0)
HealtheVet you can refill prescriptions and track their delivery, view 
"DATA",390.01,4,2,3,0)
lab results, and communicate securely with your health care teams.
"DATA",390.01,4,2,4,0)
 
"DATA",390.01,4,2,5,0)
We can assist you in creating your account today.
"DATA",390.01,4,3)
No - No one has spoken to me.
"DATA",390.01,4,4)
D ACTIONS^DGMHV(.DGMSACT,.ACTSEL,,"S")
"DATA",390.01,5,0)
No - I am not interested in enrolling.
"DATA",390.01,5,1)
5
"DATA",390.01,5,2,0)
^390.12^3^3^3141023^^^^
"DATA",390.01,5,2,1,0)
We are strongly encouraging patients to enroll in My HealtheVet.  With My 
"DATA",390.01,5,2,2,0)
HealtheVet you can refill prescriptions and track their delivery, view 
"DATA",390.01,5,2,3,0)
lab results, and communicate securely with your health care teams.
"DATA",390.01,5,3)
No - I am not interested in enrolling.
"DATA",390.01,5,4)
D NOFLW^DGMHV($G(DGSOCCOD))
"DATA",390.01,6,0)
No - I don't have a computer / internet access
"DATA",390.01,6,1)
6
"DATA",390.01,6,2,0)
^^5^5^3141027^
"DATA",390.01,6,2,1,0)
Do family or friends, who have a computer, ever help with your VA 
"DATA",390.01,6,2,2,0)
appointments or medications?  You can also log on to any public library 
"DATA",390.01,6,2,3,0)
computer to use My HealtheVet. Imagine that you are out of town and you
"DATA",390.01,6,2,4,0)
need a copy of your health records or medications-with a My HealtheVet
"DATA",390.01,6,2,5,0)
account you can get them easily from any computer.
"DATA",390.01,6,3)
No - I don't have a computer / internet access
"DATA",390.01,6,4)
D NOFLW^DGMHV($G(DGSOCCOD))
"DATA",390.02,1,0)
Helped patient to create a MHV account.
"DATA",390.02,1,1,0)
^390.21P^4^4
"DATA",390.02,1,1,1,0)
1
"DATA",390.02,1,1,2,0)
2
"DATA",390.02,1,1,3,0)
3
"DATA",390.02,1,1,4,0)
4
"DATA",390.02,2,0)
Referred patient to the MHV office/station for assistance with enrollment.
"DATA",390.02,2,1,0)
^390.21P^4^4
"DATA",390.02,2,1,1,0)
1
"DATA",390.02,2,1,2,0)
2
"DATA",390.02,2,1,3,0)
3
"DATA",390.02,2,1,4,0)
4
"DATA",390.02,3,0)
Scheduled future appointment for patient to enroll at MHV office/station.
"DATA",390.02,3,1,0)
^390.21P^4^4
"DATA",390.02,3,1,1,0)
1
"DATA",390.02,3,1,2,0)
2
"DATA",390.02,3,1,3,0)
3
"DATA",390.02,3,1,4,0)
4
"DATA",390.02,4,0)
Gave patient MHV enrollment instructions to complete at a MHV kiosk/computer.
"DATA",390.02,4,1,0)
^390.21P^4^4
"DATA",390.02,4,1,1,0)
1
"DATA",390.02,4,1,2,0)
2
"DATA",390.02,4,1,3,0)
3
"DATA",390.02,4,1,4,0)
4
"DATA",390.02,5,0)
Patient had an MHV account issue. Provided MHV Help Desk toll free # 1-877-327-0
022, Mon-Fri, 8 a.m.-8 p.m. (EST)
"DATA",390.02,5,1,0)
^390.21P^4^4
"DATA",390.02,5,1,1,0)
1
"DATA",390.02,5,1,2,0)
2
"DATA",390.02,5,1,3,0)
3
"DATA",390.02,5,1,4,0)
4
"DATA",390.02,6,0)
Patient signed IPA form and clerk forwarded to (TBD).
"DATA",390.02,6,1,0)
^390.21P^4^4
"DATA",390.02,6,1,1,0)
1
"DATA",390.02,6,1,2,0)
2
"DATA",390.02,6,1,3,0)
3
"DATA",390.02,6,1,4,0)
4
"DATA",390.02,7,0)
Patient could not authenticate at this time.
"DATA",390.02,7,1,0)
^390.21P^4^4
"DATA",390.02,7,1,1,0)
1
"DATA",390.02,7,1,2,0)
2
"DATA",390.02,7,1,3,0)
3
"DATA",390.02,7,1,4,0)
4
"DATA",390.02,8,0)
Clerk did not have authentication form.
"DATA",390.02,8,1,0)
^390.21P^4^4
"DATA",390.02,8,1,1,0)
1
"DATA",390.02,8,1,2,0)
2
"DATA",390.02,8,1,3,0)
3
"DATA",390.02,8,1,4,0)
4
"DATA",390.02,9,0)
MHV admin portal issue prevented patient authentication-referred to MHV Help Des
k or MHV coordinator.
"DATA",390.02,9,1,0)
^390.21P^4^4
"DATA",390.02,9,1,1,0)
1
"DATA",390.02,9,1,2,0)
2
"DATA",390.02,9,1,3,0)
3
"DATA",390.02,9,1,4,0)
4
"DATA",390.02,10,0)
Caregiver not present and Veteran needs caregiver to sign form.
"DATA",390.02,10,1,0)
^390.21P^4^4
"DATA",390.02,10,1,1,0)
1
"DATA",390.02,10,1,2,0)
2
"DATA",390.02,10,1,3,0)
3
"DATA",390.02,10,1,4,0)
4
"DATA",390.02,11,0)
Veteran did not have a form of photo ID with them. Advised patient to bring ID a
t next appointment.
"DATA",390.02,11,1,0)
^390.21P^4^4
"DATA",390.02,11,1,1,0)
1
"DATA",390.02,11,1,2,0)
2
"DATA",390.02,11,1,3,0)
3
"DATA",390.02,11,1,4,0)
4
"DATA",390.02,12,0)
Gave instructions to opt-in at home or at kiosk.
"DATA",390.02,12,1,0)
^390.21P^4^4
"DATA",390.02,12,1,1,0)
1
"DATA",390.02,12,1,2,0)
2
"DATA",390.02,12,1,3,0)
3
"DATA",390.02,12,1,4,0)
4
"DATA",390.02,13,0)
Referred to MHV coordinator for assistance.
"DATA",390.02,13,1,0)
^390.21P^4^4
"DATA",390.02,13,1,1,0)
1
"DATA",390.02,13,1,2,0)
2
"DATA",390.02,13,1,3,0)
3
"DATA",390.02,13,1,4,0)
4
"DATA",390.03,1,0)
No one has spoken to me/I don't know what MHV is.^123
"DATA",390.03,2,0)
I am not interested.^123
"DATA",390.03,3,0)
I do not have a computer.^123
"DATA",390.03,4,0)
I do not have access to the internet.^123
"DATA",390.03,5,0)
I do not trust the internet.^123
"DATA",390.03,6,0)
My caregiver makes these decisions for me.^123
"DATA",390.03,7,0)
I do not see the benefit.^123
"DATA",390.03,8,0)
I would not use it often enough.^123
"DATA",390.03,9,0)
Other^123
"DATA",390.04,1,0)
S^ACTIONS SELECTABLE AT MHV SOCIALIZATION
"DATA",390.04,2,0)
E^ACTIONS SELECTABLE AT MHV ENROLLMENT PROMPT
"DATA",390.04,3,0)
A^ACTIONS SELECTABLE AT MHV AUTHENTICATION PROMPT
"DATA",390.04,4,0)
M^ACTIONS SELECTABLE AT MHV SECURE MESSAGING PROMPT
"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^y^p^^^^n^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,537026)

"FIA",2,2,537027)

"FIA",2,2,537028)

"FIA",2,2,537029)

"FIA",2,2,537030)

"FIA",2,2,537031)

"FIA",2,2,537032)

"FIA",2,2,537033)

"FIA",2,2,537034)

"FIA",2,2,537035)

"FIA",2,2,537038)

"FIA",2,2,537041)

"FIA",2,2,537042)

"FIA",2,2.0537026)
1
"FIA",2,2.0537026,.01)

"FIA",2,2.0537026,1)

"FIA",2,2.0537026,2)

"FIA",2,2.0537041)
1
"FIA",2,2.0537041,.01)

"FIA",2,2.0537042)
1
"FIA",2,2.0537042,.01)

"FIA",2,2.5370262)
1
"FIA",2,2.5370262,.01)

"FIA",390.01)
MHV SOCIALIZATION
"FIA",390.01,0)
^DGMHV(390.01,
"FIA",390.01,0,0)
390.01
"FIA",390.01,0,1)
y^y^f^^n^^y^o^n
"FIA",390.01,0,10)

"FIA",390.01,0,11)

"FIA",390.01,0,"RLRO")

"FIA",390.01,0,"VR")
5.3^DG
"FIA",390.01,390.01)
0
"FIA",390.01,390.12)
0
"FIA",390.02)
MHV SOCIALIZATION ACTIONS
"FIA",390.02,0)
^DGMHV(390.02,
"FIA",390.02,0,0)
390.02
"FIA",390.02,0,1)
y^y^f^^n^^y^o^n
"FIA",390.02,0,10)

"FIA",390.02,0,11)

"FIA",390.02,0,"RLRO")

"FIA",390.02,0,"VR")
5.3^DG
"FIA",390.02,390.02)
0
"FIA",390.02,390.21)
0
"FIA",390.03)
MHV DECLINED REASONS
"FIA",390.03,0)
^DGMHV(390.03,
"FIA",390.03,0,0)
390.03
"FIA",390.03,0,1)
y^n^f^^n^^y^o^n
"FIA",390.03,0,10)

"FIA",390.03,0,11)

"FIA",390.03,0,"RLRO")

"FIA",390.03,0,"VR")
5.3^DG
"FIA",390.03,390.03)
0
"FIA",390.04)
MHV ACTION SELECTION
"FIA",390.04,0)
^DGMHV(390.04,
"FIA",390.04,0,0)
390.04S
"FIA",390.04,0,1)
y^y^f^^n^^y^o^n
"FIA",390.04,0,10)

"FIA",390.04,0,11)

"FIA",390.04,0,"RLRO")

"FIA",390.04,0,"VR")
5.3^DG
"FIA",390.04,390.04)
0
"MBREQ")
0
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
903^3141029^1
"PKG",114,22,1,"PAH",1,1,0)
^^27^27^3141029
"PKG",114,22,1,"PAH",1,1,1,0)
Increase Enrollment in My HealtheVet (IEMHV)
"PKG",114,22,1,"PAH",1,1,2,0)
 
"PKG",114,22,1,"PAH",1,1,3,0)
This patch contains enhancements to Pre-Registration functionality in the
"PKG",114,22,1,"PAH",1,1,4,0)
Preregister a Patient [DGPRE PRE-REGISTER] option in the VistA
"PKG",114,22,1,"PAH",1,1,5,0)
Registration V.5.3 package to increase patient enrollment in My 
"PKG",114,22,1,"PAH",1,1,6,0)
HealtheVet.
"PKG",114,22,1,"PAH",1,1,7,0)
 
"PKG",114,22,1,"PAH",1,1,8,0)
My HealtheVet Enrollment Alert/Reminder
"PKG",114,22,1,"PAH",1,1,9,0)
---------------------------------------
"PKG",114,22,1,"PAH",1,1,10,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"PKG",114,22,1,"PAH",1,1,11,0)
to display a message alerting the clerk that the selected patient 
"PKG",114,22,1,"PAH",1,1,12,0)
has neither completed My HealtheVet enrollment, nor documented their 
"PKG",114,22,1,"PAH",1,1,13,0)
desire to be excluded from My HealtheVet enrollment. Recent assistance 
"PKG",114,22,1,"PAH",1,1,14,0)
provided by Pre-Registration clerks with the patient's My HealtheVet
"PKG",114,22,1,"PAH",1,1,15,0)
enrollment is displayed within the alert/reminder.
"PKG",114,22,1,"PAH",1,1,16,0)
 
"PKG",114,22,1,"PAH",1,1,17,0)
Socialization Questions and Responses
"PKG",114,22,1,"PAH",1,1,18,0)
-------------------------------------
"PKG",114,22,1,"PAH",1,1,19,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"PKG",114,22,1,"PAH",1,1,20,0)
to capture a patient's My HealtheVet enrollment status during the 
"PKG",114,22,1,"PAH",1,1,21,0)
pre-registration process.
"PKG",114,22,1,"PAH",1,1,22,0)
 
"PKG",114,22,1,"PAH",1,1,23,0)
My HealtheVet Enrollment Actions
"PKG",114,22,1,"PAH",1,1,24,0)
--------------------------------
"PKG",114,22,1,"PAH",1,1,25,0)
The Preregister a Patient [DGPRE PRE-REGISTER] option has been enhanced 
"PKG",114,22,1,"PAH",1,1,26,0)
to capture actions Pre-Registration clerks performed to assist with a
"PKG",114,22,1,"PAH",1,1,27,0)
patient's My HealtheVet enrollment.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGMHV")
0^1^B109645277
"RTN","DGMHV",1,0)
DGMHV ;ALB/JCH - Display Pre-Registration MHV Enrollment ; 12/9/03 3:22pm
"RTN","DGMHV",2,0)
 ;;5.3;Registration;**903**;Aug 13, 1993;Build 26
"RTN","DGMHV",3,0)
 Q
"RTN","DGMHV",4,0)
EN(DFN) ; Entry Point for Alert, Socialization, and MHV Enrollment field editing
 'Screen'
"RTN","DGMHV",5,0)
 ;
"RTN","DGMHV",6,0)
 D MAIN^DGMHV(DFN)
"RTN","DGMHV",7,0)
 Q
"RTN","DGMHV",8,0)
 ;
"RTN","DGMHV",9,0)
MAIN(DFN) ; Main Entry Point for MHV socialization text/action
"RTN","DGMHV",10,0)
 ; Do not display MHV enrollment 'screen' if socialization Action entered (DGMHV
OUT="A"), meaning MHV enrollment is in progress, not a firm YES or NO
"RTN","DGMHV",11,0)
 ; Do not display socialization text/action if MHV ENROLLED field is not null (D
GMHVOUT="E")
"RTN","DGMHV",12,0)
 D CLEAR,ALERT,DSPLACT(DFN) I $G(DGMHVOUT)="" W !! D CONT
"RTN","DGMHV",13,0)
 D CLEAR
"RTN","DGMHV",14,0)
 I $G(DGMHVOUT)="E" D EN^DGMHVAC(DFN) Q
"RTN","DGMHV",15,0)
 I $G(DGMHVOUT)="A" D  Q
"RTN","DGMHV",16,0)
 .N DGDPTSOC S DGDPTSOC=+$O(^DPT(DFN,1,"A"),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.DGMHS
EL,DGDPTSOC,"S")
"RTN","DGMHV",17,0)
 .Q:$G(DGMHVOUT)!$G(DGMHVNOS)
"RTN","DGMHV",18,0)
 .D EN^DGMHVAC(DFN)
"RTN","DGMHV",19,0)
 D SOCIAL^DGMHV Q:$G(DGMHVOUT)!$G(DGMHVNOS)
"RTN","DGMHV",20,0)
 D EN^DGMHVAC(DFN)
"RTN","DGMHV",21,0)
 Q
"RTN","DGMHV",22,0)
 ;
"RTN","DGMHV",23,0)
SOCIAL ; MHV Enrollment talking point/socialization text action
"RTN","DGMHV",24,0)
 ; Display MHV socialization canned text, prompt for patient response, display a
nd prompt for clerk action
"RTN","DGMHV",25,0)
 Q:$P($G(^DPT(DFN,2)),"^")
"RTN","DGMHV",26,0)
 N DGSODONE
"RTN","DGMHV",27,0)
 F  Q:$G(DGSODONE)!$G(DGMHVOUT)  D SLOOP
"RTN","DGMHV",28,0)
 Q
"RTN","DGMHV",29,0)
SLOOP ; Allow user to go back and enter a different patient response in case the
 patient changes their mind
"RTN","DGMHV",30,0)
 N DGMHV,I,DGDIR0,DGDPTSOC,DGTAB,DGREADTX,DGMHVMOD S DGDPTSOC="",DGMHVMOD="S"
"RTN","DGMHV",31,0)
 K DIRUT
"RTN","DGMHV",32,0)
 S DGREADTX="Please read the following to the patient"
"RTN","DGMHV",33,0)
 D GTSOCODS(.DGDIR0) S DGDIR0="SO^",I="" F  S I=$O(DGDIR0(I)) Q:'I  S DGDIR0=DGD
IR0_I_":"_DGDIR0(I)_";"
"RTN","DGMHV",34,0)
 F  Q:$G(DGMHVOUT)!$G(DGMHV("SOCIAL"))  D
"RTN","DGMHV",35,0)
 .D CLEAR W !!,DGREADTX
"RTN","DGMHV",36,0)
 .K DIR W !!?8,"""Has a health care team member encouraged you"
"RTN","DGMHV",37,0)
 .W !?10,"to enroll online for My HealtheVet?"""
"RTN","DGMHV",38,0)
 .S DIR("A")="Patient response"
"RTN","DGMHV",39,0)
 .S DIR(0)=DGDIR0
"RTN","DGMHV",40,0)
 .S DIR("??")="D CLEAR" D ^DIR I $E($G(Y))="^" S DGMHVOUT=1 Q
"RTN","DGMHV",41,0)
 .I Y="" W !!,"My HealtheVet enrollment information is required to continue with
 this patient",!! D CONT Q
"RTN","DGMHV",42,0)
 .S DGMHV("SOCIAL")=$G(DGDIR0(Y,"IEN"))
"RTN","DGMHV",43,0)
 Q:$G(DGMHVOUT)
"RTN","DGMHV",44,0)
 D FILSOC(DFN,+DGMHV("SOCIAL"),$$NOW^XLFDT,.DGDPTSOC)
"RTN","DGMHV",45,0)
 I DGMHV("SOCIAL")=1 N DIE,DR,DA S DIE="^DPT(",DR="537027////1;537030////"_$$NOW
^XLFDT,DA=DFN D ^DIE
"RTN","DGMHV",46,0)
 Q:'$G(DGMHV("SOCIAL"))  D CLEAR W !!,DGREADTX W !! D CANNED(DGMHV("SOCIAL")) D 
CONT I (DGMHV("SOCIAL")>1) I $G(DIRUT)&($G(X)="^") S DGSODONE=0 Q
"RTN","DGMHV",47,0)
 N FLWUP,RTST S DGAR1=DGDPTSOC S FLWUP=$G(^DGMHV(390.01,DGMHV("SOCIAL"),4)) S RT
ST=$P(FLWUP,"^",2),RTST=$P(RTST,"(") I RTST]"" I $T(@RTST)]"" X FLWUP
"RTN","DGMHV",48,0)
 S DGSODONE=1
"RTN","DGMHV",49,0)
 Q
"RTN","DGMHV",50,0)
 ;
"RTN","DGMHV",51,0)
ALERT(DPTDFN) ; Displays the 'MHV Enrollment Information Missing' message
"RTN","DGMHV",52,0)
 Q:'$D(XQY0)
"RTN","DGMHV",53,0)
 N X,Y,IORVON,IORVOFF,DIR,DIRUT
"RTN","DGMHV",54,0)
 S X="IORVON;IORVOFF"
"RTN","DGMHV",55,0)
 D ENDR^%ZISS
"RTN","DGMHV",56,0)
 W !!!!?4,$CHAR(7) W:$D(IORVON) IORVON W "** PATIENT NEEDS TO ANSWER MY HEALTHEV
ET ENROLLMENT QUESTIONS **" W:$D(IORVOFF) IORVOFF
"RTN","DGMHV",57,0)
 W !?4,"Patient is missing required My HealtheVet Enrollment information",!
"RTN","DGMHV",58,0)
 Q
"RTN","DGMHV",59,0)
 ;
"RTN","DGMHV",60,0)
FILSOC(DFN,RSPNT,RSPDT,DGDPTSOC) ; File MHV Socialization Information to PATIENT
 (#2) file
"RTN","DGMHV",61,0)
 ;    DFN = PATIENT IEN
"RTN","DGMHV",62,0)
 ;  RSPNT = RESPONSE POINTER TO FILE 390.01
"RTN","DGMHV",63,0)
 ;  RPSDT = RESPONSE DATE/TIME
"RTN","DGMHV",64,0)
 ;
"RTN","DGMHV",65,0)
 N DIE,DA,DR,DO,DGMHVND K DIE,DA,DR,DO
"RTN","DGMHV",66,0)
 S DIC(0)="EZ",DIC="^DPT(DFN,1,",DA(2)=DFN,DA(1)=+$O(^DPT(DFN,1,"A"),-1)+1,DGDPT
SOC=DA(1)
"RTN","DGMHV",67,0)
 S DGMHVND=DA(1),DINUM=DA(1),X=RSPDT,DIC("DR")=".01////"_RSPDT_";1////"_RSPNT D 
FILE^DICN
"RTN","DGMHV",68,0)
 K DIE,DIC,DA S DIE="^DPT(DFN,1,",DA(1)=DFN,DA=DGMHVND
"RTN","DGMHV",69,0)
 S DR=".01////"_RSPDT_";1////"_RSPNT D ^DIE
"RTN","DGMHV",70,0)
 Q
"RTN","DGMHV",71,0)
 ;
"RTN","DGMHV",72,0)
CANNED(SCRIPT) ; Display canned text from PATIENT TEXT (#2) field in the MHV SOC
IALIZATION (#390.01) file
"RTN","DGMHV",73,0)
 Q:'$G(SCRIPT)
"RTN","DGMHV",74,0)
 N DGMHVLIN,DGLINCNT,DGMHVOUT S DGMHVLIN=$P($G(^DGMHV(390.01,SCRIPT,2,0)),"^",3)
,DGMHVOUT=0
"RTN","DGMHV",75,0)
 S DGLINCNT=0 F  S DGLINCNT=$O(^DGMHV(390.01,SCRIPT,2,DGLINCNT)) Q:'DGLINCNT!(DG
LINCNT>DGMHVLIN)  D
"RTN","DGMHV",76,0)
 .W !?2 W:DGLINCNT=1 """" W ^DGMHV(390.01,SCRIPT,2,DGLINCNT,0) S DGMHVOUT=1
"RTN","DGMHV",77,0)
 W:$G(DGMHVOUT) """" W !
"RTN","DGMHV",78,0)
 Q
"RTN","DGMHV",79,0)
 ;
"RTN","DGMHV",80,0)
GTSOCODS(DGSOCCOD) ; Get array of socialization codes and display sequences from
 MHV SOCIALIZATION (#390.01) file
"RTN","DGMHV",81,0)
 K DGSOCCOD,DGSOCIEN,DGSOCSEQ S DGSOCSEQ="",DGSOCCOD="",DGSOCIEN="" N I,TEXT S I
=0,TEXT=""
"RTN","DGMHV",82,0)
 F  S DGSOCSEQ=$O(^DGMHV(390.01,"C",DGSOCSEQ)) Q:'DGSOCSEQ  D
"RTN","DGMHV",83,0)
 .S DGSOCIEN="" F  S DGSOCIEN=$O(^DGMHV(390.01,"C",DGSOCSEQ,DGSOCIEN)) Q:DGSOCIE
N=""  D
"RTN","DGMHV",84,0)
 ..N TEXT D FIND^DIC(390.01,"","@;.01","A",DGSOCIEN,1,"","","","TEXT")
"RTN","DGMHV",85,0)
 ..S I=I+1 S DGSOCCOD(I)=TEXT("DILIST","ID",1,".01"),DGSOCCOD(I,"IEN")=DGSOCIEN
"RTN","DGMHV",86,0)
 Q
"RTN","DGMHV",87,0)
 ;
"RTN","DGMHV",88,0)
NOFLW(DGSOCCOD) ; Perform followup dialog for patient that does not wish to enro
ll
"RTN","DGMHV",89,0)
 N DIR,DIC,DA,DGAR1,DGAR2 S DGAR1="",DGAR2=""
"RTN","DGMHV",90,0)
 W !! S DIR("A",1)="   How does the patient feel now about enrolling in My Healt
heVet?"
"RTN","DGMHV",91,0)
 S DIR("A",2)=" ",DIR("A",3)="          a) Patient is not interested."
"RTN","DGMHV",92,0)
 S DIR("A",4)="          b) Patient is interested.",DIR("A",5)=" "
"RTN","DGMHV",93,0)
 S DIR(0)="SA^a:Patient is not interested;b:Patient is interested",DIR("A")="Sel
ect a response: "
"RTN","DGMHV",94,0)
 ;S DIR("?")="   Help Text ......",DIR("??")="    More Help Text...."
"RTN","DGMHV",95,0)
 D ^DIR Q:$G(Y)="a"
"RTN","DGMHV",96,0)
 D ACTIONS(.DGAR1,DGAR2,$G(DGDPTSOC),"S")
"RTN","DGMHV",97,0)
 Q
"RTN","DGMHV",98,0)
 ;
"RTN","DGMHV",99,0)
ACTIONS(DGMSACT,ACTSEL,DGENRQ,DGMHVMOD) ; Display MHV Socialization actions, all
ow selection, return selected actions in ACTSEL
"RTN","DGMHV",100,0)
 ; Input:
"RTN","DGMHV",101,0)
 ;   DGMSACT  - Array of selectable actions from MHV SOCIALIZATION ACTIONS (#390
.02) file
"RTN","DGMHV",102,0)
 ;   ACTSEL   - Array of action(s) currently selected by clerk
"RTN","DGMHV",103,0)
 ;   DGENRQ   - Internal Entry Number (IEN) of the prospective MHV SOCIALIZATION
 (#537026) multiple in the PATIENT (#2) file into which
"RTN","DGMHV",104,0)
 ;              the selected actions in ACTSEL will be stored.
"RTN","DGMHV",105,0)
 ;   DGMHVMOD - Mode; the section of MHV functionality from which this is invoke
d. Used to screen selectable actions.
"RTN","DGMHV",106,0)
 ;                    "S" - Enrollment Socialization, "A" - Authentication field
, "S" - Secure Messaging field
"RTN","DGMHV",107,0)
 ;
"RTN","DGMHV",108,0)
 K DIR,DGMSACT D CLEAR
"RTN","DGMHV",109,0)
 N DIR,ACTCNT,DGACDONE,DGSTAY,DGACSAVE,DGACCNT S DGACDONE=0,DGACSAVE=0
"RTN","DGMHV",110,0)
 D GETACTS(.DGMSACT,$G(DGMHVMOD)) S DGACCNT=+$O(DGMSACT(""),-1)
"RTN","DGMHV",111,0)
 S DIR(0)="SA^" S ACTCNT=0 F  S ACTCNT=$O(DGMSACT(ACTCNT)) Q:'ACTCNT  S DIR(0)=D
IR(0)_ACTCNT_":"_DGMSACT(ACTCNT)_";"
"RTN","DGMHV",112,0)
 S $P(DIR(0),"^",3)="D ACTRNSFM^DGMHV"
"RTN","DGMHV",113,0)
 F  Q:$G(DGACDONE)  D ACTLOOP(.DIR,.DGMSACT,.ACTSEL)
"RTN","DGMHV",114,0)
 I $G(DGACSAVE),$D(ACTSEL)>1 D  S DGMHVNOS=1 Q
"RTN","DGMHV",115,0)
 .I $G(DGENRQ),'$G(DGDPTSOC) S DGDPTSOC=DGENRQ
"RTN","DGMHV",116,0)
 .N DGSEL,DGAIEN,DGMHVND,DGPLURAL S DGSEL=0 F DGPLURAL=1:1 S DGSEL=$O(ACTSEL(DGS
EL)) Q:'DGSEL  D
"RTN","DGMHV",117,0)
 ..N DIE,DA,DIC S DGAIEN=$G(ACTSEL(DGSEL,"IEN")),DIC(0)="EZ",DIC="^DPT("_DFN_",1
,"_DGDPTSOC_",1,",DA(3)=DFN,DA(2)=DGDPTSOC
"RTN","DGMHV",118,0)
 ..S DA(1)=$O(^DPT(DFN,1,DA(2),1,"A"),-1)+1,DINUM=DA(1),X=DGAIEN,DGMHVND=DA(1),D
IC("DR")=".01////"_DGAIEN D FILE^DICN I $G(DGENRQ) D
"RTN","DGMHV",119,0)
 ...N DA,DIE,DIC,RSPDT S RSPDT=$$NOW^XLFDT S DIE="^DPT(DFN,1,",DA(1)=DFN,DA=DGEN
RQ S DR=".01////"_RSPDT D ^DIE
"RTN","DGMHV",120,0)
 ..N DA,DIE,DIC K DIE,DIC,DA S DIE="^DPT("_DFN_",1,"_DGDPTSOC_",1,",DA(2)=DFN,DA
(1)=DGDPTSOC,DA=$O(^DPT(DFN,1,DGDPTSOC,1,"A"),-1)
"RTN","DGMHV",121,0)
 ..S DR=".01////"_DGAIEN D ^DIE
"RTN","DGMHV",122,0)
 .W !,$S($G(DGPLURAL)=1:"Action",1:"Actions")," Filed...",! H .5
"RTN","DGMHV",123,0)
 S DGMHVOUT=1
"RTN","DGMHV",124,0)
 Q
"RTN","DGMHV",125,0)
 ;
"RTN","DGMHV",126,0)
ACTLOOP(DIR,DGMSACT,ACTSEL) ; Redisplay and reprompt user for action(s) until th
ey're filed, or user aborts
"RTN","DGMHV",127,0)
 ;
"RTN","DGMHV",128,0)
 D CLEAR
"RTN","DGMHV",129,0)
 S DGSTAY=1
"RTN","DGMHV",130,0)
 W !?2,"Action(s) taken to assist patient enrollment in My HealtheVet."
"RTN","DGMHV",131,0)
 W !?2,"-----------------------------------------------------------------------"
"RTN","DGMHV",132,0)
 D ^DIR
"RTN","DGMHV",133,0)
 I Y="^"!$G(DIRUT) W !! N DGREALQ S DGREALQ=1 D  Q
"RTN","DGMHV",134,0)
 .N DIR,Y S DIR(0)="Y",DIR("A",1)="My HealtheVet enrollment questions is require
d to continue with this patient."
"RTN","DGMHV",135,0)
 .S DIR("A")="Are you sure you want to quit " D ^DIR I $G(Y) S DGMHVOUT=1,DGACDO
NE=1,DGACSAVE=0,DGSTAY=0 Q
"RTN","DGMHV",136,0)
 .S DGSTAY=1
"RTN","DGMHV",137,0)
 I $G(Y)>0 N DGSELL F DGSELL=1:1:$L(Y,",") N DGSELIT S DGSELIT=$P(Y,",",DGSELL) 
I DGSELIT]"" M ACTSEL(DGSELIT)=DGMSACT(DGSELIT)
"RTN","DGMHV",138,0)
 F  Q:'$G(DGSTAY)  D
"RTN","DGMHV",139,0)
 .D CLEAR N DIR,SELAC,DGCNT,DGII S DGCNT=1,DGSTAY=0
"RTN","DGMHV",140,0)
 .S DIR("A",DGCNT)="",DGCNT=DGCNT+1
"RTN","DGMHV",141,0)
 .S DIR("A",DGCNT)="Actions Selected:"
"RTN","DGMHV",142,0)
 .S DGCNT=DGCNT+1,DIR("A",DGCNT)=" " ;"-----------------------------------------
------------------------------"
"RTN","DGMHV",143,0)
 .S SELAC="" F DGII=1:1 S SELAC=$O(ACTSEL(SELAC)) Q:'SELAC  D
"RTN","DGMHV",144,0)
 ..N SELACSUB,MARX S SELACSUB=0 D TXT(ACTSEL(SELAC),60) F  S SELACSUB=$O(MARX(SE
LACSUB)) Q:'SELACSUB  D
"RTN","DGMHV",145,0)
 ...S DGCNT=DGCNT+1 S DIR("A",DGCNT)=" "_$S(SELACSUB=1:SELAC_" - ",1:"    ")_" "
_MARX(SELACSUB)
"RTN","DGMHV",146,0)
 .S DGCNT=DGCNT+1 S DIR("A",DGCNT)=""
"RTN","DGMHV",147,0)
 .;S DIR("?")="HELP",DIR("?",1)="HELP"
"RTN","DGMHV",148,0)
 .S DIR("A")="  (A)dd another, (D)elete an action, or <RET> to save and exit: ",
DIR(0)="SAO^A:Add an Action;D:Delete an Action" D ^DIR W !
"RTN","DGMHV",149,0)
 .Q:Y="A"
"RTN","DGMHV",150,0)
 .I Y="D" S DGSTAY=1 D DELETE(.ACTSEL) Q
"RTN","DGMHV",151,0)
 .I Y="^" W !! N DGREALQ S DGREALQ=1 D  Q
"RTN","DGMHV",152,0)
 ..N DIR,Y S DIR(0)="Y",DIR("A",1)="My HealtheVet enrollment information is requ
ired to continue with this patient."
"RTN","DGMHV",153,0)
 ..S DIR("A")="Are you sure you want to quit " D ^DIR I $G(Y) S DGMHVOUT=1,DGACD
ONE=1,DGACSAVE=0,DGSTAY=0 Q
"RTN","DGMHV",154,0)
 ..S DGSTAY=1
"RTN","DGMHV",155,0)
 .S DGACDONE=1,DGACSAVE=1
"RTN","DGMHV",156,0)
 Q
"RTN","DGMHV",157,0)
 ;
"RTN","DGMHV",158,0)
GETACTS(DGMSACT,DGMHVMOD) ; Get actions from the MHV SOCIALIZATION ACTIONS (#390
.02) file; screen by mode (DGMHVMOD)
"RTN","DGMHV",159,0)
 ; Input: DGMHVMOD - Mode; MHV functionality from which this is invoked. Used to
 screen selectable Actions.
"RTN","DGMHV",160,0)
 ; DGMSACT - Array containing appropriate MHV actions, after screening based on 
mode (DGMHVMOD).
"RTN","DGMHV",161,0)
 ;
"RTN","DGMHV",162,0)
 N ACTIEN,ACTCNT,ACTTXT,SELCNT,DGMHVSAT S ACTCNT=0,SELCNT=0
"RTN","DGMHV",163,0)
 S ACTIEN=0 F  S ACTIEN=$O(^DGMHV(390.02,ACTIEN)) Q:'ACTIEN  S ACTTXT=$P($G(^DGM
HV(390.02,ACTIEN,0)),"^") I ACTTXT]"" D
"RTN","DGMHV",164,0)
 .N ACTLLIST D ACTSCRN^DGMHVUTL(ACTIEN,.ACTLLIST) I ($G(DGMHVMOD)]"") Q:'$D(ACTL
LIST(DGMHVMOD))
"RTN","DGMHV",165,0)
 .S ACTCNT=ACTCNT+1,SELCNT=SELCNT+1,DGMSACT(ACTCNT)=ACTTXT,DGMSACT(ACTCNT,"IEN")
=ACTIEN
"RTN","DGMHV",166,0)
 .N MARX,ACTLINE D TXT(ACTTXT,60) S ACTLINE=0 F  S ACTLINE=$O(MARX(ACTLINE)) Q:'
ACTLINE  D
"RTN","DGMHV",167,0)
 ..N DGDASH S DGDASH=$S(ACTLINE=1&(ACTCNT<10):ACTCNT_" -  ",(ACTLINE=1&(ACTCNT>9
)):ACTCNT_" - ",1:"     ")
"RTN","DGMHV",168,0)
 ..S DIR("A",SELCNT)="  "_DGDASH_" "_MARX(ACTLINE) S SELCNT=SELCNT+1
"RTN","DGMHV",169,0)
 ..;S DIR("A",SELCNT)="  "_$S(ACTLINE=1:ACTCNT_"  -  ",1:"      ")_"  "_MARX(ACT
LINE) S SELCNT=SELCNT+1
"RTN","DGMHV",170,0)
 S DIR("A",SELCNT+1)=" "
"RTN","DGMHV",171,0)
 S DIR("A")=" Select an action: "
"RTN","DGMHV",172,0)
 Q
"RTN","DGMHV",173,0)
 ;
"RTN","DGMHV",174,0)
DELETE(DGACTD) ; Delete one previously selected action
"RTN","DGMHV",175,0)
 ; Input : DGACTD - Array of MHV actions selected by clerk.
"RTN","DGMHV",176,0)
 K DGDELDIR,DIR N DGDELAR,II,DGCNT S DGCNT=0
"RTN","DGMHV",177,0)
 M DGDELAR=DGACTD
"RTN","DGMHV",178,0)
 ;
"RTN","DGMHV",179,0)
 K DGACTD M DGACTD=DGDELAR
"RTN","DGMHV",180,0)
 S DIR(0)="SAO^" S ZZ=0 F II=1:1 S ZZ=$O(DGDELAR(ZZ)) Q:'ZZ  S DIR(0)=DIR(0)_ZZ_
":"_DGDELAR(ZZ)_";"
"RTN","DGMHV",181,0)
 S DIR("A")="Select an action to delete: " D ^DIR I $G(Y)>0,$D(DGACTD(+Y)) K DGA
CTD(Y)
"RTN","DGMHV",182,0)
 W ! D CONT I '$D(DGACTD) S DGSTAY=0 D CLEAR
"RTN","DGMHV",183,0)
 Q
"RTN","DGMHV",184,0)
 ;
"RTN","DGMHV",185,0)
REVERSE(PAD,DGREVTXT) ; Display DGREVTXT in reverse video
"RTN","DGMHV",186,0)
 N X,Y,IORVON,IORVOFF,DIR,DIRUT
"RTN","DGMHV",187,0)
 S X="IORVON;IORVOFF" S PAD=+$G(PAD)
"RTN","DGMHV",188,0)
 D ENDR^%ZISS
"RTN","DGMHV",189,0)
 W $CHAR(7) W ?PAD W:$D(IORVON) IORVON W DGREVTXT W:$D(IORVOFF) IORVOFF
"RTN","DGMHV",190,0)
 Q
"RTN","DGMHV",191,0)
 ;
"RTN","DGMHV",192,0)
TXT(TXT,LEN) ; Split string into multiple LEN length lines
"RTN","DGMHV",193,0)
 ;* Input: TXT = TXT string
"RTN","DGMHV",194,0)
 ;*        LEN = format length
"RTN","DGMHV",195,0)
 ;* Output: MARX array.
"RTN","DGMHV",196,0)
 ;*
"RTN","DGMHV",197,0)
 NEW OLD,X1,Y D SPLIT K MARX
"RTN","DGMHV",198,0)
 S X=0,X1=1,Y="" F  S X=$O(OLD(X)) Q:'X  D
"RTN","DGMHV",199,0)
 . I $L(Y_OLD(X))>LEN S MARX(X1)=Y,X1=X1+1,Y="" D
"RTN","DGMHV",200,0)
 .. I $E(MARX(X1-1),$L(MARX(X1-1)))'=" " Q
"RTN","DGMHV",201,0)
 .. S MARX(X1-1)=$E(MARX(X1-1),1,$L(MARX(X1-1))-1)
"RTN","DGMHV",202,0)
 . S Y=Y_OLD(X)
"RTN","DGMHV",203,0)
 S:Y]"" MARX(X1)=Y
"RTN","DGMHV",204,0)
 S MARX=X1
"RTN","DGMHV",205,0)
 Q
"RTN","DGMHV",206,0)
 ;
"RTN","DGMHV",207,0)
SPLIT ; * Split a word string into individual words.
"RTN","DGMHV",208,0)
 ;* Input: TXT  - Line of text
"RTN","DGMHV",209,0)
 ;* Input: LEN  - Maximum length one line of text will be limited to
"RTN","DGMHV",210,0)
 ;* Output: OLD(X)
"RTN","DGMHV",211,0)
 NEW BSD,NEW,X,X1,Y
"RTN","DGMHV",212,0)
 S OLD(1)=TXT Q:$L(TXT)<LEN
"RTN","DGMHV",213,0)
 F BSD=" ","/","-" S:'$O(OLD(0)) OLD(1)=TXT D:TXT[BSD DELIM(BSD)
"RTN","DGMHV",214,0)
 I '$O(OLD(1)),($L(TXT)>LEN) D LEN(1,TXT) K OLD D
"RTN","DGMHV",215,0)
 . F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","DGMHV",216,0)
 Q
"RTN","DGMHV",217,0)
 ;
"RTN","DGMHV",218,0)
LEN(X1,OLD) ;* Wrap word to next line if it doesn't fit the display length
"RTN","DGMHV",219,0)
 NEW X
"RTN","DGMHV",220,0)
 Q:$L(OLD)'>LEN
"RTN","DGMHV",221,0)
 S X=$E(OLD,1,($L(OLD)-1)) I X["/"!(X["-") Q
"RTN","DGMHV",222,0)
 I $L(OLD)>LEN F X=1:1 S NEW(X1)=$E(OLD,((LEN*X)-LEN+1),(LEN*X)),X1=X1+1 Q:($L(O
LD)'>(LEN*X))
"RTN","DGMHV",223,0)
 Q
"RTN","DGMHV",224,0)
 ;
"RTN","DGMHV",225,0)
DELIM(BSD) ; Split a string into individual words
"RTN","DGMHV",226,0)
 ; Input:  BSD - Characters considered delimiters between words (i.e., for ident
ifying/splitting-up-and/or-separating words)
"RTN","DGMHV",227,0)
 ; Input:  OLD(n) - Text array containing  
"RTN","DGMHV",228,0)
 ; Output: OLD(n) - Array containing pdated 
"RTN","DGMHV",229,0)
 K NEW
"RTN","DGMHV",230,0)
 S X=0,X1=0 F  S X=$O(OLD(X)) Q:'X  F Y=1:1:$L(OLD(X),BSD) D
"RTN","DGMHV",231,0)
 . S X1=X1+1
"RTN","DGMHV",232,0)
 . S NEW(X1)=$P(OLD(X),BSD,Y)
"RTN","DGMHV",233,0)
 . I $L(OLD(X),BSD)>1,(Y<$L(OLD(X),BSD)) S NEW(X1)=NEW(X1)_BSD
"RTN","DGMHV",234,0)
 . D LEN(.X1,NEW(X1))
"RTN","DGMHV",235,0)
 K OLD F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","DGMHV",236,0)
 Q
"RTN","DGMHV",237,0)
 ;
"RTN","DGMHV",238,0)
CLEAR ; Clear the display
"RTN","DGMHV",239,0)
 D CLEAR^VALM1
"RTN","DGMHV",240,0)
 D FULL^VALM1
"RTN","DGMHV",241,0)
 S VALMBCK="R"
"RTN","DGMHV",242,0)
 Q
"RTN","DGMHV",243,0)
 ;
"RTN","DGMHV",244,0)
CONT ; Prompt to Continue
"RTN","DGMHV",245,0)
 N DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR
"RTN","DGMHV",246,0)
 Q
"RTN","DGMHV",247,0)
 ;
"RTN","DGMHV",248,0)
ACTRNSFM ; Transform action prompt input
"RTN","DGMHV",249,0)
 ;
"RTN","DGMHV",250,0)
 Q
"RTN","DGMHV",251,0)
DSPLACT(DFN) ; Display all MHV actions associated with last 5 date/time stamps. 
If last action is one of the 
"RTN","DGMHV",252,0)
 ;             first four MHV actions, ask additional question about whether the
 patient was successfully enrolled
"RTN","DGMHV",253,0)
 N TMPDT,LASTDT,DGACTDT,NXT1,NXT2,I,J,DGLACTS,DIC,DA S DGLACTS=""
"RTN","DGMHV",254,0)
 D GETLACT^DGMHVUTL(DFN,.DGLACTS)
"RTN","DGMHV",255,0)
 W !,"         History of My HealtheVet actions taken by VistA Clerks "
"RTN","DGMHV",256,0)
 W !,"  --------------------------------------------------------------------"
"RTN","DGMHV",257,0)
 I '$O(DGLACTS(0)) W !?8," - NONE - ",!! Q
"RTN","DGMHV",258,0)
 S LASTDT="" F  S LASTDT=$O(DGLACTS(LASTDT)) Q:'LASTDT  D
"RTN","DGMHV",259,0)
 .S DGACTDT=$$FMTE^XLFDT($P(LASTDT,"."),2) I ($L(DGACTDT)<8) D
"RTN","DGMHV",260,0)
 ..N NEWDT,IDT,DTPC F IDT=1:1:$L(DGACTDT,"/") D
"RTN","DGMHV",261,0)
 ...S DTPC=$P(DGACTDT,"/",IDT),DTPC=$TR($J(DTPC,2)," ",0),NEWDT=$G(NEWDT)_$S(IDT
=1:"",1:"/")_DTPC
"RTN","DGMHV",262,0)
 ..I NEWDT?2N1"/"2N1"/"2N S DGACTDT=NEWDT
"RTN","DGMHV",263,0)
 .S NXT1=0 F I=1:1 S NXT1=$O(DGLACTS(LASTDT,NXT1)) Q:'NXT1  D
"RTN","DGMHV",264,0)
 ..S NXT2="" F J=1:1 S NXT2=$O(DGLACTS(LASTDT,NXT1,"TXT",NXT2)) Q:'NXT2  W ! D
"RTN","DGMHV",265,0)
 ...N DGSP S DGSP=$S($L($G(DGLACTS(LASTDT,NXT1,"IEN")))>1:" ",1:" ")
"RTN","DGMHV",266,0)
 ...W ?2,$S($G(TMPDT)'=LASTDT:DGACTDT,1:"        ") W $S((J=1):DGSP_" ",1:"   ")
,$G(DGLACTS(LASTDT,NXT1,"TXT",NXT2))
"RTN","DGMHV",267,0)
 ...S TMPDT=LASTDT
"RTN","DGMHV",268,0)
 ;
"RTN","DGMHV",269,0)
 D QUESUC^DGMHVUTL(.DGMHVOUT) Q:($G(DGMHVOUT)]"")
"RTN","DGMHV",270,0)
 Q
"RTN","DGMHV",271,0)
 ;
"RTN","DGMHV",272,0)
ACTHLP ; Help at action prompt
"RTN","DGMHV",273,0)
 W !?5,"Please select one of the listed actions that most closely describes"
"RTN","DGMHV",274,0)
 W !?5,"the actions taken today to help this patient enroll in My HealtheVet."
"RTN","DGMHV",275,0)
 Q
"RTN","DGMHVAC")
0^3^B125835256
"RTN","DGMHVAC",1,0)
DGMHVAC ;HIRMFO/WAA-REACTIONS SELECT ROUTINE ;6/9/05  11:12
"RTN","DGMHVAC",2,0)
 ;;5.3;Registration;**903**;Aug 13, 1993;Build 26
"RTN","DGMHVAC",3,0)
 ;
"RTN","DGMHVAC",4,0)
 ;
"RTN","DGMHVAC",5,0)
EN(DFN) ; Entry point for MHV Enrollment 'screen'
"RTN","DGMHVAC",6,0)
 ; Allow editing only if "1" is selected, always begin with Enrolled? field, sin
ce subsequent field logic is dependent
"RTN","DGMHVAC",7,0)
 N DGMHVOUT,DGMHVQ,DGMHVI S DGMHVQ=0
"RTN","DGMHVAC",8,0)
 F DGMHVI=1:1 Q:$G(DGMHVOUT)  D
"RTN","DGMHVAC",9,0)
 .I DGMHVI=1 D DSPENR(DFN,.DGMHVOUT)
"RTN","DGMHVAC",10,0)
 .Q:$G(DGMHVOUT)!($G(DGMHVQ))
"RTN","DGMHVAC",11,0)
 .D MAIN(DFN) K ^UTILITY("DIQ1",$J)
"RTN","DGMHVAC",12,0)
 .D DSPENR(DFN,.DGMHVOUT)
"RTN","DGMHVAC",13,0)
 Q
"RTN","DGMHVAC",14,0)
 ;
"RTN","DGMHVAC",15,0)
MAIN(DFN) ; Main Driver for Enrollment 'screen'. 
"RTN","DGMHVAC",16,0)
 ; Prompt for three MHV Enrollment fields - include previously entered values as
 defaults
"RTN","DGMHVAC",17,0)
 ; Copy NO value and reason entered at any field to all subsequent fields.
"RTN","DGMHVAC",18,0)
 ; Do not prompt for subsequent field unless 'YES' is entered at current field.
"RTN","DGMHVAC",19,0)
 ; (A)ction (in progress) is treated as UNANSWERED.
"RTN","DGMHVAC",20,0)
 N DGRPFLD,DGMHV,DGMHAC,DGMHSEL,DGMHVNOW,DGRSNPT,DGRSNTXT S DGMHAC="",DGMHSEL=""
,DGMHVNOW=$$NOW^XLFDT
"RTN","DGMHVAC",21,0)
 D CLEAR^DGMHV W !!!
"RTN","DGMHVAC",22,0)
 K DIRUT W ! D ENROLLQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1 Q
"RTN","DGMHVAC",23,0)
 Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",24,0)
 ; MHV Enrolled
"RTN","DGMHVAC",25,0)
 I '$G(DGMHV("ENROLLED")) S DGRNSPT="",DGRSNTXT="" D  Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",26,0)
 .K ^UTILITY("DIQ1",$J)
"RTN","DGMHVAC",27,0)
 .N DGADFLT,DIC,DA,DR S DIQ(0)="I",DIC=2,DA=DFN,DR="537036" D EN^DIQ1 S DGADFLT=
$G(^UTILITY("DIQ1",$J,2,DFN,537036,"I"))
"RTN","DGMHVAC",28,0)
 .D GETRSN("patient is not enrolled",.DGRSNPT,.DGRSNTXT,DGADFLT,2.1) Q:$G(DGMHVO
UT)!$G(DGMHVQ)
"RTN","DGMHVAC",29,0)
 .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q
"RTN","DGMHVAC",30,0)
 .D FILRNA(DFN,537036,"@"),FILRNA(DFN,537033,"@"),FILRNA(DFN,537038,"@")
"RTN","DGMHVAC",31,0)
 .F DGRPFLD=537036:1:537038 D FILRNA(DFN,DGRPFLD,DGRSNPT)
"RTN","DGMHVAC",32,0)
 .I $P($G(^DGMHV(390.03,DGRSNPT,0)),"^")="Other" F DGRTFLD=537033:1:537035 D FIL
RNA(DFN,DGRTFLD,DGRSNTXT)
"RTN","DGMHVAC",33,0)
 .N DIE,DR,DA S DIE="^DPT(",DR="537027////"_+DGMHV("ENROLLED")_";537030////"_DGM
HVNOW,DA=DFN D ^DIE
"RTN","DGMHVAC",34,0)
 .N DIE,DR,DA S DA=DFN,DIE="^DPT(",DR="537028////0;537029////0;537031////"_DGMHV
NOW_";537032////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",35,0)
 I $G(DGMHV("ENROLLED")) N DIE,DA S DIE="^DPT(",DA=DFN,DR="537027////1;537030///
/"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",36,0)
 ; Patient Authenticated
"RTN","DGMHVAC",37,0)
 K DIRUT W ! D AUTHENQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1 Q
"RTN","DGMHVAC",38,0)
 Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",39,0)
 I '$G(DGMHV("AUTH")) S DGRNSPT="",DGRSNTXT="" D CANTXT("UP") D  Q:$G(DGMHVOUT)!
$G(DGMHVQ)
"RTN","DGMHVAC",40,0)
 .W !!,"Patient Not Authenticated Reasons"
"RTN","DGMHVAC",41,0)
 .K ^UTILITY("DIQ1",$J) N DGADFLT,DIC,DA,DR S DIQ(0)="I",DIC=2,DA=DFN,DR="537037
" D EN^DIQ1 S DGADFLT=$G(^UTILITY("DIQ1",$J,2,DFN,537037,"I"))
"RTN","DGMHVAC",42,0)
 .D GETRSN("patient is not authenticated",.DGRSNPT,.DGRSNTXT,DGADFLT,2.2) Q:$G(D
GMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",43,0)
 .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q
"RTN","DGMHVAC",44,0)
 .D FILRNA(DFN,537037,"@"),FILRNA(DFN,537034,"@"),FILRNA(DFN,537035,"@")
"RTN","DGMHVAC",45,0)
 .F DGRPFLD=537037,537038 D FILRNA(DFN,DGRPFLD,DGRSNPT)
"RTN","DGMHVAC",46,0)
 .I $P($G(^DGMHV(390.03,DGRSNPT,0)),"^")="Other" F DGRTFLD=537034:1:537035 D FIL
RNA(DFN,DGRTFLD,DGRSNTXT)
"RTN","DGMHVAC",47,0)
 .N DIE,DR,DA S DIE="^DPT(",DR="537028////"_DGMHV("AUTH")_";537031////"_DGMHVNOW
,DA=DFN D ^DIE
"RTN","DGMHVAC",48,0)
 .N DIE,DR,DA S DA=DFN,DIE="^DPT(",DR="537029////0;537032////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",49,0)
 I $G(DGMHV("AUTH"))=1 N DIE,DA S DIE="^DPT(",DA=DFN,DR="537028////1;537031////"
_DGMHVNOW D ^DIE
"RTN","DGMHVAC",50,0)
 I $G(DGMHV("AUTH"))=2 D CANTXT("UP") D  Q  ; Action entered instead of yes or n
o
"RTN","DGMHVAC",51,0)
 .N DIE,DA S DIE="^DPT(",DA=DFN,DR="537028////2;537031////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",52,0)
 .D FILRNA(DFN,537034,"@"),FILRNA(DFN,537037,"@")
"RTN","DGMHVAC",53,0)
 .W !! N DGDPTSOC S DGDPTSOC=+$O(^DPT(DFN,1,"A"),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.
DGMHSEL,DGDPTSOC,"A")
"RTN","DGMHVAC",54,0)
 .D FILACT(DFN,4,.DGMHSEL)
"RTN","DGMHVAC",55,0)
 ; Secure Messaging
"RTN","DGMHVAC",56,0)
 K DIRUT W ! D OPTINQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1
"RTN","DGMHVAC",57,0)
 Q:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",58,0)
 I '$G(DGMHV("OPTINQ")) S DGRNSPT="",DGRSNTXT="" D  Q:$G(DGMHVOUT)
"RTN","DGMHVAC",59,0)
 .K ^UTILITY("DIQ1",$J) N DGMDFLT,DIC,DA,DR S DIQ(0)="I",DIC=2,DA=DFN,DR="537038
" D EN^DIQ1 S DGMDFLT=$G(^UTILITY("DIQ1",$J,2,DFN,537038,"I"))
"RTN","DGMHVAC",60,0)
 .D GETRSN("not opted-in for secure messaging",.DGRSNPT,.DGRSNTXT,DGMDFLT,2.3) Q
:$G(DGMHVOUT)!$G(DGMHVQ)
"RTN","DGMHVAC",61,0)
 .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q
"RTN","DGMHVAC",62,0)
 .D FILRNA(DFN,537038,"@"),FILRNA(DFN,537035,"@")
"RTN","DGMHVAC",63,0)
 .N DIE,DR,DA S DA=DFN,DIE="^DPT(",DR="537029////"_DGMHV("OPTINQ")_";537032////"
_DGMHVNOW D ^DIE
"RTN","DGMHVAC",64,0)
 .N DIE,DR,DA S DIE="^DPT(",DR="537029////"_DGMHV("OPTINQ")_";537032////"_DGMHVN
OW,DA=DFN D ^DIE
"RTN","DGMHVAC",65,0)
 .D FILRNA(DFN,537038,DGRSNPT)
"RTN","DGMHVAC",66,0)
 .I $P($G(^DGMHV(390.03,DGRSNPT,0)),"^")="Other" D FILRNA(DFN,537035,DGRSNTXT)
"RTN","DGMHVAC",67,0)
 I $G(DGMHV("OPTINQ"))=1 N DIE,DA S DIE="^DPT(",DA=DFN,DR="537029////1;537032///
/"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",68,0)
 I $G(DGMHV("OPTINQ"))=2 D  Q
"RTN","DGMHVAC",69,0)
 .N DIE,DA S DIE="^DPT(",DA=DFN,DR="537029////2;537032////"_DGMHVNOW D ^DIE
"RTN","DGMHVAC",70,0)
 .D FILRNA(DFN,537035,"@"),FILRNA(DFN,537038,"@")
"RTN","DGMHVAC",71,0)
 .W !! N DGDPTSOC S DGDPTSOC=+$O(^DPT(DFN,1,"A"),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.
DGMHSEL,DGDPTSOC,"M")
"RTN","DGMHVAC",72,0)
 .D FILACT(DFN,3,.DGMHSEL)
"RTN","DGMHVAC",73,0)
 Q
"RTN","DGMHVAC",74,0)
 ;
"RTN","DGMHVAC",75,0)
ENROLLQ(MHV,DGMHVNOW) ; Prompt for "MHV Enrolled"
"RTN","DGMHVAC",76,0)
 N ENDFLT,DIR,DA,X,Y S Y=""
"RTN","DGMHVAC",77,0)
 S ENDFLT=$P($G(^DPT(DFN,2)),"^"),ENDFLT=$S(ENDFLT=1:"YES",ENDFLT=0:"NO",1:"")
"RTN","DGMHVAC",78,0)
 S DIR(0)="Y",DIR("B")=ENDFLT
"RTN","DGMHVAC",79,0)
 S DIR("A")="Is the patient enrolled in My HealtheVet (Yes/No)"
"RTN","DGMHVAC",80,0)
 K DIRUT D ^DIR  Q:$D(DIRUT)
"RTN","DGMHVAC",81,0)
 S MHV("ENROLLED")=$S($G(Y):1,1:0)
"RTN","DGMHVAC",82,0)
 Q
"RTN","DGMHVAC",83,0)
 ;
"RTN","DGMHVAC",84,0)
AUTHENQ(MHV,DGMHVNOW) ; Prompt for "MHV Authenticated"
"RTN","DGMHVAC",85,0)
 I '$G(MHV("ENROLLED")) S DGMHVQ=1 Q
"RTN","DGMHVAC",86,0)
 N AUDFLT,DIR,DA,X,Y
"RTN","DGMHVAC",87,0)
 S AUDFLT=$P($G(^DPT(DFN,2)),"^",2),AUDFLT=$S(AUDFLT=1:"YES",AUDFLT=0:"NO",1:"")
"RTN","DGMHVAC",88,0)
 S DIR(0)="SA^Y:YES;N:NO;A:ACTION",DIR("B")=AUDFLT
"RTN","DGMHVAC",89,0)
 S DIR("A",1)=""
"RTN","DGMHVAC",90,0)
 S DIR("A",2)=" Does the patient have a Premium My Healthevet account?"
"RTN","DGMHVAC",91,0)
 S DIR("A",3)="  Can the patient view VA appointments, lab results,"
"RTN","DGMHVAC",92,0)
 S DIR("A")="  and medical records online (Yes/No/(A)ction)?: "
"RTN","DGMHVAC",93,0)
 K DIRUT D ^DIR Q:$D(DIRUT)
"RTN","DGMHVAC",94,0)
 S MHV("AUTH")=$S(Y="Y":1,Y="A":2,1:0)
"RTN","DGMHVAC",95,0)
 I MHV("AUTH")'=2 S MHV("AUTH","DATE")=DGMHVNOW
"RTN","DGMHVAC",96,0)
 I MHV("AUTH")=2 N DIE,DR,DA D FILRNA(DFN,537039,"@")
"RTN","DGMHVAC",97,0)
 Q
"RTN","DGMHVAC",98,0)
 ;
"RTN","DGMHVAC",99,0)
OPTINQ(MHV,DGMHVNOW) ; Prompt for "Opted in for MHV Secure Messaging"
"RTN","DGMHVAC",100,0)
 I '$G(MHV("AUTH")) S DGMHVQ=1 Q
"RTN","DGMHVAC",101,0)
 N MSGDFLT,DIR,DA,X,Y
"RTN","DGMHVAC",102,0)
 S MSGDFLT=$P($G(^DPT(DFN,2)),"^",3),MSGDFLT=$S(MSGDFLT=1:"YES",MSGDFLT=0:"NO",1
:"")
"RTN","DGMHVAC",103,0)
 S DIR(0)="SA^Y:YES;N:NO;A:ACTION",DIR("B")=MSGDFLT
"RTN","DGMHVAC",104,0)
 S DIR("A")="Opted in for Secure Messaging (Yes/No/(A)ction)?: "
"RTN","DGMHVAC",105,0)
 K DIRUT D ^DIR Q:$D(DIRUT)
"RTN","DGMHVAC",106,0)
 S MHV("OPTINQ")=$S(Y="Y":1,Y="A":2,1:0)
"RTN","DGMHVAC",107,0)
 Q
"RTN","DGMHVAC",108,0)
 ;
"RTN","DGMHVAC",109,0)
GETRSN(TXTAD,REASPT,REASTXT,REASDFLT,DGTXTND) ; Prompt for "NO" Reason
"RTN","DGMHVAC",110,0)
 N DGDFTXT,DGMSACT,DIR,X,Y K DIRUT,DGTXTFIN,DGSCR
"RTN","DGMHVAC",111,0)
 S DGSCR=$S($G(DGTXTND)=2.1:1,$G(DGTXTND)=2.2:2,$G(DGTXTND)=2.3:3,1:"")
"RTN","DGMHVAC",112,0)
 S DGDFTXT=$$LKUPRTXT^DGMHVAC(DFN,$G(DGTXTND)),DGTXTFIN=0
"RTN","DGMHVAC",113,0)
 D GETRSNS(.DGMSACT,DGSCR)
"RTN","DGMHVAC",114,0)
 I $G(REASDFLT) N RSNSEL S RSNSEL="" F  S RSNSEL=$O(DGMSACT(RSNSEL)) Q:'RSNSEL  
I $G(DGMSACT(RSNSEL,"IEN"))=REASDFLT S REASDFLT=RSNSEL
"RTN","DGMHVAC",115,0)
 D SETDIR(.DGMSACT,TXTAD,$G(REASDFLT))
"RTN","DGMHVAC",116,0)
 S REASPT="" F  Q:$G(REASPT)!$G(DGMHVOUT)  D ^DIR S:(Y>0) REASPT=+$G(DGMSACT(Y,"
IEN")) I 'REASPT D
"RTN","DGMHVAC",117,0)
 .N DIR S DIR(0)="Y",DIR("A")="Are you sure you want to quit " D ^DIR I $G(Y)>0 
S DGMHVOUT=1
"RTN","DGMHVAC",118,0)
 .K ^UTILITY("DIQ1",$J) N DGMDFLT,DIC,DA,DR S DIQ(0)="I",DIC=2,DA=DFN,DR="537038
" D EN^DIQ1 S DGMDFLT=$G(^UTILITY("DIQ1",$J,2,DFN,537038,"I")) K ^UTILITY("DIQ1"
,$J)
"RTN","DGMHVAC",119,0)
 Q:'$G(REASPT)
"RTN","DGMHVAC",120,0)
 I $P($G(^DGMHV(390.03,REASPT,0)),"^")="Other" F  Q:$G(DGTXTFIN)!$G(DGMHVQ)  D
"RTN","DGMHVAC",121,0)
 .N DIR,X,Y S DIR("B")=$G(DGDFTXT),DIR(0)="FAO^2:250",DIR("A")="Other Reason Tex
t (250 Chars Max): " D ^DIR
"RTN","DGMHVAC",122,0)
 .I $L(Y)>2 S REASTXT=$TR(Y,";^"," ") S DGTXTFIN=1 Q
"RTN","DGMHVAC",123,0)
 .I $G(X)="@" S DGDFTXT="" W "   Deleted",!
"RTN","DGMHVAC",124,0)
 .I $G(X)="^" S DGMHVQ=1 Q
"RTN","DGMHVAC",125,0)
 Q
"RTN","DGMHVAC",126,0)
 ;
"RTN","DGMHVAC",127,0)
FILRNA(DFN,DGFIELD,DGRSPT) ; File selected NO Reason to Patient file
"RTN","DGMHVAC",128,0)
 N DIE,DA,DR
"RTN","DGMHVAC",129,0)
 S DIE="^DPT(",DA=DFN,DR=DGFIELD_"////"_DGRSPT D ^DIE
"RTN","DGMHVAC",130,0)
 Q
"RTN","DGMHVAC",131,0)
 ;
"RTN","DGMHVAC",132,0)
FILACT(DFN,DGNODE,DGACTSEL) ; File selected MHV Action(s) to Patient file
"RTN","DGMHVAC",133,0)
 N NEXT,DGCNT
"RTN","DGMHVAC",134,0)
 S NEXT="A" F  S NEXT=$O(^DPT(DFN,DGNODE,NEXT),-1) Q:'NEXT  D
"RTN","DGMHVAC",135,0)
 .N DIE,DA,DIR S DIE="^DPT("_DFN_","_DGNODE_",",DA(1)=DFN,DA=NEXT,DR=.01_"////@"
 D ^DIE
"RTN","DGMHVAC",136,0)
 S NEXT=0 F DGCNT=1:1 S NEXT=$O(DGACTSEL(NEXT)) Q:'NEXT  D
"RTN","DGMHVAC",137,0)
 .Q:'$G(DGACTSEL(NEXT,"IEN"))
"RTN","DGMHVAC",138,0)
 .N DA,DINUM,X,DIC S DIC(0)="LEZ",DIC="^DPT(DFN,DGNODE,",DA(2)=DFN,DA(1)=NEXT,DI
NUM=DA(1),X=NEXT D FILE^DICN
"RTN","DGMHVAC",139,0)
 .N DIE,DA,DIR S DIE="^DPT("_DFN_","_DGNODE_",",DA(1)=DFN,DA=DGCNT,DR=.01_"////"
_DGACTSEL(NEXT,"IEN") D ^DIE
"RTN","DGMHVAC",140,0)
 Q
"RTN","DGMHVAC",141,0)
 ;
"RTN","DGMHVAC",142,0)
GETRSNS(DGMSACT,DGSCRQ) ; Build and return array of selectable reasons from file
 390.03
"RTN","DGMHVAC",143,0)
 N ACTIEN,ACTCNT,ACTTXT,SELCNT,DGSCR S ACTCNT=0,SELCNT=0
"RTN","DGMHVAC",144,0)
 S ACTIEN=0 F  S ACTIEN=$O(^DGMHV(390.03,ACTIEN)) Q:'ACTIEN  S ACTTXT=$P($G(^DGM
HV(390.03,ACTIEN,0)),"^"),DGSCR=$P(^(0),"^",2) I ACTTXT]"" D
"RTN","DGMHVAC",145,0)
 .I $G(DGSCRQ),$G(DGSCR) Q:DGSCR'[DGSCRQ
"RTN","DGMHVAC",146,0)
 .S ACTCNT=ACTCNT+1,SELCNT=SELCNT+1,DGMSACT(ACTCNT)=ACTTXT,DGMSACT(ACTCNT,"IEN")
=ACTIEN
"RTN","DGMHVAC",147,0)
 Q
"RTN","DGMHVAC",148,0)
 ;
"RTN","DGMHVAC",149,0)
SETDIR(DGMSACT,TXTAD,DGMDEF) ; Put incoming array of reasons into DIC("A")
"RTN","DGMHVAC",150,0)
 S DIR(0)="SA^",DIR("A",1)="",DIR("B")=$G(DGMDEF)
"RTN","DGMHVAC",151,0)
 S DGACCNT=+$O(DGMSACT(""),-1)
"RTN","DGMHVAC",152,0)
 S ACTCNT=0 F  S ACTCNT=$O(DGMSACT(ACTCNT)) Q:'ACTCNT  S DIR(0)=DIR(0)_ACTCNT_":
"_DGMSACT(ACTCNT)_";",DIR("A",ACTCNT+1)="     "_ACTCNT_" - "_DGMSACT(ACTCNT)
"RTN","DGMHVAC",153,0)
 S DIR("A",$O(DIR("A","A"),-1)+1)=""
"RTN","DGMHVAC",154,0)
 S DIR("A")="Select reason "_TXTAD_": "
"RTN","DGMHVAC",155,0)
 Q
"RTN","DGMHVAC",156,0)
 ;
"RTN","DGMHVAC",157,0)
MHVOK(DFN) ; Check patient's MHV enrollment info. 
"RTN","DGMHVAC",158,0)
 ; Logic to activate/deactivate alert
"RTN","DGMHVAC",159,0)
 ; -----------------------------------
"RTN","DGMHVAC",160,0)
 ; 1. If any field contains null (UNANSWERED), return 0
"RTN","DGMHVAC",161,0)
 ; 2. If any field contains "A" (ACTION), return 0
"RTN","DGMHVAC",162,0)
 ; 3. If neither 1 nor 2 is true, and any field contains "N" (NO):
"RTN","DGMHVAC",163,0)
 ;              a. The alert is ON if the date the NO was entered is at least 6 
months prior to the current date
"RTN","DGMHVAC",164,0)
 ;              b. The alert is OFF if the date the NO was entered is less than 
6 months prior to the current date
"RTN","DGMHVAC",165,0)
 ; 4. If all fields contain "Y" (YES), return 1
"RTN","DGMHVAC",166,0)
 ;
"RTN","DGMHVAC",167,0)
 N DGIQ,MHVOK,MHVOKND,MHVEN,MHVBAD
"RTN","DGMHVAC",168,0)
 K ^UTILITY("DIQ1",$J)
"RTN","DGMHVAC",169,0)
 N DIC,DA,DR S DIQ(0)="I",DIC=2,DA=DFN,DR="537027:537032" D EN^DIQ1
"RTN","DGMHVAC",170,0)
 M MHVOK(DFN)=^UTILITY("DIQ1",$J,2,DFN) S MHVBAD=0
"RTN","DGMHVAC",171,0)
 F DGIQ=0:1:2 I $G(MHVOK(DFN,537027+DGIQ,"I"))="" S MHVBAD=1
"RTN","DGMHVAC",172,0)
 I $G(MHVBAD) Q 0
"RTN","DGMHVAC",173,0)
 F DGIQ=0:1:2 Q:$G(MHVBAD)  D
"RTN","DGMHVAC",174,0)
 .I $G(MHVOK(DFN,537027+DGIQ,"I"))=0 D  Q
"RTN","DGMHVAC",175,0)
 ..I '$G(MHVOK(DFN,537030+DGIQ,"I")) S MHVBAD=1 Q
"RTN","DGMHVAC",176,0)
 ..I $$FMDIFF^XLFDT($$NOW^XLFDT,MHVOK(DFN,537030+DGIQ,"I"))>179 S MHVBAD=1 D
"RTN","DGMHVAC",177,0)
 ...N DGQ F DGQ=537027+DGIQ:1:537029 Q:DGQ>537029  D FILRNA(DFN,DGQ,"@")
"RTN","DGMHVAC",178,0)
 .I (MHVOK(DFN,537027+DGIQ,"I")="")!(MHVOK(DFN,537027+DGIQ,"I")=2) S MHVBAD=1
"RTN","DGMHVAC",179,0)
 K ^UTILITY("DIQ",$J)
"RTN","DGMHVAC",180,0)
 Q $S($G(MHVBAD):0,1:1)
"RTN","DGMHVAC",181,0)
 ;
"RTN","DGMHVAC",182,0)
DSPENR(DFN,DGMHVFIN) ; Display patient's MHV enrollment information
"RTN","DGMHVAC",183,0)
 ; This is the MHV enrollment pseudo-screen display; allow entry of 1 to edit th
e fields as a group, in sequence.
"RTN","DGMHVAC",184,0)
 N ACTION,ACTIONE,REASON,REASONE,MHVOK,MHVOKND,MHVEN,MHVEN,MHVAU,MHVMSG,DGRSNTXT
"RTN","DGMHVAC",185,0)
 N X,Y,IORVON,IORVOFF,DIR,DIRUT,DGRSNCNT
"RTN","DGMHVAC",186,0)
 ;
"RTN","DGMHVAC",187,0)
 D HEADER(DFN)
"RTN","DGMHVAC",188,0)
 K MHVOK N DIC,DA,DR S DIQ(0)="I",DIC=2,DA=DFN,DR="537027:537040" D GETS^DIQ(DIC
,DFN,DR,"I","MHVOK")
"RTN","DGMHVAC",189,0)
 S MHVEN=$G(MHVOK(2,DFN_",",537027,"I")),MHVAU=$G(MHVOK(2,DFN_",",537028,"I")),M
HVMSG=$G(MHVOK(2,DFN_",",537029,"I"))
"RTN","DGMHVAC",190,0)
 S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","DGMHVAC",191,0)
 W !!!,"[1]       Enrolled: ",$S(MHVEN=0:"NO",MHVEN=1:"YES",1:"UNANSWERED")
"RTN","DGMHVAC",192,0)
 I MHVEN=0 S REASON=$G(MHVOK(2,DFN_",",537036,"I")) I REASON W !?12,"Reason: " S
 REASONE=$$LKUPRSN(REASON) D
"RTN","DGMHVAC",193,0)
 .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT(DFN,2.1) I (REASONE="Other")&($L(DGRSNTXT)>2)
 S REASONE=REASONE_" - "_DGRSNTXT
"RTN","DGMHVAC",194,0)
 .N MARX,I,LINE D TXT^DGMHV(REASONE,58) F I=1:1:$O(MARX(""),-1) S LINE=$G(MARX(I
)) D
"RTN","DGMHVAC",195,0)
 ..I I=1 W LINE S DGRSNCNT=1 Q
"RTN","DGMHVAC",196,0)
 ..W !?20,LINE
"RTN","DGMHVAC",197,0)
 ;
"RTN","DGMHVAC",198,0)
 W !!?5,"Authenticated: ",$S(MHVAU=0:"NO",MHVAU=1:"YES",MHVAU=2:"ACTION/IN PROGR
ESS",1:"UNANSWERED")
"RTN","DGMHVAC",199,0)
 I MHVAU=0,'$G(DGRSNCNT) S REASON=$G(MHVOK(2,DFN_",",537037,"I")) I REASON W !?1
2,"Reason: " S REASONE=$$LKUPRSN(REASON) D
"RTN","DGMHVAC",200,0)
 .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT(DFN,2.2) I (REASONE="Other")&($L(DGRSNTXT)>2)
 S REASONE=REASONE_" - "_DGRSNTXT
"RTN","DGMHVAC",201,0)
 .N MARX,I,LINE D TXT^DGMHV(REASONE,58) F I=1:1:$O(MARX(""),-1) S LINE=$G(MARX(I
)) D
"RTN","DGMHVAC",202,0)
 ..I I=1 W LINE S DGRSNCNT=1 Q
"RTN","DGMHVAC",203,0)
 ..W !?21,LINE
"RTN","DGMHVAC",204,0)
 I MHVAU=2 N ACTIEN S ACTIEN="" F  S ACTIEN=$O(^DPT(DFN,4,"B",ACTIEN)) Q:ACTIEN=
""  D
"RTN","DGMHVAC",205,0)
 .N ACTXT,LI S ACTXT=$P($G(^DGMHV(390.02,+ACTIEN,0)),"^") Q:$L(ACTXT)<2  N MARX,
INOD,LINE D TXT^DGMHV(ACTXT,60) F INOD=1:1:$O(MARX(""),-1) S LINE=$G(MARX(INOD))
 D
"RTN","DGMHVAC",206,0)
 ..I INOD=1 W !?12,"Action: ",LINE S DGRSNCNT=1 Q
"RTN","DGMHVAC",207,0)
 ..W !?20,LINE
"RTN","DGMHVAC",208,0)
 ;
"RTN","DGMHVAC",209,0)
 W !!?2,"Secure Messaging: ",$S(MHVMSG=0:"NO",MHVMSG=1:"YES",MHVMSG=2:"ACTION/IN
 PROGRESS",1:"UNANSWERED")
"RTN","DGMHVAC",210,0)
 I MHVMSG=0,'$G(DGRSNCNT) S REASON=$G(MHVOK(2,DFN_",",537038,"I")) I REASON W !?
12,"Reason: " S REASONE=$$LKUPRSN(REASON) D
"RTN","DGMHVAC",211,0)
 .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT(DFN,2.3) I REASONE="Other"&($L(DGRSNTXT)>2) S
 REASONE=REASONE_" - "_DGRSNTXT
"RTN","DGMHVAC",212,0)
 .N MARX,I,LINE D TXT^DGMHV(REASONE,60) F I=1:1:$O(MARX(""),-1) S LINE=$G(MARX(I
)) D
"RTN","DGMHVAC",213,0)
 ..I I=1 W LINE S DGRSNCNT=1 Q
"RTN","DGMHVAC",214,0)
 ..W !?20,LINE
"RTN","DGMHVAC",215,0)
 I MHVMSG=2 N ACTIEN S ACTIEN="" F  S ACTIEN=$O(^DPT(DFN,3,"B",ACTIEN)) Q:ACTIEN
=""  D
"RTN","DGMHVAC",216,0)
 .N ACTXT,LI S ACTXT=$P($G(^DGMHV(390.02,+ACTIEN,0)),"^") Q:$L(ACTXT)<2  N MARX,
INOD,LINE D TXT^DGMHV(ACTXT,60) F INOD=1:1:$O(MARX(""),-1) S LINE=$G(MARX(INOD))
 D
"RTN","DGMHVAC",217,0)
 ..I INOD=1 W !?12,"Action: ",LINE S DGRSNCNT=1 Q
"RTN","DGMHVAC",218,0)
 ..W !?20,LINE
"RTN","DGMHVAC",219,0)
 W !!!!!!!
"RTN","DGMHVAC",220,0)
 K DIRUT S DGMHVOUT=0,DGMHVQ=0
"RTN","DGMHVAC",221,0)
 N DIR S DIR("A")="  Enter 1 to edit, or RETURN to continue" S DIR(0)="FO" D ^DI
R S DGMHVOUT=$S(Y=1:0,1:1) Q
"RTN","DGMHVAC",222,0)
 Q
"RTN","DGMHVAC",223,0)
 ;
"RTN","DGMHVAC",224,0)
LKUPRSN(REASON) ; Lookup "NO" Reason in file 390.03
"RTN","DGMHVAC",225,0)
 N DIC,X S DIC="390.03",DIC(0)="ZU",X=+REASON D ^DIC
"RTN","DGMHVAC",226,0)
 Q $P($G(Y(0)),"^")
"RTN","DGMHVAC",227,0)
 ;
"RTN","DGMHVAC",228,0)
LKUPRTXT(DFN,DGRFIELD) ; Lookup "OTHER" Reason free text from PATIENT (#2) file
"RTN","DGMHVAC",229,0)
 S DGRSNTXT=$P($G(^DPT(+DFN,+DGRFIELD)),"^")
"RTN","DGMHVAC",230,0)
 Q $S($L(DGRSNTXT)>2:DGRSNTXT,1:"")
"RTN","DGMHVAC",231,0)
 ;
"RTN","DGMHVAC",232,0)
LKUPACT(ACTION) ; Lookup MHV Action in file 390.02
"RTN","DGMHVAC",233,0)
 N DIC,X S DIC="390.02",DIC(0)="ZU",X=+ACTION D ^DIC
"RTN","DGMHVAC",234,0)
 Q $G(Y(0))
"RTN","DGMHVAC",235,0)
 Q
"RTN","DGMHVAC",236,0)
 ;
"RTN","DGMHVAC",237,0)
HEADER(DFN) ; Print simulated screen header
"RTN","DGMHVAC",238,0)
 N DGPTINFO,DGSCST K ^UTILITY("DIQ1",$J)
"RTN","DGMHVAC",239,0)
 N DIC,DA,DR S DIQ(0)="E",DIC=2,DA=DFN,DR=".01;391" D EN^DIQ1 M DGPTINFO(DFN)=^U
TILITY("DIQ1",$J,2,DFN)
"RTN","DGMHVAC",240,0)
 D CLEAR^DGMHV
"RTN","DGMHVAC",241,0)
 W !!?20,"MY HEALTHEVET ENROLLMENT DATA"
"RTN","DGMHVAC",242,0)
 S DGNMSSN=$$SSNNM^DGRPU(DFN)
"RTN","DGMHVAC",243,0)
 W !!,DGNMSSN,?60,$G(DGPTINFO(DFN,391,"E"))
"RTN","DGMHVAC",244,0)
 W !,"==========================================================================
======"
"RTN","DGMHVAC",245,0)
 K ^UTILITY("DIQ1",$J)
"RTN","DGMHVAC",246,0)
 Q
"RTN","DGMHVAC",247,0)
 ;
"RTN","DGMHVAC",248,0)
CANTXT(DGMSG) ; Display canned text to read to patient
"RTN","DGMHVAC",249,0)
 Q:$G(DGMSG)']""
"RTN","DGMHVAC",250,0)
 N NEXT,CANTXT,MARX S CANTXT=$T(@DGMSG),CANTXT=$P(CANTXT,";",2) Q:CANTXT']""
"RTN","DGMHVAC",251,0)
 D CLEAR^DGMHV
"RTN","DGMHVAC",252,0)
 W !!?15,"Please read the following to the patient",!!
"RTN","DGMHVAC",253,0)
 D TXT^DGMHV(.CANTXT,60)
"RTN","DGMHVAC",254,0)
 S NEXT=0 F  S NEXT=$O(MARX(NEXT)) Q:'NEXT  D
"RTN","DGMHVAC",255,0)
 .W !?6,MARX(NEXT)
"RTN","DGMHVAC",256,0)
 W !! D CONT^DGMHV
"RTN","DGMHVAC",257,0)
 Q
"RTN","DGMHVAC",258,0)
 ;
"RTN","DGMHVAC",259,0)
UP ;"Upgrade to a Premium My HealtheVet account to view parts of your VA health 
record. This requires one-time in-person identity verification (show photo ID). 
Read and sign this Release of Information form (10-5345a-MHV)."
"RTN","DGMHVAC",260,0)
 Q
"RTN","DGMHVAC",261,0)
LASTACHK(DFN,ACTXT) ; Check if ACTXT contains the text matching the most recent 
ACTION entered for patient DFN
"RTN","DGMHVAC",262,0)
 N DGMATCH,DGLST5,DGLST1,DGL1TXT S DGMATCH=0,DGLST5=""
"RTN","DGMHVAC",263,0)
 D GETLACT^DGMHVUTL(DFN,.DGLST5) S DGLST1=$O(DGLST5($$NOW^XLFDT),-1),DGL1TXT=$G(
DGLST5(DGLST1,1,"TXT",1))
"RTN","DGMHVAC",264,0)
 I $E(ACTXT,1,$L(DGL1TXT))=DGL1TXT S DGMATCH=1
"RTN","DGMHVAC",265,0)
 Q $S($G(DGMATCH):1,1:0)
"RTN","DGMHVUTL")
0^4^B13845318
"RTN","DGMHVUTL",1,0)
DGMHVUTL ;ALB/JCH - Patient MHV Enrollment - Utilities ;09/12/14 11:30am
"RTN","DGMHVUTL",2,0)
 ;;5.3;Registration;**903**;August 13, 1993;Build 26
"RTN","DGMHVUTL",3,0)
 ;
"RTN","DGMHVUTL",4,0)
 Q
"RTN","DGMHVUTL",5,0)
QUESUC(DGMHVOUT) ; If last action entered by clerk was one of the first four Soc
ialization (MHV enrolled) actions,
"RTN","DGMHVUTL",6,0)
 ;                 display/prompt the "were you successful" message/question
"RTN","DGMHVUTL",7,0)
 ;
"RTN","DGMHVUTL",8,0)
 N DGSUPTXT,DGSUP1,DGSUP2,DGSUP3,DGACT1,DGACT2,DGACT3,DGACT4
"RTN","DGMHVUTL",9,0)
 S DGMHVOUT=$G(DGMHVOUT)
"RTN","DGMHVUTL",10,0)
 S DGACT1="Helped patient to create a MHV account."
"RTN","DGMHVUTL",11,0)
 S DGACT2="Scheduled future appointment for patient to enroll at MHV office/stat
ion."
"RTN","DGMHVUTL",12,0)
 S DGACT3="Referred patient to the MHV office/station for assistance with enroll
ment."
"RTN","DGMHVUTL",13,0)
 S DGACT4="Gave patient MHV enrollment instructions to complete at a MHV kiosk/c
omputer or at home."
"RTN","DGMHVUTL",14,0)
 S DGSUP1="Were you successful in creating your My HealtheVet account?"
"RTN","DGMHVUTL",15,0)
 S DGSUP2=$P(DGSUP1,"?")_" during your last visit?"
"RTN","DGMHVUTL",16,0)
 S DGSUP3="Were you able to create a My HealtheVet account from the enrollment i
nstructions we gave you last time?"
"RTN","DGMHVUTL",17,0)
 S DGSUPTXT=$S($$LASTACHK^DGMHVAC(DFN,DGACT1)!$$LASTACHK^DGMHVAC(DFN,DGACT2):DGS
UP2,$$LASTACHK^DGMHVAC(DFN,DGACT3):DGSUP1,$$LASTACHK^DGMHVAC(DFN,DGACT4):DGSUP3,
1:"")
"RTN","DGMHVUTL",18,0)
 I DGSUPTXT]"" D  Q
"RTN","DGMHVUTL",19,0)
 .Q:$P($G(^DPT(DFN,2)),"^")
"RTN","DGMHVUTL",20,0)
 .N NXT,MARX,DIR,DGTXTCNT S DIR(0)="YA",DIR("A",1)=" Please read the following t
o the patient:"
"RTN","DGMHVUTL",21,0)
 .S DIR("?")=" Enter the patient's response to the question"
"RTN","DGMHVUTL",22,0)
 .D TXT^DGMHV(DGSUPTXT,55) S DGTXTCNT=0,NXT=3 F  S DGTXTCNT=$O(MARX(DGTXTCNT)) Q
:'DGTXTCNT  D
"RTN","DGMHVUTL",23,0)
 ..I '$O(MARX(DGTXTCNT)) S DIR("A")="       "_MARX(DGTXTCNT)_""""_" (Y/N): " Q
"RTN","DGMHVUTL",24,0)
 ..S DIR("A",NXT)="      """_MARX(DGTXTCNT),NXT=$G(NXT)+1
"RTN","DGMHVUTL",25,0)
 .W ! D ^DIR S DGMHVOUT=$S(Y=1:"E",Y=0:"A",1:"")
"RTN","DGMHVUTL",26,0)
 .I $G(DGMHVOUT)="E" N DIE,DA S DIE="^DPT(",DA=DFN,DR="537027////1;537030////"_$
$NOW^XLFDT D ^DIE
"RTN","DGMHVUTL",27,0)
 .H .5
"RTN","DGMHVUTL",28,0)
 Q
"RTN","DGMHVUTL",29,0)
 ;
"RTN","DGMHVUTL",30,0)
GETLACT(DFN,DGLACTS) ; Get most recent MHV actions entered by clerk for patient 
DFN
"RTN","DGMHVUTL",31,0)
 ; Input: DFN - Patient IEN
"RTN","DGMHVUTL",32,0)
 ; Output: DGLACTS - Array of MHV actions
"RTN","DGMHVUTL",33,0)
 ;
"RTN","DGMHVUTL",34,0)
 N DGOT,LASTCNT,ACTCNT,X,X1,Y,LASTDT,LASTACT,LASTIEN,ACTCNT,FNDACT,LIENOK S (LAS
TACT,LASTIEN,DGLACTS,LASTCNT)=""
"RTN","DGMHVUTL",35,0)
 S LASTDT="" F LASTCNT=1:1 S LASTDT=$O(^DPT(DFN,1,"B",LASTDT),-1) Q:'LASTDT!($G(
DGOT)>4)  D
"RTN","DGMHVUTL",36,0)
 .F  S LASTIEN=$O(^DPT(DFN,1,"B",LASTDT,LASTIEN)) Q:'LASTIEN  D
"RTN","DGMHVUTL",37,0)
 ..Q:'$O(^DPT(DFN,1,LASTIEN,1,0))  S ACTCNT("DT",LASTIEN)=LASTDT,FNDACT=1,LIENOK
=LASTIEN,DGOT=$G(DGOT)+1
"RTN","DGMHVUTL",38,0)
 Q:'$G(LIENOK)
"RTN","DGMHVUTL",39,0)
 S LIENOK="" F  S LIENOK=$O(ACTCNT("DT",LIENOK)) Q:'LIENOK  N LASTDT S LASTDT=$G
(ACTCNT("DT",LIENOK)) D
"RTN","DGMHVUTL",40,0)
 .S ACTCNT=0 F  S ACTCNT=$O(^DPT(DFN,1,LIENOK,1,ACTCNT)) Q:'ACTCNT  S ACTCNT(LAS
TDT,ACTCNT)=^DPT(DFN,1,LIENOK,1,ACTCNT,0) D
"RTN","DGMHVUTL",41,0)
 ..N DIC,X S DIC="^DGMHV(390.02,",DIC(0)="NUX",X=ACTCNT(LASTDT,ACTCNT) D ^DIC I 
Y>0 S ACTCNT(LASTDT,ACTCNT,"TXT")=$P(Y,"^",2) D
"RTN","DGMHVUTL",42,0)
 ...S ACTCNT(LASTDT,ACTCNT,"IEN")=ACTCNT(LASTDT,ACTCNT)
"RTN","DGMHVUTL",43,0)
 ...N MARX D TXT^DGMHV(ACTCNT(LASTDT,ACTCNT,"TXT"),60) M ACTCNT(LASTDT,ACTCNT,"T
XT")=MARX
"RTN","DGMHVUTL",44,0)
 S LASTDT=$O(ACTCNT(0)) I $O(ACTCNT(0)) M DGLACTS=ACTCNT
"RTN","DGMHVUTL",45,0)
 Q
"RTN","DGMHVUTL",46,0)
 ;
"RTN","DGMHVUTL",47,0)
ACTSCRN(ACTIEN,LOCLIST) ; Check on code/functional locations at which MHV action
s are selectable
"RTN","DGMHVUTL",48,0)
 ; Accepts an ACTION (#390.02) file IEN, returns array LOCLIST(LOC) where LOC is
 a location at which the action is selectable
"RTN","DGMHVUTL",49,0)
 ;
"RTN","DGMHVUTL",50,0)
 Q:'$G(ACTIEN)  K LOCLIST S LOCLIST=""
"RTN","DGMHVUTL",51,0)
 N ACTLOCN Q:'$D(^DGMHV(390.02,+ACTIEN,1))
"RTN","DGMHVUTL",52,0)
 S ACTLOCN=0 F  S ACTLOCN=$O(^DGMHV(390.02,ACTIEN,1,ACTLOCN)) Q:'ACTLOCN  D
"RTN","DGMHVUTL",53,0)
 .S LOCLIST=$G(^DGMHV(390.02,ACTIEN,1,ACTLOCN,0)) I LOCLIST S LOCLIST=$P($G(^DGM
HV(390.04,LOCLIST,0)),"^") I LOCLIST]"" S LOCLIST(LOCLIST)=""
"RTN","DGMHVUTL",54,0)
 Q
"RTN","DGPREP1")
0^2^B37209454
"RTN","DGPREP1",1,0)
DGPREP1 ;ALB/SCK - Program to Display Pre-Registration List Cont. 1 ; 12/9/03 3:
22pm
"RTN","DGPREP1",2,0)
 ;;5.3;Registration;**109,136,574,903**;Aug 13, 1993;Build 26
"RTN","DGPREP1",3,0)
 Q
"RTN","DGPREP1",4,0)
EH ; Edit call log information
"RTN","DGPREP1",5,0)
 ;   Variables
"RTN","DGPREP1",6,0)
 ;     PTIFN - Patients IEN returned form the SELPAT procedure 
"RTN","DGPREP1",7,0)
 ;
"RTN","DGPREP1",8,0)
 N PTIFN,D,X,DA,DR
"RTN","DGPREP1",9,0)
 S PTIFN=""
"RTN","DGPREP1",10,0)
 D SELPAT
"RTN","DGPREP1",11,0)
 Q:'$D(PTIFN)
"RTN","DGPREP1",12,0)
 S DIC="^DGS(41.43,",DIC(0)="EQZ"
"RTN","DGPREP1",13,0)
 S X=PTIFN,D="C"
"RTN","DGPREP1",14,0)
 S DIC("A")="Select LOG ENTRY: "
"RTN","DGPREP1",15,0)
 S DIC("S")="I $P(^(0),U,2)=PTIFN"
"RTN","DGPREP1",16,0)
 ;
"RTN","DGPREP1",17,0)
 D IX^DIC K DIC
"RTN","DGPREP1",18,0)
 ;
"RTN","DGPREP1",19,0)
 I Y>0 D
"RTN","DGPREP1",20,0)
 . S DA=+Y
"RTN","DGPREP1",21,0)
 . S DIE="^DGS(41.43,"
"RTN","DGPREP1",22,0)
 . S DR="3;2///^S X=$P(^VA(200,DUZ,0),U)"
"RTN","DGPREP1",23,0)
 . D ^DIE K DIE
"RTN","DGPREP1",24,0)
 . I '$D(Y) D
"RTN","DGPREP1",25,0)
 .. S DGPDFN=PTIFN
"RTN","DGPREP1",26,0)
 .. D BLDHIST^DGPREP0
"RTN","DGPREP1",27,0)
 .. S X=$$SETSTR^VALM1(^TMP("DGPRERG",$J,DGPCH,0),"",1,110)
"RTN","DGPREP1",28,0)
 .. S X=$$SETFLD^VALM1(DGPTAT,X,"HIST")
"RTN","DGPREP1",29,0)
 .. S ^TMP("DGPRERG",$J,DGPCH,0)=X
"RTN","DGPREP1",30,0)
 S VALMBCK="R"
"RTN","DGPREP1",31,0)
 Q
"RTN","DGPREP1",32,0)
 ;
"RTN","DGPREP1",33,0)
SELPAT ;  Select patient if no patient is passed in
"RTN","DGPREP1",34,0)
 N VALMI,VALMAT,VALMY,X
"RTN","DGPREP1",35,0)
 D FULL^VALM1
"RTN","DGPREP1",36,0)
 D EN^VALM2(XQORNOD(0),"S") S VALMI=0
"RTN","DGPREP1",37,0)
 I '$D(VALMY) S VALMBCK="R" Q
"RTN","DGPREP1",38,0)
 S DGPN1="",DGPCH=$O(VALMY(DGPN1))
"RTN","DGPREP1",39,0)
 S PTIFN="",PTIFN=$O(^TMP("DGPRERG",$J,"DFN",DGPCH,PTIFN))
"RTN","DGPREP1",40,0)
 Q
"RTN","DGPREP1",41,0)
 ;
"RTN","DGPREP1",42,0)
EDIT ;  Edit Patient Information
"RTN","DGPREP1",43,0)
 ;  Variables
"RTN","DGPREP1",44,0)
 ;   DGPDIV    - Division IEN from ^TMP
"RTN","DGPREP1",45,0)
 ;   DGPSTMP   - Date/Time stamp from UPDLOG function
"RTN","DGPREP1",46,0)
 ;   DGPIFN    - Patients IEN from ^TMP
"RTN","DGPREP1",47,0)
 ;   DGPP1-3,5 - Local Var's for $O
"RTN","DGPREP1",48,0)
 ;   DGPNEW    - 
"RTN","DGPREP1",49,0)
 ;   DGPFLG    - Flag used to indicate a connect status of 'C'
"RTN","DGPREP1",50,0)
 ;   DGPST     - Call status returned by SELST function
"RTN","DGPREP1",51,0)
 ;   DGPDA     - IEN of Call log entry returned from UPDLOG function
"RTN","DGPREP1",52,0)
 ;   DGPCH     - Entry in the VALMY, selected entries, array
"RTN","DGPREP1",53,0)
 ;   
"RTN","DGPREP1",54,0)
 N VALMI,VALMAT,VALMY,X,DGPN5,DGPDIV,DGPSTMP,DGPIFN,DGPP1,DGPP2,DGPP3,DGPNEW,DGP
FLG
"RTN","DGPREP1",55,0)
 ;
"RTN","DGPREP1",56,0)
 D FULL^VALM1
"RTN","DGPREP1",57,0)
 D EN^VALM2(XQORNOD(0),"S") S VALMI=0
"RTN","DGPREP1",58,0)
 I '$D(VALMY) S VALMBCK="R" Q
"RTN","DGPREP1",59,0)
 S DGPN1="",DGPCH=$O(VALMY(DGPN1))
"RTN","DGPREP1",60,0)
 S DGPIFN="",DGPIFN=$O(^TMP("DGPRERG",$J,"DFN",DGPCH,DGPIFN))
"RTN","DGPREP1",61,0)
 S DGPDIV="",DGPDIV=$O(^TMP("DGPRERG",$J,"DIV",DGPCH,DGPDIV))
"RTN","DGPREP1",62,0)
 S DGNEW=0,DGPFLG=0
"RTN","DGPREP1",63,0)
 ;
"RTN","DGPREP1",64,0)
 ; *** Check patient sensitivity before proceeding
"RTN","DGPREP1",65,0)
 S DIC=2,DIC(0)="ENQ",X=DGPIFN D ^DIC K DIC
"RTN","DGPREP1",66,0)
 Q:Y<0
"RTN","DGPREP1",67,0)
 ;
"RTN","DGPREP1",68,0)
 ; *** Check lock status before continuing
"RTN","DGPREP1",69,0)
 S DGPN5="",DGPN5=$O(^DGS(41.42,"B",DGPIFN,DGPN5))
"RTN","DGPREP1",70,0)
 I DGPN5]"" L +^DGS(41.42,DGPN5):2 I '$T W *7,!,"Another User is Editing this Pa
tient" S VALMBCK="R" Q
"RTN","DGPREP1",71,0)
 ;
"RTN","DGPREP1",72,0)
 S (DA,DFN)=DGPIFN
"RTN","DGPREP1",73,0)
 ;
"RTN","DGPREP1",74,0)
 S DGPFLG=1
"RTN","DGPREP1",75,0)
 S DGPSTMP=""
"RTN","DGPREP1",76,0)
 D INITLE(.DGPSTMP)
"RTN","DGPREP1",77,0)
 ;
"RTN","DGPREP1",78,0)
 I DGPCH]""&(DGPFLG) D
"RTN","DGPREP1",79,0)
 . S X=$$SETSTR^VALM1(^TMP("DGPRERG",$J,DGPCH,0),"",1,110)
"RTN","DGPREP1",80,0)
 . ;S X=$$SETSTR^VALM1("*",X,8,1)
"RTN","DGPREP1",81,0)
 . I $G(DGPSTMP)]"" S X=$$SETSTR^VALM1($$FMTE^XLFDT(DGPSTMP,"2D"),X,70,8)
"RTN","DGPREP1",82,0)
 . S ^TMP("DGPRERG",$J,DGPCH,0)=X
"RTN","DGPREP1",83,0)
 . S DIE="^DGS(41.42,",DA=DGPN5
"RTN","DGPREP1",84,0)
 . S DR="4///Y" I DGPSTMP]"" S DR=DR_";3///^S X=DGPSTMP"
"RTN","DGPREP1",85,0)
 . D ^DIE K DIE
"RTN","DGPREP1",86,0)
 L -^DGS(41.42,DGPN5)
"RTN","DGPREP1",87,0)
 K DGPENT,DGPN1,DGPCH,DGPLOC,DGPST,DGPN5,DGPFLG
"RTN","DGPREP1",88,0)
 Q
"RTN","DGPREP1",89,0)
 ;
"RTN","DGPREP1",90,0)
INITLE(DGPY) ; Initialize for Load/Edit
"RTN","DGPREP1",91,0)
 ;   Variables
"RTN","DGPREP1",92,0)
 ;     Input:
"RTN","DGPREP1",93,0)
 ;        DGPY - Null value
"RTN","DGPREP1",94,0)
 ;
"RTN","DGPREP1",95,0)
 ;     Returns:
"RTN","DGPREP1",96,0)
 ;        DGPY - Returns the date/time stamp entered into ^DGS(41.41,.
"RTN","DGPREP1",97,0)
 ;
"RTN","DGPREP1",98,0)
 ;     Local:
"RTN","DGPREP1",99,0)
 ;        DGPRFLG - This flag is used by the Patient Load/Edit routines
"RTN","DGPREP1",100,0)
 ;                  to indicate they were called by preregistration
"RTN","DGPREP1",101,0)
 ;        DGPLOC  - Flag used by DG10 to indicate preselection of a patient
"RTN","DGPREP1",102,0)
 ;
"RTN","DGPREP1",103,0)
 N DGPRFLG
"RTN","DGPREP1",104,0)
 S (DGPRFLG,DGPLOC)=1
"RTN","DGPREP1",105,0)
 W !!
"RTN","DGPREP1",106,0)
 D ^DG10
"RTN","DGPREP1",107,0)
 Q:$G(DGPFLG)&($G(DGRPOUT))
"RTN","DGPREP1",108,0)
 ;
"RTN","DGPREP1",109,0)
 S DGPST=$$SELST
"RTN","DGPREP1",110,0)
 I DGPST']"" S VALMBCK="R" Q
"RTN","DGPREP1",111,0)
 ;
"RTN","DGPREP1",112,0)
 I DGPST'="L" D
"RTN","DGPREP1",113,0)
 . S DGPDA=$$UPDLOG(DGPIFN,DGPST,DGPDIV) Q:DGPDA'>0
"RTN","DGPREP1",114,0)
 . I '$G(DGMODE),$P($G(^DGS(41.43,DGPDA,0)),U,4)]"" D
"RTN","DGPREP1",115,0)
 .. S X=$$SETSTR^VALM1(^TMP("DGPRERG",$J,DGPCH,0),"",1,110)
"RTN","DGPREP1",116,0)
 .. S DGPP1=$E(X,1,34),DGPP2=$E(X,35,38),DGPP3=$E(X,39,110)
"RTN","DGPREP1",117,0)
 .. S DGPP2=$P(^DGS(41.43,DGPDA,0),U,4)_DGPP2
"RTN","DGPREP1",118,0)
 .. S X=DGPP1_$E(DGPP2,1,4)_DGPP3
"RTN","DGPREP1",119,0)
 .. S ^TMP("DGPRERG",$J,DGPCH,0)=X
"RTN","DGPREP1",120,0)
 ;
"RTN","DGPREP1",121,0)
 W !
"RTN","DGPREP1",122,0)
 S DIR(0)="YA",DIR("A")="Date/Time stamp this patient? ",DIR("B")="YES"
"RTN","DGPREP1",123,0)
 D ^DIR K DIR
"RTN","DGPREP1",124,0)
 W !
"RTN","DGPREP1",125,0)
 I Y D
"RTN","DGPREP1",126,0)
 . K DD,DO
"RTN","DGPREP1",127,0)
 . S DGPY=$$NOW^XLFDT
"RTN","DGPREP1",128,0)
 . S DIC="^DGS(41.41,",DIC(0)="EQZ",X=DFN
"RTN","DGPREP1",129,0)
 . S DIC("DR")="1///^S X=DGPY;2////^S X=DUZ"
"RTN","DGPREP1",130,0)
 . D FILE^DICN
"RTN","DGPREP1",131,0)
 . K DIC
"RTN","DGPREP1",132,0)
 ;
"RTN","DGPREP1",133,0)
 Q
"RTN","DGPREP1",134,0)
STAT ; Display call history
"RTN","DGPREP1",135,0)
 K PTIFN D SELPAT
"RTN","DGPREP1",136,0)
 I $D(PTIFN) D
"RTN","DGPREP1",137,0)
 . D EN^DGPREP2
"RTN","DGPREP1",138,0)
 K PTIFN
"RTN","DGPREP1",139,0)
 Q
"RTN","DGPREP1",140,0)
 ;
"RTN","DGPREP1",141,0)
SELST() ;  Function to select status for call log
"RTN","DGPREP1",142,0)
 ;   Returns:
"RTN","DGPREP1",143,0)
 ;       Status code as a SOC
"RTN","DGPREP1",144,0)
 ;
"RTN","DGPREP1",145,0)
 K DIRUT
"RTN","DGPREP1",146,0)
 N DIR
"RTN","DGPREP1",147,0)
 W !!
"RTN","DGPREP1",148,0)
 S DIR(0)="41.43,3"
"RTN","DGPREP1",149,0)
 S DIR("A")="STATUS OF CALL",DIR("B")="CONNECTED"
"RTN","DGPREP1",150,0)
 S DIR("?",1)="Enter the status of the current call from the list below."
"RTN","DGPREP1",151,0)
 S DIR("?")="Entries must be in uppercase, and match on of these codes."
"RTN","DGPREP1",152,0)
 D ^DIR K DIR
"RTN","DGPREP1",153,0)
 Q $G(Y)
"RTN","DGPREP1",154,0)
 ;
"RTN","DGPREP1",155,0)
UPDLOG(DFN,DGPS,DGPDV) ;  Update PRE-REGISTRATION CALL LOG File, #41.43
"RTN","DGPREP1",156,0)
 ;
"RTN","DGPREP1",157,0)
 ;  Variables
"RTN","DGPREP1",158,0)
 ;    Input:
"RTN","DGPREP1",159,0)
 ;       DFN   - The IEN of the patient being called
"RTN","DGPREP1",160,0)
 ;       DGPS  - Status of the call attempt
"RTN","DGPREP1",161,0)
 ;       DGPDV - Division IEN (used for sorting)
"RTN","DGPREP1",162,0)
 ;
"RTN","DGPREP1",163,0)
 ;    Returns:
"RTN","DGPREP1",164,0)
 ;        The IEN of the CALL LOG, File #41.43, entry that was added. 
"RTN","DGPREP1",165,0)
 ;        0 is returned if the user ^'s out.
"RTN","DGPREP1",166,0)
 ;
"RTN","DGPREP1",167,0)
 K DD,DO
"RTN","DGPREP1",168,0)
 S DIC="^DGS(41.43,"
"RTN","DGPREP1",169,0)
 S DIC(0)="L"
"RTN","DGPREP1",170,0)
 S X=$$NOW^XLFDT
"RTN","DGPREP1",171,0)
 D FILE^DICN
"RTN","DGPREP1",172,0)
 I Y<0 W *7,"Problem adding to file - PRE-REGISTRATION CALL LOG"
"RTN","DGPREP1",173,0)
 I Y'<0 D
"RTN","DGPREP1",174,0)
 . S DIE="^DGS(41.43,"
"RTN","DGPREP1",175,0)
 . S DR="1////^S X=DFN;2////^S X=DUZ;3///^S X=DGPS;5////^S X=$S(+DGPDV>0:DGPDV,1
:"""")"
"RTN","DGPREP1",176,0)
 . S DA=+Y
"RTN","DGPREP1",177,0)
 . D ^DIE K DIE
"RTN","DGPREP1",178,0)
 . I $D(Y) D 
"RTN","DGPREP1",179,0)
 .. S DIK="^DGS(41.43," D ^DIK K DIK
"RTN","DGPREP1",180,0)
 Q +$G(DA)
"RTN","DGPREP1",181,0)
 ;
"RTN","DGPREP1",182,0)
DIREDT ;  Direct edit of a patient in the PRE-REGISTRATION CALL LIST, bypassing 
the call list.
"RTN","DGPREP1",183,0)
 ;
"RTN","DGPREP1",184,0)
 ;  Variables
"RTN","DGPREP1",185,0)
 ;    DFN    - Patients IEN, set for Load/Edit
"RTN","DGPREP1",186,0)
 ;    DGPDIV - Division IEN from File #41.42
"RTN","DGPREP1",187,0)
 ;    DGPST  - Call Status
"RTN","DGPREP1",188,0)
 ;    DGPIDX - Call List IEN, File #41.42
"RTN","DGPREP1",189,0)
 ;    DGPFLG - Flag for direct patient edit, used for setting 'called' status
"RTN","DGPREP1",190,0)
 ;    DGPSTMP - Date/time stamp
"RTN","DGPREP1",191,0)
 ;
"RTN","DGPREP1",192,0)
 N DFN,DGPDIV,DGPST,DGPIDX,DGPFLG,DGNEW,DGPXX,DGPSTMP,DGPX,DGPIFN,DGMODE
"RTN","DGPREP1",193,0)
 N DGRPOUT,DGMHVOUT,DGMHVNOS
"RTN","DGPREP1",194,0)
 ;
"RTN","DGPREP1",195,0)
 K DTOUT,DUOUT,DIC
"RTN","DGPREP1",196,0)
 S DIC=2,DIC(0)="AEQZM"
"RTN","DGPREP1",197,0)
 S DIC("A")="Select Patient to Preregister: "
"RTN","DGPREP1",198,0)
 S DIC("?")="Select a patient whose preregistration information you want to edit
."
"RTN","DGPREP1",199,0)
 D ^DIC K DIC
"RTN","DGPREP1",200,0)
 I $D(DTOUT)!($D(DUOUT))!(Y<0) Q
"RTN","DGPREP1",201,0)
 ;
"RTN","DGPREP1",202,0)
 S (DFN,DGPIFN)=+Y,DGPIDX=""
"RTN","DGPREP1",203,0)
 I $D(^DGS(41.42,"B",DFN)) D  Q:$G(DGPX)
"RTN","DGPREP1",204,0)
 . S DGPIDX=$O(^DGS(41.42,"B",DFN,DGPIDX))
"RTN","DGPREP1",205,0)
 . S DGPDIV=$P($G(^DGS(41.42,DGPIDX,0)),U,2)
"RTN","DGPREP1",206,0)
 . I DGPIDX]"" L +^DGS(41.42,DGPIDX):2 I '$T W *7,!,"Another user is editing thi
s patient." S DGPX=1
"RTN","DGPREP1",207,0)
 ;
"RTN","DGPREP1",208,0)
 D  Q:$G(DGMHVOUT)
"RTN","DGPREP1",209,0)
 .I '$$MHVOK^DGMHVAC(DFN) D EN^DGMHV(DFN) Q
"RTN","DGPREP1",210,0)
 .Q:$G(DGMHVNOS)
"RTN","DGPREP1",211,0)
 .D EN^DGMHVAC(DFN,2)
"RTN","DGPREP1",212,0)
 ;
"RTN","DGPREP1",213,0)
 S DGNEW=0,DGPFLG=1,DGPSTMP="",DGMODE=1
"RTN","DGPREP1",214,0)
 ;
"RTN","DGPREP1",215,0)
 ;  ** Since this is a direct call for a patient, and the particular appt. is no
t known, set DGPDIV to primary medical center division.
"RTN","DGPREP1",216,0)
 I $G(DGPDIV)']"" D
"RTN","DGPREP1",217,0)
 . S DGPDIV=$$PRIM^VASITE
"RTN","DGPREP1",218,0)
 ;
"RTN","DGPREP1",219,0)
 D INITLE(.DGPSTMP)
"RTN","DGPREP1",220,0)
 ;
"RTN","DGPREP1",221,0)
 I $G(DGRPOUT) G UNLCK
"RTN","DGPREP1",222,0)
 ;
"RTN","DGPREP1",223,0)
 I $G(DGPFLG),DGPIDX]"" D
"RTN","DGPREP1",224,0)
 . S DA=DGPIDX
"RTN","DGPREP1",225,0)
 . S DIE="^DGS(41.42,"
"RTN","DGPREP1",226,0)
 . S DR="4///Y" I DGPSTMP]"" S DR=DR_";3///^S X=DGPSTMP"
"RTN","DGPREP1",227,0)
 . D ^DIE K DIE
"RTN","DGPREP1",228,0)
 ;
"RTN","DGPREP1",229,0)
UNLCK I $G(DGPIDX)]"" L -^DGS(41.42,DGPIDX)
"RTN","DGPREP1",230,0)
 Q
"SEC","^DIC",390.01,390.01,0,"AUDIT")
@
"SEC","^DIC",390.01,390.01,0,"DD")
@
"SEC","^DIC",390.01,390.01,0,"DEL")
@
"SEC","^DIC",390.01,390.01,0,"LAYGO")
@
"SEC","^DIC",390.01,390.01,0,"RD")
@
"SEC","^DIC",390.01,390.01,0,"WR")
@
"SEC","^DIC",390.02,390.02,0,"AUDIT")
@
"SEC","^DIC",390.02,390.02,0,"DD")
@
"SEC","^DIC",390.02,390.02,0,"DEL")
@
"SEC","^DIC",390.02,390.02,0,"LAYGO")
@
"SEC","^DIC",390.02,390.02,0,"RD")
@
"SEC","^DIC",390.02,390.02,0,"WR")
@
"SEC","^DIC",390.04,390.04,0,"AUDIT")
@
"SEC","^DIC",390.04,390.04,0,"DD")
@
"SEC","^DIC",390.04,390.04,0,"DEL")
@
"SEC","^DIC",390.04,390.04,0,"LAYGO")
@
"SEC","^DIC",390.04,390.04,0,"RD")
@
"SEC","^DIC",390.04,390.04,0,"WR")
@
"UP",2,2.0537026,-1)
2^1
"UP",2,2.0537026,0)
2.0537026
"UP",2,2.0537041,-1)
2^3
"UP",2,2.0537041,0)
2.0537041
"UP",2,2.0537042,-1)
2^4
"UP",2,2.0537042,0)
2.0537042
"UP",2,2.5370262,-2)
2^1
"UP",2,2.5370262,-1)
2.0537026^1
"UP",2,2.5370262,0)
2.5370262
"VER")
8.0^22.0
"^DD",2,2,537026,0)
MHV SOCIALIZATION^2.0537026DA^^1;0
"^DD",2,2,537026,"DT")
3140912
"^DD",2,2,537027,0)
MHV ENROLLED^S^0:NO;1:YES;^2;1^Q
"^DD",2,2,537027,"DT")
3141013
"^DD",2,2,537028,0)
MHV AUTHENTICATED^S^0:NO;1:YES;2:ACTION;^2;2^Q
"^DD",2,2,537028,"DT")
3141013
"^DD",2,2,537029,0)
MHV SECURE MESSAGING^S^0:NO;1:YES;2:ACTION;^2;3^Q
"^DD",2,2,537029,"DT")
3141013
"^DD",2,2,537030,0)
MHVEN UPDATE DATE/TIME^D^^2;4^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",2,2,537030,"DT")
3141013
"^DD",2,2,537031,0)
MHVAUTH UPDATE DATE/TIME^D^^2;5^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",2,2,537031,"DT")
3141013
"^DD",2,2,537032,0)
MHVSM UPDATE DATE/TIME^D^^2;6^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",2,2,537032,"DT")
3141013
"^DD",2,2,537033,0)
MHV ENROLL DECLINED TEXT^F^^2.1;1^K:$L(X)>250!($L(X)<2) X
"^DD",2,2,537033,3)
Answer must be 2-250 characters in length.
"^DD",2,2,537033,"DT")
3141016
"^DD",2,2,537034,0)
MHV AUTH DECLINED TEXT^F^^2.2;1^K:$L(X)>250!($L(X)<2) X
"^DD",2,2,537034,3)
Answer must be 2-250 characters in length.
"^DD",2,2,537034,"DT")
3141016
"^DD",2,2,537035,0)
MHV MSG DECLINED TEXT^F^^2.3;1^K:$L(X)>250!($L(X)<2) X
"^DD",2,2,537035,3)
Answer must be 2-250 characters in length.
"^DD",2,2,537035,"DT")
3141016
"^DD",2,2,537038,0)
MHV MSG DECLINED REASON^P390.03'^DGMHV(390.03,^2;9^Q
"^DD",2,2,537038,"DT")
3141014
"^DD",2,2,537041,0)
MHV MSG ACTIONS^2.0537041P^^3;0
"^DD",2,2,537042,0)
MHV AUTH ACTIONS^2.0537042P^^4;0
"^DD",2,2.0537026,0)
MHV SOCIALIZATION SUB-FIELD^^2^3
"^DD",2,2.0537026,0,"NM","MHV SOCIALIZATION")

"^DD",2,2.0537026,.01,0)
SOCIALIZATION DATE^D^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",2,2.0537026,.01,1,0)
^.1
"^DD",2,2.0537026,.01,1,1,0)
2.0537026^B
"^DD",2,2.0537026,.01,1,1,1)
S ^DPT(DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2,2.0537026,.01,1,1,2)
K ^DPT(DA(1),1,"B",$E(X,1,30),DA)
"^DD",2,2.0537026,.01,3)
(No range limit on date)
"^DD",2,2.0537026,.01,"DT")
3140915
"^DD",2,2.0537026,1,0)
SOCIALIZATION RESPONSE^RP390.01'^DGMHV(390.01,^0;2^Q
"^DD",2,2.0537026,1,3)

"^DD",2,2.0537026,1,"DT")
3140912
"^DD",2,2.0537026,2,0)
SOCIALIZATION ACTIONS^2.5370262PA^^1;0
"^DD",2,2.0537041,0)
MHV MSG ACTIONS SUB-FIELD^^.01^1
"^DD",2,2.0537041,0,"NM","MHV MSG ACTIONS")

"^DD",2,2.0537041,.01,0)
MHV MSG ACTIONS^MP390.02^DGMHV(390.02,^0;1^Q
"^DD",2,2.0537041,.01,1,0)
^.1
"^DD",2,2.0537041,.01,1,1,0)
2.0537041^B
"^DD",2,2.0537041,.01,1,1,1)
S ^DPT(DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",2,2.0537041,.01,1,1,2)
K ^DPT(DA(1),3,"B",$E(X,1,30),DA)
"^DD",2,2.0537041,.01,"DT")
3141029
"^DD",2,2.0537042,0)
MHV AUTH ACTIONS SUB-FIELD^^.01^1
"^DD",2,2.0537042,0,"NM","MHV AUTH ACTIONS")

"^DD",2,2.0537042,.01,0)
MHV AUTH ACTIONS^P390.02'^DGMHV(390.02,^0;1^Q
"^DD",2,2.0537042,.01,1,0)
^.1
"^DD",2,2.0537042,.01,1,1,0)
2.0537042^B
"^DD",2,2.0537042,.01,1,1,1)
S ^DPT(DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",2,2.0537042,.01,1,1,2)
K ^DPT(DA(1),4,"B",$E(X,1,30),DA)
"^DD",2,2.0537042,.01,"DT")
3141017
"^DD",2,2.5370262,0)
SOCIALIZATION ACTIONS SUB-FIELD^^.01^1
"^DD",2,2.5370262,0,"NM","SOCIALIZATION ACTIONS")

"^DD",2,2.5370262,.01,0)
SOCIALIZATION ACTIONS^P390.02'^DGMHV(390.02,^0;1^Q
"^DD",2,2.5370262,.01,1,0)
^.1
"^DD",2,2.5370262,.01,1,1,0)
2.5370262^B
"^DD",2,2.5370262,.01,1,1,1)
S ^DPT(DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",2,2.5370262,.01,1,1,2)
K ^DPT(DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",2,2.5370262,.01,"DT")
3140915
"^DD",390.01,390.01,0)
FIELD^^3^6
"^DD",390.01,390.01,0,"DT")
3140916
"^DD",390.01,390.01,0,"IX","B",390.01,.01)

"^DD",390.01,390.01,0,"IX","C",390.01,1)

"^DD",390.01,390.01,0,"NM","MHV SOCIALIZATION")

"^DD",390.01,390.01,0,"PT",2.0537026,1)

"^DD",390.01,390.01,0,"VRPK")
DG
"^DD",390.01,390.01,.001,0)
NUMBER^NJ2,0^^ ^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1.N) X
"^DD",390.01,390.01,.001,3)
Type a number between 1 and 99, 0 decimal digits.
"^DD",390.01,390.01,.001,"DT")
3140915
"^DD",390.01,390.01,.01,0)
NAME^RF^^0;1^K:$L(X)>60!($L(X)<3) X
"^DD",390.01,390.01,.01,1,0)
^.1
"^DD",390.01,390.01,.01,1,1,0)
390.01^B
"^DD",390.01,390.01,.01,1,1,1)
S ^DGMHV(390.01,"B",$E(X,1,30),DA)=""
"^DD",390.01,390.01,.01,1,1,2)
K ^DGMHV(390.01,"B",$E(X,1,30),DA)
"^DD",390.01,390.01,.01,3)
Answer must be 3-60 characters in length.
"^DD",390.01,390.01,.01,"DT")
3140915
"^DD",390.01,390.01,1,0)
DISPLAY SEQUENCE^NJ5,0^^1;1^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",390.01,390.01,1,1,0)
^.1
"^DD",390.01,390.01,1,1,1,0)
390.01^C
"^DD",390.01,390.01,1,1,1,1)
S ^DGMHV(390.01,"C",$E(X,1,30),DA)=""
"^DD",390.01,390.01,1,1,1,2)
K ^DGMHV(390.01,"C",$E(X,1,30),DA)
"^DD",390.01,390.01,1,1,1,"DT")
3140915
"^DD",390.01,390.01,1,3)
Type a number between 0 and 99999, 0 decimal digits.
"^DD",390.01,390.01,1,"DT")
3140915
"^DD",390.01,390.01,1.5,0)
DISPLAY TEXT^RF^^3;1^K:$L(X)>250!($L(X)<3) X
"^DD",390.01,390.01,1.5,3)
Answer must be 3-250 characters in length.
"^DD",390.01,390.01,1.5,"DT")
3140915
"^DD",390.01,390.01,2,0)
PATIENT TEXT^390.12^^2;0
"^DD",390.01,390.01,3,0)
FOLLOWUP ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",390.01,390.01,3,3)
This is Standard MUMPS code.
"^DD",390.01,390.01,3,9)
@
"^DD",390.01,390.01,3,"DT")
3140916
"^DD",390.01,390.12,0)
PATIENT TEXT SUB-FIELD^^.01^1
"^DD",390.01,390.12,0,"DT")
3140915
"^DD",390.01,390.12,0,"NM","PATIENT TEXT")

"^DD",390.01,390.12,0,"UP")
390.01
"^DD",390.01,390.12,.01,0)
PATIENT TEXT^Wx^^0;1^Q
"^DD",390.01,390.12,.01,"DT")
3140915
"^DD",390.02,390.02,0)
FIELD^^1^3
"^DD",390.02,390.02,0,"DT")
3141027
"^DD",390.02,390.02,0,"IX","B",390.02,.01)

"^DD",390.02,390.02,0,"NM","MHV SOCIALIZATION ACTIONS")

"^DD",390.02,390.02,0,"PT",2,537039)

"^DD",390.02,390.02,0,"PT",2,537040)

"^DD",390.02,390.02,0,"PT",2.0537041,.01)

"^DD",390.02,390.02,0,"PT",2.0537042,.01)

"^DD",390.02,390.02,0,"PT",2.5370262,.01)

"^DD",390.02,390.02,0,"VRPK")
DG
"^DD",390.02,390.02,.001,0)
NUMBER^NJ2,0^^ ^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",390.02,390.02,.001,3)
Type a number between 1 and 99, 0 decimal digits.
"^DD",390.02,390.02,.001,"DT")
3140915
"^DD",390.02,390.02,.01,0)
ACTION^RF^^0;1^K:$L(X)>120!($L(X)<3)!'(X'?1P.E) X
"^DD",390.02,390.02,.01,1,0)
^.1
"^DD",390.02,390.02,.01,1,1,0)
390.02^B
"^DD",390.02,390.02,.01,1,1,1)
S ^DGMHV(390.02,"B",$E(X,1,30),DA)=""
"^DD",390.02,390.02,.01,1,1,2)
K ^DGMHV(390.02,"B",$E(X,1,30),DA)
"^DD",390.02,390.02,.01,3)
Answer must be 3-120 characters in length.
"^DD",390.02,390.02,.01,"DT")
3140915
"^DD",390.02,390.02,1,0)
SELECTABLE LOCATIONS^390.21P^^1;0
"^DD",390.02,390.21,0)
SELECTABLE LOCATIONS SUB-FIELD^^.01^1
"^DD",390.02,390.21,0,"DT")
3141027
"^DD",390.02,390.21,0,"IX","B",390.21,.01)

"^DD",390.02,390.21,0,"NM","SELECTABLE LOCATIONS")

"^DD",390.02,390.21,0,"UP")
390.02
"^DD",390.02,390.21,.01,0)
SELECTABLE LOCATIONS^MP390.04^DGMHV(390.04,^0;1^Q
"^DD",390.02,390.21,.01,1,0)
^.1
"^DD",390.02,390.21,.01,1,1,0)
390.21^B
"^DD",390.02,390.21,.01,1,1,1)
S ^DGMHV(390.02,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",390.02,390.21,.01,1,1,2)
K ^DGMHV(390.02,DA(1),1,"B",$E(X,1,30),DA)
"^DD",390.02,390.21,.01,"DT")
3141027
"^DD",390.03,390.03,0)
FIELD^^1^3
"^DD",390.03,390.03,0,"DT")
3141020
"^DD",390.03,390.03,0,"IX","B",390.03,.01)

"^DD",390.03,390.03,0,"NM","MHV DECLINED REASONS")

"^DD",390.03,390.03,0,"PT",2,537036)

"^DD",390.03,390.03,0,"PT",2,537037)

"^DD",390.03,390.03,0,"PT",2,537038)

"^DD",390.03,390.03,0,"VRPK")
DG
"^DD",390.03,390.03,.001,0)
NUMBER^NJ2,0^^ ^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",390.03,390.03,.001,3)
Type a number between 1 and 99, 0 decimal digits.
"^DD",390.03,390.03,.001,"DT")
3141009
"^DD",390.03,390.03,.01,0)
NAME^RF^^0;1^K:$L(X)>60!($L(X)<3)!'(X'?1P.E) X
"^DD",390.03,390.03,.01,1,0)
^.1
"^DD",390.03,390.03,.01,1,1,0)
390.03^B
"^DD",390.03,390.03,.01,1,1,1)
S ^DGMHV(390.03,"B",$E(X,1,30),DA)=""
"^DD",390.03,390.03,.01,1,1,2)
K ^DGMHV(390.03,"B",$E(X,1,30),DA)
"^DD",390.03,390.03,.01,3)
Answer must be 3-60 characters in length.
"^DD",390.03,390.03,.01,"DT")
3141009
"^DD",390.03,390.03,1,0)
SELECTABLE AT^S^1:ENROLLMENT;2:AUTHENTICATION;3:SECURE MESSAGING;12:ENROLLMENT,A
UTHENTICATION;123:ENROLLMENT,AUTHENTICATION,SECURE MESSAGING;13:ENROLLMENT,SECUR
E MESSAGING;23:AUTHENTICATION,SECURE MESSAGING;^0;2^Q
"^DD",390.03,390.03,1,"DT")
3141020
"^DD",390.04,390.04,0)
FIELD^^1^2
"^DD",390.04,390.04,0,"DT")
3141023
"^DD",390.04,390.04,0,"IX","B",390.04,.01)

"^DD",390.04,390.04,0,"NM","MHV ACTION SELECTION")

"^DD",390.04,390.04,0,"PT",390.21,.01)

"^DD",390.04,390.04,0,"VRPK")
DG
"^DD",390.04,390.04,.01,0)
NAME^S^S:SOCIALIZATION;E:ENROLLMENT;A:AUTHENTICATION;M:SECURE MESSAGING;^0;1^Q
"^DD",390.04,390.04,.01,1,0)
^.1
"^DD",390.04,390.04,.01,1,1,0)
390.04^B
"^DD",390.04,390.04,.01,1,1,1)
S ^DGMHV(390.04,"B",$E(X,1,30),DA)=""
"^DD",390.04,390.04,.01,1,1,2)
K ^DGMHV(390.04,"B",$E(X,1,30),DA)
"^DD",390.04,390.04,.01,3)

"^DD",390.04,390.04,.01,"DT")
3141023
"^DD",390.04,390.04,1,0)
DESCRIPTION^F^^0;2^K:$L(X)>180!($L(X)<2) X
"^DD",390.04,390.04,1,3)
Answer must be 2-180 characters in length.
"^DD",390.04,390.04,1,"DT")
3141023
"^DIC",390.01,390.01,0)
MHV SOCIALIZATION^390.01
"^DIC",390.01,390.01,0,"GL")
^DGMHV(390.01,
"^DIC",390.01,"B","MHV SOCIALIZATION",390.01)

"^DIC",390.02,390.02,0)
MHV SOCIALIZATION ACTIONS^390.02
"^DIC",390.02,390.02,0,"GL")
^DGMHV(390.02,
"^DIC",390.02,"B","MHV SOCIALIZATION ACTIONS",390.02)

"^DIC",390.03,390.03,0)
MHV DECLINED REASONS^390.03
"^DIC",390.03,390.03,0,"GL")
^DGMHV(390.03,
"^DIC",390.03,"B","MHV DECLINED REASONS",390.03)

"^DIC",390.04,390.04,0)
MHV ACTION SELECTION^390.04
"^DIC",390.04,390.04,0,"GL")
^DGMHV(390.04,
"^DIC",390.04,"B","MHV ACTION SELECTION",390.04)

**END**
**END**


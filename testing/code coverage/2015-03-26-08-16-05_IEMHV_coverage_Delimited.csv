Routine,Line,RtnLine,Code
DGMHV,1,0,"DGMHV ;ALB/JCH - Display Pre-Registration MHV Enrollment ; 12/9/03 3:22pm"
DGMHV,2,0," ;;5.3;Registration;**903**;Aug 13, 1993;Build 53"
DGMHV,3,0," Q"
DGMHV,4,0,"EN(DFN) ; Entry Point for Alert, Socialization, and MHV Enrollment field editing 'Screen'"
DGMHV,5,20," D MAIN^DGMHV(DFN)"
DGMHV,6,19," Q"
DGMHV,7,0,"MAIN(DFN) ; Main Entry Point for MHV socialization text/action"
DGMHV,8,0," ; Do not display MHV enrollment 'screen' if socialization Action entered (DGMHVOUT=""A""), meaning MHV enrollment is in progress, not a firm YES or NO"
DGMHV,9,0," ; Do not display socialization text/action if MHV ENROLLED field is not null (DGMHVOUT=""E"")"
DGMHV,10,20," N DGMHVNOS,DGRSPNS,DGENTRY,DGACTS"
DGMHV,11,20," D CLEAR,ALERT,DSPLACT(DFN) I $G(DGMHVOUT)="""" W !!! D CONT"
DGMHV,12,20," D CLEAR"
DGMHV,13,20," I $G(DGMHVOUT)=""E"" D EN^DGMHVAC(DFN) Q"
DGMHV,14,19," I $G(DGMHVOUT)=""A"" D  Q"
DGMHV,15,1," .N DGDPTSOC S DGDPTSOC=+$O(^DPT(DFN,1,""A""),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.DGMHSEL,DGDPTSOC,""S"")"
DGMHV,16,0," .Q:$G(DGMHVOUT)!$G(DGMHVNOS)"
DGMHV,17,0," .D EN^DGMHVAC(DFN)"
DGMHV,18,18," D SOCIAL^DGMHV Q:$G(DGMHVOUT)"
DGMHV,19,13," Q:$G(DGMHVNOS)"
DGMHV,20,11," D EN^DGMHVAC(DFN)"
DGMHV,21,11," Q"
DGMHV,22,0,"SOCIAL ; MHV Enrollment talking point/socialization text action"
DGMHV,23,0," ; Display MHV socialization canned text, prompt for patient response, display and prompt for clerk action"
DGMHV,24,18," I $P($G(^DPT(DFN,2)),""^"") Q"
DGMHV,25,13," N DGSODONE"
DGMHV,26,13," F  Q:$G(DGSODONE)!$G(DGMHVOUT)  D SLOOP"
DGMHV,27,13," Q"
DGMHV,28,0,"SLOOP ; Allow user to go back and enter a different patient response in case the patient changes their mind"
DGMHV,29,13," N DGMHV,I,DGDIR0,DGDPTSOC,DGTAB,DGREADTX,DGMHVMOD S DGDPTSOC="""",DGMHVMOD=""S"""
DGMHV,30,13," K DIRUT"
DGMHV,31,13," S DGREADTX=""Please read the following to the patient"""
DGMHV,32,13," D GTSOCODS(.DGDIR0) S DGDIR0=""SO^"",I="""" F  S I=$O(DGDIR0(I)) Q:'I  S DGDIR0=DGDIR0_I_"":""_DGDIR0(I)_"";"""
DGMHV,33,13," F  Q:$G(DGMHVOUT)!$G(DGMHV(""SOCIAL""))  D"
DGMHV,34,13," .D CLEAR W !!,DGREADTX"
DGMHV,35,13," .K DIR W !!?8,""""""Has a health care team member encouraged you"""
DGMHV,36,13," .W !?10,""to enroll online for My HealtheVet?"""""""
DGMHV,37,13," .S DIR(""A"")=""Patient response"""
DGMHV,38,13," .S DIR(0)=DGDIR0"
DGMHV,39,13," .S DIR(""??"")=""D CLEAR"" D ^DIR I $E($G(Y))=""^"" S DGMHVOUT=1 Q"
DGMHV,40,13," .I Y="""" W !!,""My HealtheVet enrollment information is required to continue with this patient"",!! D CONT Q"
DGMHV,41,13," .S DGMHV(""SOCIAL"")=$G(DGDIR0(Y,""IEN""))"
DGMHV,42,13," Q:$G(DGMHVOUT)"
DGMHV,43,13," D FILSOC(DFN,+DGMHV(""SOCIAL""),$$NOW^XLFDT,.DGDPTSOC)"
DGMHV,44,13," I DGMHV(""SOCIAL"")=1 D"
DGMHV,45,6," .N DGOLDEN S DGOLDEN=$P($G(^DPT(DFN,2)),""^"")"
DGMHV,46,6," .N DIE,DR,DA S DIE=""^DPT("",DR=""537027////1;537030////""_$$NOW^XLFDT,DA=DFN D ^DIE"
DGMHV,47,6," .Q:DGOLDEN=1"
DGMHV,48,6," .N DGFLD F DGFLD=537033,537036 D FILRNA^DGMHVAC(DFN,DGFLD,""@"")"
DGMHV,49,6," .N MHVND S MHVND=$G(^DPT(+DFN,2))"
DGMHV,50,6," .I $P(MHVND,""^"",2)=0 F DGFLD=537028,537031,537034,537037 D FILRNA^DGMHVAC(DFN,DGFLD,""@"")"
DGMHV,51,6," .I $P(MHVND,""^"",3)=0 F DGFLD=537029,537032,537035,537039 D FILRNA^DGMHVAC(DFN,DGFLD,""@"")"
DGMHV,52,13," Q:'$G(DGMHV(""SOCIAL""))  D CLEAR W !!,DGREADTX W !! D CANNED(DGMHV(""SOCIAL"")) D CONT I (DGMHV(""SOCIAL"")>1) I $G(DIRUT)&($G(X)=""^"") S DGSODONE=0 Q"
DGMHV,53,13," N FLWUP,RTST S DGAR1=DGDPTSOC S FLWUP=$G(^DGMHV(390.01,DGMHV(""SOCIAL""),4)) S RTST=$P(FLWUP,""^"",2),RTST=$P(RTST,""("") I RTST]"""" I $T(@RTST)]"""" X FLWUP"
DGMHV,54,13," S DGSODONE=1"
DGMHV,55,13," Q"
DGMHV,56,20,"ALERT(DPTDFN) ; Displays the 'MHV Enrollment Information Missing' message"
DGMHV,57,20," Q:'$D(XQY0)"
DGMHV,58,20," N X,Y,IORVON,IORVOFF,DIR,DIRUT"
DGMHV,59,20," S X=""IORVON;IORVOFF"""
DGMHV,60,20," D ENDR^%ZISS"
DGMHV,61,20," W !!!!?4,$CHAR(7) W:$D(IORVON) IORVON W ""** PATIENT NEEDS TO ANSWER MY HEALTHEVET ENROLLMENT QUESTIONS **"" W:$D(IORVOFF) IORVOFF"
DGMHV,62,20," W !?4,""Patient is missing required My HealtheVet Enrollment information"",!"
DGMHV,63,20," Q"
DGMHV,64,13,"FILSOC(DFN,RSPNT,RSPDT,DGDPTSOC) ; File MHV Socialization Information to PATIENT (#2) file"
DGMHV,65,0," ;    DFN = PATIENT IEN"
DGMHV,66,0," ;  RSPNT = RESPONSE POINTER TO FILE 390.01"
DGMHV,67,0," ;  RPSDT = RESPONSE DATE/TIME"
DGMHV,68,13," N DIE,DA,DR,DO,DGMHVND K DIE,DA,DR,DO"
DGMHV,69,13," S DIC(0)=""EZ"",DIC=""^DPT(DFN,1,"",DA(2)=DFN,DA(1)=+$O(^DPT(DFN,1,""A""),-1)+1,DGDPTSOC=DA(1)"
DGMHV,70,13," S DGMHVND=DA(1),DINUM=DA(1),X=RSPDT,DIC(""DR"")="".01////""_RSPDT_"";1////""_RSPNT D FILE^DICN"
DGMHV,71,13," K DIE,DIC,DA S DIE=""^DPT(DFN,1,"",DA(1)=DFN,DA=DGMHVND"
DGMHV,72,13," S DR="".01////""_RSPDT_"";1////""_RSPNT D ^DIE"
DGMHV,73,13," Q"
DGMHV,74,13,"CANNED(SCRIPT) ; Display canned text from PATIENT TEXT (#2) field in the MHV SOCIALIZATION (#390.01) file"
DGMHV,75,13," Q:'$G(SCRIPT)"
DGMHV,76,13," N DGMHVLIN,DGLINCNT,DGMHVOUT S DGMHVLIN=$P($G(^DGMHV(390.01,SCRIPT,2,0)),""^"",3),DGMHVOUT=0"
DGMHV,77,13," S DGLINCNT=0 F  S DGLINCNT=$O(^DGMHV(390.01,SCRIPT,2,DGLINCNT)) Q:'DGLINCNT!(DGLINCNT>DGMHVLIN)  D"
DGMHV,78,63," .W !?2 W:DGLINCNT=1 """""""" W ^DGMHV(390.01,SCRIPT,2,DGLINCNT,0) S DGMHVOUT=1"
DGMHV,79,13," W:$G(DGMHVOUT) """""""" W !"
DGMHV,80,13," Q"
DGMHV,81,13,"GTSOCODS(DGSOCCOD) ; Get array of socialization codes and display sequences from MHV SOCIALIZATION (#390.01) file"
DGMHV,82,13," K DGSOCCOD,DGSOCIEN,DGSOCSEQ S DGSOCSEQ="""",DGSOCCOD="""",DGSOCIEN="""" N I,TEXT S I=0,TEXT="""""
DGMHV,83,13," F  S DGSOCSEQ=$O(^DGMHV(390.01,""C"",DGSOCSEQ)) Q:'DGSOCSEQ  D"
DGMHV,84,78," .S DGSOCIEN="""" F  S DGSOCIEN=$O(^DGMHV(390.01,""C"",DGSOCSEQ,DGSOCIEN)) Q:DGSOCIEN=""""  D"
DGMHV,85,78," ..N TEXT D FIND^DIC(390.01,"""",""@;.01"",""A"",DGSOCIEN,1,"""","""","""",""TEXT"")"
DGMHV,86,78," ..S I=I+1 S DGSOCCOD(I)=TEXT(""DILIST"",""ID"",1,"".01""),DGSOCCOD(I,""IEN"")=DGSOCIEN"
DGMHV,87,13," Q"
DGMHV,88,1,"NOFLW(DGSOCCOD) ; Perform followup dialog for patient that does not wish to enroll"
DGMHV,89,1," N DIR,DIC,DA,DGAR1,DGAR2 S DGAR1="""",DGAR2="""""
DGMHV,90,1," W !! S DIR(""A"",1)=""   How does the patient feel now about enrolling in My HealtheVet?"""
DGMHV,91,1," S DIR(""A"",2)="" "",DIR(""A"",3)=""          a) Patient is not interested."""
DGMHV,92,1," S DIR(""A"",4)=""          b) Patient is interested."",DIR(""A"",5)="" """
DGMHV,93,1," S DIR(0)=""SA^a:Patient is not interested;b:Patient is interested"",DIR(""A"")=""Select a response: """
DGMHV,94,1," D ^DIR Q:$G(Y)=""a"""
DGMHV,95,1," D ACTIONS(.DGAR1,DGAR2,$G(DGDPTSOC),""S"")"
DGMHV,96,1," Q"
DGMHV,97,12,"ACTIONS(DGMSACT,ACTSEL,DGENRQ,DGMHVMOD) ; Display MHV Socialization actions, allow selection, return selected actions in ACTSEL"
DGMHV,98,0," ; Input:"
DGMHV,99,0," ;   DGMSACT  - Array of selectable actions from MHV SOCIALIZATION ACTIONS (#390.02) file"
DGMHV,100,0," ;   ACTSEL   - Array of action(s) currently selected by clerk"
DGMHV,101,0," ;   DGENRQ   - Internal Entry Number (IEN) of the prospective MHV SOCIALIZATION (#537026) multiple in the PATIENT (#2) file into which"
DGMHV,102,0," ;              the selected actions in ACTSEL will be stored."
DGMHV,103,0," ;   DGMHVMOD - Mode; the section of MHV functionality from which this is invoked. Used to screen selectable actions."
DGMHV,104,0," ;                    ""S"" - Enrollment Socialization, ""A"" - Authentication field, ""S"" - Secure Messaging field"
DGMHV,105,12," K DIR,DGMSACT D CLEAR"
DGMHV,106,12," N DIR,ACTCNT,DGACDONE,DGSTAY,DGACSAVE,DGACCNT S DGACDONE=0,DGACSAVE=0"
DGMHV,107,12," D GETACTS(.DGMSACT,$G(DGMHVMOD)) S DGACCNT=+$O(DGMSACT(""""),-1)"
DGMHV,108,12," S DIR(0)=""SA^"" S ACTCNT=0 F  S ACTCNT=$O(DGMSACT(ACTCNT)) Q:'ACTCNT  S DIR(0)=DIR(0)_ACTCNT_"":""_DGMSACT(ACTCNT)_"";"""
DGMHV,109,12," S $P(DIR(0),""^"",3)=""D ACTRNSFM^DGMHV"""
DGMHV,110,12," F  Q:$G(DGACDONE)  D ACTLOOP(.DIR,.DGMSACT,.ACTSEL)"
DGMHV,111,11," I $G(DGACSAVE),$D(ACTSEL)>1 D  S DGMHVNOS=1 Q"
DGMHV,112,5," .I $G(DGENRQ),'$G(DGDPTSOC) S DGDPTSOC=DGENRQ"
DGMHV,113,5," .N DGSEL,DGAIEN,DGMHVND,DGPLURAL S DGSEL=0 F DGPLURAL=1:1 S DGSEL=$O(ACTSEL(DGSEL)) Q:'DGSEL  D"
DGMHV,114,5," ..N DIE,DA,DIC S DGAIEN=$G(ACTSEL(DGSEL,""IEN"")),DIC(0)=""EZ"",DIC=""^DPT(""_DFN_"",1,""_DGDPTSOC_"",1,"",DA(3)=DFN,DA(2)=DGDPTSOC"
DGMHV,115,5," ..S DA(1)=$O(^DPT(DFN,1,DA(2),1,""A""),-1)+1,DINUM=DA(1),X=DGAIEN,DGMHVND=DA(1),DIC(""DR"")="".01////""_DGAIEN D FILE^DICN I $G(DGENRQ) D"
DGMHV,116,3," ...N DA,DIE,DIC,RSPDT S RSPDT=$$NOW^XLFDT S DIE=""^DPT(DFN,1,"",DA(1)=DFN,DA=DGENRQ S DR="".01////""_RSPDT D ^DIE"
DGMHV,117,5," ..N DA,DIE,DIC K DIE,DIC,DA S DIE=""^DPT(""_DFN_"",1,""_DGDPTSOC_"",1,"",DA(2)=DFN,DA(1)=DGDPTSOC,DA=$O(^DPT(DFN,1,DGDPTSOC,1,""A""),-1)"
DGMHV,118,5," ..S DR="".01////""_DGAIEN D ^DIE"
DGMHV,119,5," .W !,$S($G(DGPLURAL)=1:""Action"",1:""Actions""),"" Filed..."",! H .5"
DGMHV,120,6," S DGMHVOUT=1"
DGMHV,121,6," Q"
DGMHV,122,13,"ACTLOOP(DIR,DGMSACT,ACTSEL) ; Redisplay and reprompt user for action(s) until they're filed, or user aborts"
DGMHV,123,13," D CLEAR"
DGMHV,124,13," S DGSTAY=1"
DGMHV,125,13," W !?2,""Action(s) taken today to assist patient with My HealtheVet enrollment."""
DGMHV,126,13," W !?2,""-----------------------------------------------------------------------"""
DGMHV,127,13," D ^DIR"
DGMHV,128,13," I Y=""^""!$G(DIRUT) W !! N DGREALQ S DGREALQ=1 D  Q"
DGMHV,129,6," .N DIR,Y S DIR(0)=""Y"",DIR(""A"",1)=""My HealtheVet enrollment questions is required to continue with this patient."""
DGMHV,130,6," .S DIR(""A"")=""Are you sure you want to quit "" D ^DIR I $G(Y) S DGMHVOUT=1,DGACDONE=1,DGACSAVE=0,DGSTAY=0 Q"
DGMHV,131,0," .S DGSTAY=1"
DGMHV,132,7," I $G(Y)>0 N DGSELL F DGSELL=1:1:$L(Y,"","") N DGSELIT S DGSELIT=$P(Y,"","",DGSELL) I DGSELIT]"""" M ACTSEL(DGSELIT)=DGMSACT(DGSELIT)"
DGMHV,133,7," F  Q:'$G(DGSTAY)  D"
DGMHV,134,9," .D CLEAR N DIR,SELAC,DGCNT,DGII S DGCNT=1,DGSTAY=0"
DGMHV,135,9," .S DIR(""A"",DGCNT)="""",DGCNT=DGCNT+1"
DGMHV,136,9," .S DIR(""A"",DGCNT)=""Actions Selected:"""
DGMHV,137,9," .S DGCNT=DGCNT+1,DIR(""A"",DGCNT)="" "" ;""-----------------------------------------------------------------------"""
DGMHV,138,9," .S SELAC="""" F DGII=1:1 S SELAC=$O(ACTSEL(SELAC)) Q:'SELAC  D"
DGMHV,139,9," ..N SELACSUB,MARX S SELACSUB=0 D TXT(ACTSEL(SELAC),65) F  S SELACSUB=$O(MARX(SELACSUB)) Q:'SELACSUB  D"
DGMHV,140,12," ...S DGCNT=DGCNT+1 S DIR(""A"",DGCNT)="" ""_$S(SELACSUB=1:SELAC_"" - "",1:""    "")_"" ""_MARX(SELACSUB)"
DGMHV,141,9," .S DGCNT=DGCNT+1 S DIR(""A"",DGCNT)="""""
DGMHV,142,9," .S DIR(""A"")=""  (A)dd another, (D)elete an action, or <RET> to save and exit: "",DIR(0)=""SAO^A:Add an Action;D:Delete an Action"" D ^DIR W !"
DGMHV,143,8," .Q:Y=""A"""
DGMHV,144,8," .I Y=""D"" S DGSTAY=1 D DELETE(.ACTSEL) Q"
DGMHV,145,7," .I Y=""^"" W !! N DGREALQ S DGREALQ=1 D  Q"
DGMHV,146,2," ..N DIR,Y S DIR(0)=""Y"",DIR(""A"",1)=""My HealtheVet enrollment information is required to continue with this patient."""
DGMHV,147,2," ..S DIR(""A"")=""Are you sure you want to quit "" D ^DIR I $G(Y) S DGMHVOUT=1,DGACDONE=1,DGACSAVE=0,DGSTAY=0 Q"
DGMHV,148,2," ..S DGSTAY=1"
DGMHV,149,5," .S DGACDONE=1,DGACSAVE=1"
DGMHV,150,6," Q"
DGMHV,151,12,"GETACTS(DGMSACT,DGMHVMOD) ; Get actions from the MHV SOCIALIZATION ACTIONS (#390.02) file; screen by mode (DGMHVMOD)"
DGMHV,152,0," ; Input: DGMHVMOD - Mode; MHV functionality from which this is invoked. Used to screen selectable Actions."
DGMHV,153,0," ; DGMSACT - Array containing appropriate MHV actions, after screening based on mode (DGMHVMOD)."
DGMHV,154,12," N ACTIEN,ACTCNT,ACTTXT,SELCNT,DGMHVSAT S ACTCNT=0,SELCNT=0"
DGMHV,155,12," S ACTIEN=0 F  S ACTIEN=$O(^DGMHV(390.02,ACTIEN)) Q:'ACTIEN  S ACTTXT=$P($G(^DGMHV(390.02,ACTIEN,3,1,0)),""^"") I ACTTXT]"""" D"
DGMHV,156,168," .N TXTND S TXTND=1 F  S TXTND=$O(^DGMHV(390.02,ACTIEN,3,TXTND)) Q:'TXTND  S ACTTXT=ACTTXT_"" ""_^DGMHV(390.02,ACTIEN,3,TXTND,0)"
DGMHV,157,168," .N ACTLLIST D ACTSCRN^DGMHVUTL(ACTIEN,.ACTLLIST) I ($G(DGMHVMOD)]"""") Q:'$D(ACTLLIST(DGMHVMOD))"
DGMHV,158,62," .S ACTCNT=ACTCNT+1,SELCNT=SELCNT+1,DGMSACT(ACTCNT)=ACTTXT,DGMSACT(ACTCNT,""IEN"")=ACTIEN"
DGMHV,159,62," .N MARX,ACTLINE D TXT(ACTTXT,65) S ACTLINE=0 F  S ACTLINE=$O(MARX(ACTLINE)) Q:'ACTLINE  D"
DGMHV,160,106," ..N DGDASH S DGDASH=$S(ACTLINE=1&(ACTCNT<10):ACTCNT_"" -  "",(ACTLINE=1&(ACTCNT>9)):ACTCNT_"" - "",1:""     "")"
DGMHV,161,106," ..S DIR(""A"",SELCNT)=""  ""_DGDASH_"" ""_MARX(ACTLINE) S SELCNT=SELCNT+1"
DGMHV,162,168," ..;S DIR(""A"",SELCNT)=""  ""_$S(ACTLINE=1:ACTCNT_""  -  "",1:""      "")_""  ""_MARX(ACTLINE) S SELCNT=SELCNT+1"
DGMHV,163,12," S DIR(""A"",SELCNT+1)="" """
DGMHV,164,12," S DIR(""A"")="" Select an action: """
DGMHV,165,12," Q"
DGMHV,166,1,"DELETE(DGACTD) ; Delete one previously selected action"
DGMHV,167,0," ; Input : DGACTD - Array of MHV actions selected by clerk."
DGMHV,168,1," K DGDELDIR,DIR N DGDELAR,II,DGCNT S DGCNT=0"
DGMHV,169,1," M DGDELAR=DGACTD"
DGMHV,170,0," ;"
DGMHV,171,1," K DGACTD M DGACTD=DGDELAR"
DGMHV,172,1," S DIR(0)=""SAO^"" S ZZ=0 F II=1:1 S ZZ=$O(DGDELAR(ZZ)) Q:'ZZ  S DIR(0)=DIR(0)_ZZ_"":""_DGDELAR(ZZ)_"";"""
DGMHV,173,1," S DIR(""A"")=""Select an action to delete: "" D ^DIR I $G(Y)>0,$D(DGACTD(+Y)) K DGACTD(Y)"
DGMHV,174,1," W ! D CONT I '$D(DGACTD) S DGSTAY=0 D CLEAR"
DGMHV,175,1," Q"
DGMHV,176,0,"REVERSE(PAD,DGREVTXT) ; Display DGREVTXT in reverse video"
DGMHV,177,0," N X,Y,IORVON,IORVOFF,DIR,DIRUT"
DGMHV,178,0," S X=""IORVON;IORVOFF"" S PAD=+$G(PAD)"
DGMHV,179,0," D ENDR^%ZISS"
DGMHV,180,0," W $CHAR(7) W ?PAD W:$D(IORVON) IORVON W DGREVTXT W:$D(IORVOFF) IORVOFF"
DGMHV,181,0," Q"
DGMHV,182,90,"TXT(TXT,LEN) ; Split string into multiple LEN length lines"
DGMHV,183,0," ;* Input: TXT = TXT string"
DGMHV,184,0," ;*        LEN = format length"
DGMHV,185,0," ;* Output: MARX array."
DGMHV,186,157," NEW OLD,X1,Y D SPLIT K MARX"
DGMHV,187,157," S X=0,X1=1,Y="""" F  S X=$O(OLD(X)) Q:'X  D"
DGMHV,188,1688," . I $L(Y_OLD(X))>LEN S MARX(X1)=Y,X1=X1+1,Y="""" D"
DGMHV,189,126," .. I $E(MARX(X1-1),$L(MARX(X1-1)))'="" "" Q"
DGMHV,190,112," .. S MARX(X1-1)=$E(MARX(X1-1),1,$L(MARX(X1-1))-1)"
DGMHV,191,1688," . S Y=Y_OLD(X)"
DGMHV,192,157," S:Y]"""" MARX(X1)=Y"
DGMHV,193,157," S MARX=X1"
DGMHV,194,157," Q"
DGMHV,195,0,"SPLIT ; * Split a word string into individual words."
DGMHV,196,0," ;* Input: TXT  - Line of text"
DGMHV,197,0," ;* Input: LEN  - Maximum length one line of text will be limited to"
DGMHV,198,0," ;* Output: OLD(X)"
DGMHV,199,157," NEW BSD,NEW,X,X1,Y"
DGMHV,200,157," S OLD(1)=TXT Q:$L(TXT)<LEN"
DGMHV,201,101," F BSD="" "",""/"",""-"" S:'$O(OLD(0)) OLD(1)=TXT D:TXT[BSD DELIM(BSD)"
DGMHV,202,101," I '$O(OLD(1)),($L(TXT)>LEN) D LEN(1,TXT) K OLD D"
DGMHV,203,0," . F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)"
DGMHV,204,101," Q"
DGMHV,205,2472,"LEN(X1,OLD) ;* Wrap word to next line if it doesn't fit the display length"
DGMHV,206,2472," NEW X"
DGMHV,207,2472," Q:$L(OLD)'>LEN"
DGMHV,208,0," S X=$E(OLD,1,($L(OLD)-1)) I X[""/""!(X[""-"") Q"
DGMHV,209,0," I $L(OLD)>LEN F X=1:1 S NEW(X1)=$E(OLD,((LEN*X)-LEN+1),(LEN*X)),X1=X1+1 Q:($L(OLD)'>(LEN*X))"
DGMHV,210,0," Q"
DGMHV,211,159,"DELIM(BSD) ; Split a string into individual words"
DGMHV,212,0," ; Input:  BSD - Characters considered delimiters between words (i.e., for identifying/splitting-up-and/or-separating words)"
DGMHV,213,0," ; Input:  OLD(n) - Text array containing  "
DGMHV,214,0," ; Output: OLD(n) - Array containing pdated "
DGMHV,215,159," K NEW"
DGMHV,216,159," S X=0,X1=0 F  S X=$O(OLD(X)) Q:'X  F Y=1:1:$L(OLD(X),BSD) D"
DGMHV,217,2472," . S X1=X1+1"
DGMHV,218,2472," . S NEW(X1)=$P(OLD(X),BSD,Y)"
DGMHV,219,2472," . I $L(OLD(X),BSD)>1,(Y<$L(OLD(X),BSD)) S NEW(X1)=NEW(X1)_BSD"
DGMHV,220,2472," . D LEN(.X1,NEW(X1))"
DGMHV,221,159," K OLD F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)"
DGMHV,222,159," Q"
DGMHV,223,0,"CLEAR ; Clear the display"
DGMHV,224,150," D CLEAR^VALM1"
DGMHV,225,150," D FULL^VALM1"
DGMHV,226,150," S VALMBCK=""R"""
DGMHV,227,150," Q"
DGMHV,228,0,"CONT ; Prompt to Continue"
DGMHV,229,36," N DIR S DIR(0)=""E"",DIR(""A"")=""Press RETURN to continue"" D ^DIR"
DGMHV,230,36," Q"
DGMHV,231,0,"ACTRNSFM ; Transform action prompt input"
DGMHV,232,7," Q"
DGMHV,233,20,"DSPLACT(DFN) ; Display all MHV actions associated with last 5 date/time stamps. If last action is one of the "
DGMHV,234,0," ;             first four MHV actions, ask additional question about whether the patient was successfully enrolled"
DGMHV,235,20," N TMPDT,LASTDT,DGACTDT,NXT1,NXT2,I,J,DGLACTS,DIC,DA,DGFLDAR S DGLACTS="""""
DGMHV,236,20," D GETLACT^DGMHVUTL(DFN,.DGLACTS)"
DGMHV,237,20," W !,""         Recent My HealtheVet actions taken by VistA Clerks """
DGMHV,238,20," W !,""--------------------------------------------------------------------"""
DGMHV,239,20," D GETFLDS^DGMHVUTL(DFN,.DGFLDAR) I $O(DGFLDAR(0)) M DGLACTS=DGFLDAR"
DGMHV,240,20," I '$O(DGLACTS(0)) W !?8,"" - NONE - "",!! Q"
DGMHV,241,7," S LASTDT="""" F  S LASTDT=$O(DGLACTS(LASTDT)) Q:'LASTDT  D"
DGMHV,242,10," .S DGACTDT=$$FMTE^XLFDT($P(LASTDT,"".""),2) I ($L(DGACTDT)<8) D"
DGMHV,243,10," ..N NEWDT,IDT,DTPC F IDT=1:1:$L(DGACTDT,""/"") D"
DGMHV,244,30," ...S DTPC=$P(DGACTDT,""/"",IDT),DTPC=$TR($J(DTPC,2),"" "",0),NEWDT=$G(NEWDT)_$S(IDT=1:"""",1:""/"")_DTPC"
DGMHV,245,10," ..I NEWDT?2N1""/""2N1""/""2N S DGACTDT=NEWDT"
DGMHV,246,10," .S NXT1=0 F I=1:1 S NXT1=$O(DGLACTS(LASTDT,NXT1)) Q:'NXT1  D"
DGMHV,247,10," ..S NXT2="""" F J=1:1 S NXT2=$O(DGLACTS(LASTDT,NXT1,""TXT"",NXT2)) Q:'NXT2  W ! D"
DGMHV,248,14," ...N DGSP S DGSP=$S($L($G(DGLACTS(LASTDT,NXT1,""IEN"")))>1:"" "",1:"" "")"
DGMHV,249,14," ...W $S($G(TMPDT)'=LASTDT:DGACTDT,1:""       "") W $S((J=1):DGSP_"" "",1:""   ""),$G(DGLACTS(LASTDT,NXT1,""TXT"",NXT2))"
DGMHV,250,14," ...S TMPDT=LASTDT"
DGMHV,251,7," D QUESUC^DGMHVUTL(DFN,.DGMHVOUT) Q:($G(DGMHVOUT)]"""")"
DGMHV,252,5," Q"
DGMHV,253,0,"ACTHLP ; Help at action prompt"
DGMHV,254,0," W !?5,""Please select one of the listed actions that most closely describes"""
DGMHV,255,0," W !?5,""the actions taken today to help this patient enroll in My HealtheVet."""
DGMHV,256,0," Q"
Totals for DGMHV,,26709,
DGMHVAC,1,0,"DGMHVAC ;HIRMFO/WAA-REACTIONS SELECT ROUTINE ;6/9/05  11:12"
DGMHVAC,2,0," ;;5.3;Registration;**903**;Aug 13, 1993;Build 53"
DGMHVAC,3,0," ;"
DGMHVAC,4,0," ;"
DGMHVAC,5,0,"EN(DFN,DGABB) ; Entry point for MHV Enrollment 'screen'"
DGMHVAC,6,0," ; Allow editing only if ""1"" is selected, always begin with Enrolled? field, since subsequent field logic is dependent"
DGMHVAC,7,15," N DGMHVOUT,DGMHVQ,DGMHVI,DGRSPNS S DGMHVQ=0"
DGMHVAC,8,15," F DGMHVI=1:1 Q:$G(DGMHVOUT)  D"
DGMHVAC,9,17," .I DGMHVI=1&'$G(DGABB) S DGRSPNS=$$DSPENR^DGMHVUTL(DFN,.DGMHVOUT)"
DGMHVAC,10,17," .Q:$G(DGMHVOUT)!($G(DGMHVQ))"
DGMHVAC,11,11," .D MAIN(DFN,.DGRSPNS)"
DGMHVAC,12,11," .S DGRSPNS=$$DSPENR^DGMHVUTL(DFN,.DGMHVOUT)"
DGMHVAC,13,15," Q"
DGMHVAC,14,0," ;"
DGMHVAC,15,11,"MAIN(DFN,DGABB) ; Main Driver for Enrollment 'screen'. "
DGMHVAC,16,0," ; Prompt for three MHV Enrollment fields - include previously entered values as defaults"
DGMHVAC,17,0," ; Copy NO value and reason entered at any field to all subsequent fields."
DGMHVAC,18,0," ; Do not prompt for subsequent field unless 'YES' is entered at current field."
DGMHVAC,19,0," ; (A)ction (in progress) is treated as UNANSWERED."
DGMHVAC,20,12," N DGRPFLD,DGMHV,DGMHAC,DGMHSEL,DGMHVNOW,DGRSNPT,DGRSNTXT,X,Y"
DGMHVAC,21,12," S DGMHAC="""",DGMHSEL="""",DGMHVNOW=$$NOW^XLFDT"
DGMHVAC,22,12," I '$G(DGABB) D CLEAR^DGMHV W !!!"
DGMHVAC,23,0," ; Don't ask enrollment question if 'abbreviated' mode and already populated with YES"
DGMHVAC,24,12," K DIRUT W !"
DGMHVAC,25,12," S DGMHVQ=0"
DGMHVAC,26,0," ;"
DGMHVAC,27,0," ; Patient MHV Enrolled?"
DGMHVAC,28,12," D  ; Enrollment prompt"
DGMHVAC,29,12," .I $G(DGABB)&($G(DGABB)>1) S DGMHV(""ENROLLED"")=$$GETEN^DGMHVUTL(DFN) Q  ; Skip- either abbreviated+already answered, or user selected another"
DGMHVAC,30,1," .D ENROLL"
DGMHVAC,31,12," Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,32,12," K DIRUT W !"
DGMHVAC,33,0," ;"
DGMHVAC,34,0," ; Patient MHV Authenticated?"
DGMHVAC,35,12," D  ; Authentication prompt"
DGMHVAC,36,12," .I $G(DGABB)&($G(DGABB)>2) S DGMHV(""AUTH"")=$$GETAUTH^DGMHVUTL(DFN) Q"
DGMHVAC,37,9," .D AUTHENT"
DGMHVAC,38,12," Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,39,0," ;"
DGMHVAC,40,0," ; Secure Messaging"
DGMHVAC,41,9," D  ; Secure Messaging prompt"
DGMHVAC,42,9," .D SECMSG"
DGMHVAC,43,9," .I $G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,44,0," ;"
DGMHVAC,45,9," Q"
DGMHVAC,46,0," ;"
DGMHVAC,47,1,"ENROLLQ(MHV,DGMHVNOW) ; Prompt for ""MHV Enrolled"""
DGMHVAC,48,1," N ENDFLT,DIR,DA,X,Y S Y="""""
DGMHVAC,49,1," S ENDFLT=$P($G(^DPT(DFN,2)),""^"")"
DGMHVAC,50,1," S ENDFLT=$S(ENDFLT=1:""YES"",ENDFLT=0:""NO"",1:"""")"
DGMHVAC,51,1," S DIR(0)=""Y"",DIR(""B"")=ENDFLT"
DGMHVAC,52,1," S DIR(""A"")=""Is the patient enrolled in My HealtheVet (Yes/No)"""
DGMHVAC,53,1," K DIRUT D ^DIR  Q:$D(DIRUT)"
DGMHVAC,54,1," S MHV(""ENROLLED"")=$S($G(Y):1,1:0)"
DGMHVAC,55,1," Q"
DGMHVAC,56,0," ;"
DGMHVAC,57,9,"AUTHENQ(MHV,DGMHVNOW) ; Prompt for ""MHV Authenticated"""
DGMHVAC,58,9," I '$G(MHV(""ENROLLED"")) S DGMHVQ=1 Q"
DGMHVAC,59,8," N AUDFLT,DIR,DA,X,Y,DGTXT,DGTXTCNT"
DGMHVAC,60,8," D CANTXT^DGMHVUTL(""AUTH"",,,71)"
DGMHVAC,61,8," W !"
DGMHVAC,62,8," S AUDFLT=$P($G(^DPT(DFN,2)),""^"",2),AUDFLT=$S(AUDFLT=1:""YES"",AUDFLT=0:""NO"",AUDFLT=2:""ACTION"",1:"""")"
DGMHVAC,63,8," S DIR(0)=""SAO^Y:YES;N:NO;A:ACTION"""
DGMHVAC,64,8," S DIR(""B"")=AUDFLT"
DGMHVAC,65,8," S DIR(""A"",1)=""Select (Y) YES if patient already has an Authenticated MHV account."""
DGMHVAC,66,8," S DIR(""A"",2)=""Select (A) ACTION if patient would like to upgrade to Authenticated MHV account."""
DGMHVAC,67,8," S DIR(""A"",3)=""Select (N) NO if patient refuses an Authenticated MHV account."""
DGMHVAC,68,8," S DIR(""A"",4)="""""
DGMHVAC,69,8," S DIR(""A"")=""(Yes/No/(A)ction): """
DGMHVAC,70,8," K DIRUT D ^DIR I $D(DIRUT) W ! Q"
DGMHVAC,71,8," S MHV(""AUTH"")=$S(Y=""Y"":1,Y=""A"":2,1:0)"
DGMHVAC,72,8," S DGTXT="""""
DGMHVAC,73,8," I MHV(""AUTH"")'=2 S MHV(""AUTH"",""DATE"")=DGMHVNOW"
DGMHVAC,74,8," I MHV(""AUTH"")=1 S DGTXT=""- Patient already has an authenticated account."""
DGMHVAC,75,8," I MHV(""AUTH"")=0 S DGTXT=""- Patient refuses an upgraded MHV account."""
DGMHVAC,76,8," I MHV(""AUTH"")=2 S DGTXT=""- Patient would like to upgrade to an authenticated MHV account."""
DGMHVAC,77,8," I DGTXT]"""" D TXT^DGMHV(DGTXT,50) I $G(MARX) F DGTXTCNT=1:1:+$G(MARX) D"
DGMHVAC,78,10," .I DGTXTCNT=1 W MARX(DGTXTCNT) Q"
DGMHVAC,79,2," .W !,MARX(DGTXTCNT)"
DGMHVAC,80,8," W !"
DGMHVAC,81,8," Q"
DGMHVAC,82,0," ;"
DGMHVAC,83,9,"OPTINQ(MHV,DGMHVNOW) ; Prompt for ""Opted in for MHV Secure Messaging"""
DGMHVAC,84,9," I '$G(MHV(""AUTH"")) S DGMHVQ=1 Q"
DGMHVAC,85,7," N MSGDFLT,DIR,DA,X,Y"
DGMHVAC,86,7," D CANTXT^DGMHVUTL(""SMSG"",,,71)"
DGMHVAC,87,7," W !"
DGMHVAC,88,7," S MSGDFLT=$P($G(^DPT(DFN,2)),""^"",3),MSGDFLT=$S(MSGDFLT=1:""YES"",MSGDFLT=0:""NO"",MSGDFLT=2:""ACTION"",1:"""")"
DGMHVAC,89,7," S DIR(0)=""SAO^Y:YES;N:NO;A:ACTION"",DIR(""B"")=MSGDFLT"
DGMHVAC,90,7," S DIR(""A"",1)=""Select (Y) YES if patient already has an Authenticated MHV account."""
DGMHVAC,91,7," S DIR(""A"",2)=""Select (A) ACTION if patient would like to upgrade to Authenticated MHV account."""
DGMHVAC,92,7," S DIR(""A"",3)=""Select (N) NO if patient refuses an Authenticated MHV account."""
DGMHVAC,93,7," S DIR(""A"",4)="""""
DGMHVAC,94,7," S DIR(""A"")=""Secure Messaging? (Yes/No/(A)ction): """
DGMHVAC,95,7," K DIRUT D ^DIR I $D(DIRUT) W ! Q"
DGMHVAC,96,6," S MHV(""OPTINQ"")=$S(Y=""Y"":1,Y=""A"":2,1:0)"
DGMHVAC,97,6," S DGTXT="""""
DGMHVAC,98,6," I MHV(""OPTINQ"")'=2 S MHV(""AUTH"",""DATE"")=DGMHVNOW"
DGMHVAC,99,6," W !"
DGMHVAC,100,6," Q"
DGMHVAC,101,0," ;"
DGMHVAC,102,0,"ENROLL  ; MHV Enrollment"
DGMHVAC,103,1," D CLEAR^DGMHV"
DGMHVAC,104,1," W !,""Step 1 of 3: My HealtheVet Enrollment"",!,""--------------------------------------"",!"
DGMHVAC,105,1," D ENROLLQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1 Q"
DGMHVAC,106,1," Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,107,0," ; MHV Enrolled"
DGMHVAC,108,1," I '$G(DGMHV(""ENROLLED"")) S DGRNSPT="""",DGRSNTXT="""" D  Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,109,1," .N DGADFLT,UTILITY,DIC,DA,DR S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537036"" D GETS^DIQ(DIC,DFN,DR,""I"",""UTILITY"")"
DGMHVAC,110,1," .S DGADFLT=$G(UTILITY(2,DFN_"","",537036,""I""))"
DGMHVAC,111,1," .D GETRSN(""patient is not enrolled"",.DGRSNPT,.DGRSNTXT,DGADFLT,2.1) Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,112,1," .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q"
DGMHVAC,113,1," .D FILRNA(DFN,537036,""@""),FILRNA(DFN,537033,""@""),FILRNA(DFN,537038,""@"")"
DGMHVAC,114,1," .F DGRPFLD=537036:1:537038 D FILRNA(DFN,DGRPFLD,DGRSNPT)"
DGMHVAC,115,1," .I $P($G(^DGMHV(390.03,DGRSNPT,0)),""^"")=""Other"" F DGRTFLD=537033:1:537035 D FILRNA(DFN,DGRTFLD,DGRSNTXT)"
DGMHVAC,116,1," .N DIE,DR,DA S DIE=""^DPT("",DR=""537027////""_+DGMHV(""ENROLLED"")_"";537030////""_DGMHVNOW,DA=DFN D ^DIE"
DGMHVAC,117,1," .N DIE,DR,DA S DA=DFN,DIE=""^DPT("",DR=""537028////0;537029////0;537031////""_DGMHVNOW_"";537032////""_DGMHVNOW D ^DIE"
DGMHVAC,118,1," I $G(DGMHV(""ENROLLED"")) D"
DGMHVAC,119,0," .Q:$G(DGABB)&$G(^DPT(DFN,2))  ; Quit if 'abbreviated' mode and this was answered previously"
DGMHVAC,120,0," .N DGOLDEN S DGOLDEN=$P($G(^DPT(DFN,2)),""^"")"
DGMHVAC,121,0," .N DIE,DA S DIE=""^DPT("",DA=DFN,DR=""537027////1;537030////""_DGMHVNOW D ^DIE"
DGMHVAC,122,0," .; If ""Enrolled:"" changed from NO to YES, remove NO values in AUTHENTICATED and SECURE MESSAGING"
DGMHVAC,123,0," .Q:DGOLDEN=DGMHV(""ENROLLED"")"
DGMHVAC,124,0," .N DGFLD F DGFLD=537033,537036 D FILRNA(DFN,DGFLD,""@"")"
DGMHVAC,125,0," .N MHVND S MHVND=$G(^DPT(+DFN,2))"
DGMHVAC,126,0," .I $P(MHVND,""^"",2)=0 F DGFLD=537028,537034,537037 D FILRNA(DFN,DGFLD,""@"")"
DGMHVAC,127,0," .I $P(MHVND,""^"",3)=0 F DGFLD=537029,537035,537039 D FILRNA(DFN,DGFLD,""@"")"
DGMHVAC,128,1," Q"
DGMHVAC,129,0," ;"
DGMHVAC,130,0,"AUTHENT  ; Authenticated MHV account status"
DGMHVAC,131,9," D CLEAR^DGMHV"
DGMHVAC,132,9," W !,""Step 2 of 3: My HealtheVet Authentication Upgrade"",!,""-------------------------------------------------------------"",!"
DGMHVAC,133,9," D AUTHENQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1 Q"
DGMHVAC,134,9," Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,135,8," I '$G(DGMHV(""AUTH"")) S DGRNSPT="""",DGRSNTXT="""" D CANTXT^DGMHVUTL(""UP"",1,1) D  Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,136,2," .W !!,""Patient Not Authenticated Reasons"""
DGMHVAC,137,2," .N DGADFLT,UTILITY,DIC,DA,DR S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537037"" D GETS^DIQ(DIC,DFN,DR,""I"",""UTILITY"")"
DGMHVAC,138,2," .S DGADFLT=$G(UTILITY(2,DFN_"","",537037,""I""))"
DGMHVAC,139,2," .D GETRSN(""patient has not upgraded/authenticated"",.DGRSNPT,.DGRSNTXT,DGADFLT,2.2) Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,140,2," .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q"
DGMHVAC,141,2," .D FILRNA(DFN,537037,""@""),FILRNA(DFN,537034,""@""),FILRNA(DFN,537035,""@"")"
DGMHVAC,142,2," .F DGRPFLD=537037,537038 D FILRNA(DFN,DGRPFLD,DGRSNPT)"
DGMHVAC,143,2," .I $P($G(^DGMHV(390.03,DGRSNPT,0)),""^"")=""Other"" F DGRTFLD=537034:1:537035 D FILRNA(DFN,DGRTFLD,DGRSNTXT)"
DGMHVAC,144,2," .N DIE,DR,DA S DIE=""^DPT("",DR=""537028////""_DGMHV(""AUTH"")_"";537031////""_DGMHVNOW,DA=DFN D ^DIE"
DGMHVAC,145,2," .N DIE,DR,DA S DA=DFN,DIE=""^DPT("",DR=""537029////0;537032////""_DGMHVNOW D ^DIE"
DGMHVAC,146,8," I $G(DGMHV(""AUTH""))=1 D"
DGMHVAC,147,4," .N DGOLDAU S DGOLDAU=$P($G(^DPT(DFN,2)),""^"",2)"
DGMHVAC,148,4," .N DIE,DA S DIE=""^DPT("",DA=DFN,DR=""537028////1;537031////""_DGMHVNOW D ^DIE"
DGMHVAC,149,4," .Q:DGOLDAU=DGMHV(""AUTH"")  ; User accepted default, nothing changed"
DGMHVAC,150,4," .N DGFLD,MHVND S MHVND=$G(^DPT(+DFN,2))"
DGMHVAC,151,4," .I $P(MHVND,""^"",2)=0 F DGFLD=537034,537037 D FILRNA(DFN,DGFLD,""@"")"
DGMHVAC,152,4," .I $P(MHVND,""^"",3)=0 F DGFLD=537029,537035,537039 D FILRNA(DFN,DGFLD,""@"")"
DGMHVAC,153,8," I $G(DGMHV(""AUTH""))=2 D CANTXT^DGMHVUTL(""UP"",,1) D  S DGMHVQ=1 Q  ; Action entered instead of yes or no"
DGMHVAC,154,2," .N DGOLDAU S DGOLDAU=$P($G(^DPT(DFN,2)),""^"",2)"
DGMHVAC,155,2," .W !! N DGDPTSOC S DGDPTSOC=+$O(^DPT(DFN,1,""A""),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.DGMHSEL,DGDPTSOC,""A"")"
DGMHVAC,156,2," .N DGCURSEL S DGCURSEL=$O(DGMHSEL(0)) I 'DGCURSEL D  Q"
DGMHVAC,157,0," ..;N DIE,DA S DIE=""^DPT("",DA=DFN,DR=""537028////@;537031////""_DGMHVNOW D ^DIE"
DGMHVAC,158,2," .N DIE,DA S DIE=""^DPT("",DA=DFN,DR=""537028////2;537031////""_DGMHVNOW D ^DIE"
DGMHVAC,159,2," .D FILRNA(DFN,537034,""@""),FILRNA(DFN,537037,""@"")"
DGMHVAC,160,2," .D FILACT(DFN,4,.DGMHSEL)"
DGMHVAC,161,2," .Q:DGOLDAU=DGMHV(""AUTH"")"
DGMHVAC,162,2," .N DGFLD,MHVND S MHVND=$G(^DPT(+DFN,2))"
DGMHVAC,163,2," .I $P(MHVND,""^"",2)=0 F DGFLD=537034,537037 D FILRNA(DFN,DGFLD,""@"")"
DGMHVAC,164,2," .F DGFLD=537029,537035,537039 D FILRNA(DFN,DGFLD,""@"")"
DGMHVAC,165,6," W !"
DGMHVAC,166,6," Q"
DGMHVAC,167,0," ;"
DGMHVAC,168,0,"SECMSG  ; Secure Messaging"
DGMHVAC,169,9," D CLEAR^DGMHV"
DGMHVAC,170,9," W !,""Step 3 of 3: My HealtheVet Secure Messaging"",!,""--------------------------------------------"",!"
DGMHVAC,171,9," K DIRUT D OPTINQ(.DGMHV,.DGMHVNOW) I $D(DIRUT) S DGMHVOUT=1,DGMHVQ=1"
DGMHVAC,172,9," Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,173,6," I '$G(DGMHV(""OPTINQ"")) S DGRNSPT="""",DGRSNTXT="""" D  Q:$G(DGMHVOUT)"
DGMHVAC,174,2," .N DGMDFLT,UTILITY,DIC,DA,DR S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537038"" D GETS^DIQ(DIC,DFN,DR,""I"",""UTILITY"")"
DGMHVAC,175,2," .S DGMDFLT=$G(UTILITY(2,DFN_"","",537038,""I""))"
DGMHVAC,176,2," .D GETRSN(""not using secure messaging"",.DGRSNPT,.DGRSNTXT,DGMDFLT,2.3) Q:$G(DGMHVOUT)!$G(DGMHVQ)"
DGMHVAC,177,1," .I $D(DIRUT)!$G(DGMHVOUT) S DGMHVQ=1,DGMHVOUT=1 Q"
DGMHVAC,178,1," .D FILRNA(DFN,537038,""@""),FILRNA(DFN,537035,""@"")"
DGMHVAC,179,1," .N DIE,DR,DA S DA=DFN,DIE=""^DPT("",DR=""537029////""_DGMHV(""OPTINQ"")_"";537032////""_DGMHVNOW D ^DIE"
DGMHVAC,180,1," .N DIE,DR,DA S DIE=""^DPT("",DR=""537029////""_DGMHV(""OPTINQ"")_"";537032////""_DGMHVNOW,DA=DFN D ^DIE"
DGMHVAC,181,1," .D FILRNA(DFN,537038,DGRSNPT)"
DGMHVAC,182,1," .I $P($G(^DGMHV(390.03,DGRSNPT,0)),""^"")=""Other"" D FILRNA(DFN,537035,DGRSNTXT)"
DGMHVAC,183,5," I $G(DGMHV(""OPTINQ""))=1 N DIE,DA S DIE=""^DPT("",DA=DFN,DR=""537029////1;537032////""_DGMHVNOW D ^DIE"
DGMHVAC,184,5," I $G(DGMHV(""OPTINQ""))=2 D  Q"
DGMHVAC,185,2," .N DGOLDMSG S DGOLDMSG=$$GETMSG^DGMHVUTL(DFN)"
DGMHVAC,186,2," .W !! N DGDPTSOC S DGDPTSOC=+$O(^DPT(DFN,1,""A""),-1)+1 D ACTIONS^DGMHV(.DGMHAC,.DGMHSEL,DGDPTSOC,""M"")"
DGMHVAC,187,2," .N DGCURSEL S DGCURSEL=$O(DGMHSEL(0)) I 'DGCURSEL D  Q"
DGMHVAC,188,1," .N DIE,DA S DIE=""^DPT("",DA=DFN,DR=""537029////2;537032////""_DGMHVNOW D ^DIE"
DGMHVAC,189,1," .D FILRNA(DFN,537035,""@""),FILRNA(DFN,537038,""@"")"
DGMHVAC,190,1," .D FILACT(DFN,3,.DGMHSEL)"
DGMHVAC,191,3," Q"
DGMHVAC,192,0," ;"
DGMHVAC,193,5,"GETRSN(TXTAD,REASPT,REASTXT,REASDFLT,DGTXTND) ; Prompt for ""NO"" Reason"
DGMHVAC,194,5," N DGDFTXT,DGMSACT,DIR,X,Y K DIRUT,DGTXTFIN,DGSCR"
DGMHVAC,195,5," S DGSCR=$S($G(DGTXTND)=2.1:1,$G(DGTXTND)=2.2:2,$G(DGTXTND)=2.3:3,1:"""")"
DGMHVAC,196,5," S DGDFTXT=$$LKUPRTXT^DGMHVAC(DFN,$G(DGTXTND)),DGTXTFIN=0"
DGMHVAC,197,5," D GETRSNS(.DGMSACT,DGSCR)"
DGMHVAC,198,5," I $G(REASDFLT) N RSNSEL S RSNSEL="""" F  S RSNSEL=$O(DGMSACT(RSNSEL)) Q:'RSNSEL  I $G(DGMSACT(RSNSEL,""IEN""))=REASDFLT S REASDFLT=RSNSEL"
DGMHVAC,199,5," D SETDIR(.DGMSACT,TXTAD,$G(REASDFLT))"
DGMHVAC,200,5," S REASPT="""" F  Q:$G(REASPT)!$G(DGMHVOUT)  D ^DIR S:(Y>0) REASPT=+$G(DGMSACT(Y,""IEN"")) I 'REASPT D"
DGMHVAC,201,1," .N DIR S DIR(0)=""Y"",DIR(""A"")=""Are you sure you want to quit "" D ^DIR I $G(Y)>0 S DGMHVOUT=1"
DGMHVAC,202,1," .N UTILITY,DIC,DA,DR S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537038"" D GETS^DIQ(DIC,DFN,DR,""I"",""UTILITY"")"
DGMHVAC,203,1," .S DGMDFLT=$G(UTILITY(2,DFN_"","",537038,""I""))"
DGMHVAC,204,5," Q:'$G(REASPT)"
DGMHVAC,205,4," I $P($G(^DGMHV(390.03,REASPT,0)),""^"")=""Other"" F  Q:$G(DGTXTFIN)!$G(DGMHVQ)  D"
DGMHVAC,206,2," .N DIR,X,Y S DIR(""B"")=$G(DGDFTXT),DIR(0)=""FAO^2:250"",DIR(""A"")=""Other Reason Text (250 Chars Max): "" D ^DIR"
DGMHVAC,207,2," .I $L(Y)>2 S REASTXT=$TR(Y,"";^"","" "") S DGTXTFIN=1 Q"
DGMHVAC,208,0," .I $G(X)=""@"" S DGDFTXT="""" W ""   Deleted"",!"
DGMHVAC,209,0," .I $G(X)=""^"" S DGMHVQ=1 Q"
DGMHVAC,210,4," Q"
DGMHVAC,211,0," ;"
DGMHVAC,212,37,"FILRNA(DFN,DGFIELD,DGRSPT) ; File selected NO Reason to Patient file"
DGMHVAC,213,49," N DIE,DA,DR"
DGMHVAC,214,49," S DIE=""^DPT("",DA=DFN,DR=DGFIELD_""////""_DGRSPT D ^DIE"
DGMHVAC,215,49," Q"
DGMHVAC,216,0," ;"
DGMHVAC,217,3,"FILACT(DFN,DGNODE,DGACTSEL) ; File selected MHV Action(s) to Patient file"
DGMHVAC,218,3," N NEXT,DGCNT"
DGMHVAC,219,3," S NEXT=""A"" F  S NEXT=$O(^DPT(DFN,DGNODE,NEXT),-1) Q:'NEXT  D"
DGMHVAC,220,4," .N DIE,DA,DIR S DIE=""^DPT(""_DFN_"",""_DGNODE_"","",DA(1)=DFN,DA=NEXT,DR=.01_""////@"" D ^DIE"
DGMHVAC,221,3," S NEXT=0 F DGCNT=1:1 S NEXT=$O(DGACTSEL(NEXT)) Q:'NEXT  D"
DGMHVAC,222,3," .Q:'$G(DGACTSEL(NEXT,""IEN""))"
DGMHVAC,223,3," .N DA,DINUM,X,DIC S DIC(0)=""LEZ"",DIC=""^DPT(DFN,DGNODE,"",DA(2)=DFN,DA(1)=NEXT,DINUM=DA(1),X=NEXT D FILE^DICN"
DGMHVAC,224,3," .N DIE,DA,DIR S DIE=""^DPT(""_DFN_"",""_DGNODE_"","",DA(1)=DFN,DA=DGCNT,DR=.01_""////""_DGACTSEL(NEXT,""IEN"") D ^DIE"
DGMHVAC,225,3," Q"
DGMHVAC,226,0," ;"
DGMHVAC,227,5,"GETRSNS(DGMSACT,DGSCRQ) ; Build and return array of selectable reasons from file 390.03"
DGMHVAC,228,5," N ACTIEN,ACTCNT,ACTTXT,SELCNT,DGSCR S ACTCNT=0,SELCNT=0"
DGMHVAC,229,5," S ACTIEN=0 F  S ACTIEN=$O(^DGMHV(390.03,ACTIEN)) Q:'ACTIEN  S ACTTXT=$P($G(^DGMHV(390.03,ACTIEN,0)),""^""),DGSCR=$P(^(0),""^"",2) I ACTTXT]"""" D"
DGMHVAC,230,45," .I $G(DGSCRQ),$G(DGSCR) Q:DGSCR'[DGSCRQ"
DGMHVAC,231,45," .S ACTCNT=ACTCNT+1,SELCNT=SELCNT+1,DGMSACT(ACTCNT)=ACTTXT,DGMSACT(ACTCNT,""IEN"")=ACTIEN"
DGMHVAC,232,5," Q"
DGMHVAC,233,0," ;"
DGMHVAC,234,5,"SETDIR(DGMSACT,TXTAD,DGMDEF) ; Put incoming array of reasons into DIC(""A"")"
DGMHVAC,235,5," S DIR(0)=""SA^"",DIR(""A"",1)="""",DIR(""B"")=$G(DGMDEF)"
DGMHVAC,236,5," S DGACCNT=+$O(DGMSACT(""""),-1)"
DGMHVAC,237,5," S ACTCNT=0 F  S ACTCNT=$O(DGMSACT(ACTCNT)) Q:'ACTCNT  S DIR(0)=DIR(0)_ACTCNT_"":""_DGMSACT(ACTCNT)_"";"",DIR(""A"",ACTCNT+1)=""     ""_ACTCNT_"" - ""_DGMSACT(ACTCNT)"
DGMHVAC,238,5," S DIR(""A"",$O(DIR(""A"",""A""),-1)+1)="""""
DGMHVAC,239,5," N LINE,II,MARX,TXL D TXT^DGMHV(TXTAD,30)"
DGMHVAC,240,5," I $O(MARX(""""),-1)=1 S DIR(""A"")=""Select reason ""_TXTAD_"": "" Q"
DGMHVAC,241,2," S TXL=0 F II=1:1 S TXL=$O(MARX(TXL)) Q:'TXL  D"
DGMHVAC,242,4," .S LINE=$S(II=1:""Select reason "",1:"""")_MARX(TXL)"
DGMHVAC,243,4," .I $O(MARX(TXL))="""" S DIR(""A"")=LINE Q"
DGMHVAC,244,2," .S DIR(""A"",$O(DIR(""A"",""A""),-1)+1)="""""
DGMHVAC,245,2," S DIR(""A"")=""Select reason ""_TXTAD_"": """
DGMHVAC,246,2," Q"
DGMHVAC,247,0," ;"
DGMHVAC,248,0,"MHVOK(DFN) ; Check patient's MHV enrollment info. "
DGMHVAC,249,0," ; Logic to activate/deactivate alert"
DGMHVAC,250,0," ; -----------------------------------"
DGMHVAC,251,0," ; 1. If any field contains null (UNANSWERED), return 0"
DGMHVAC,252,0," ; 2. If any field contains ""A"" (ACTION), return 0"
DGMHVAC,253,0," ; 3. If neither 1 nor 2 is true, and any field contains ""N"" (NO):"
DGMHVAC,254,0," ;              a. The alert is ON if the date the NO was entered is at least 6 months prior to the current date"
DGMHVAC,255,0," ;              b. The alert is OFF if the date the NO was entered is less than 6 months prior to the current date"
DGMHVAC,256,0," ; 4. If all fields contain ""Y"" (YES), return 1"
DGMHVAC,257,0," ;"
DGMHVAC,258,26," N DGIQ,MHVOK,MHVOKND,MHVEN,MHVBAD,UTILITY"
DGMHVAC,259,26," N DIC,DA,DR S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537027:537032"" D GETS^DIQ(DIC,DFN,DR,""I"",""UTILITY"")"
DGMHVAC,260,26," M MHVOK(DFN)=UTILITY(2,DFN_"","")"
DGMHVAC,261,26," S MHVBAD=0"
DGMHVAC,262,26," F DGIQ=0:1:2 I $G(MHVOK(DFN,537027+DGIQ,""I""))="""" S MHVBAD=1"
DGMHVAC,263,26," I $G(MHVBAD) Q 0"
DGMHVAC,264,6," F DGIQ=0:1:2 Q:$G(MHVBAD)  D"
DGMHVAC,265,18," .I $G(MHVOK(DFN,537027+DGIQ,""I""))=0 D  Q"
DGMHVAC,266,4," ..I '$G(MHVOK(DFN,537030+DGIQ,""I"")) S MHVBAD=1 Q"
DGMHVAC,267,4," ..I $$FMDIFF^XLFDT($$NOW^XLFDT,MHVOK(DFN,537030+DGIQ,""I""))>179 S MHVBAD=1 D"
DGMHVAC,268,0," ...N DGQ F DGQ=537027+DGIQ:1:537029 Q:DGQ>537029  D FILRNA(DFN,DGQ,""@"")"
DGMHVAC,269,14," .I (MHVOK(DFN,537027+DGIQ,""I"")="""")!(MHVOK(DFN,537027+DGIQ,""I"")=2) S MHVBAD=1"
DGMHVAC,270,6," Q $S($G(MHVBAD):0,1:1)"
DGMHVAC,271,0," ;"
DGMHVAC,272,0,"LKUPRSN(REASON) ; Lookup ""NO"" Reason in file 390.03"
DGMHVAC,273,6," N DIC,X S DIC=""390.03"",DIC(0)=""ZU"",X=+REASON D ^DIC"
DGMHVAC,274,6," Q $P($G(Y(0)),""^"")"
DGMHVAC,275,0," ;"
DGMHVAC,276,0,"LKUPRTXT(DFN,DGRFIELD) ; Lookup ""OTHER"" Reason free text from PATIENT (#2) file"
DGMHVAC,277,11," S DGRSNTXT=$P($G(^DPT(+DFN,+DGRFIELD)),""^"")"
DGMHVAC,278,11," Q $S($L(DGRSNTXT)>2:DGRSNTXT,1:"""")"
DGMHVAC,279,0," ;"
DGMHVAC,280,0,"LKUPACT(ACTION) ; Lookup MHV Action in file 390.02"
DGMHVAC,281,0," N DIC,X S DIC=""390.02"",DIC(0)=""ZU"",X=+ACTION D ^DIC"
DGMHVAC,282,0," Q $G(Y(0))"
DGMHVAC,283,0," Q"
DGMHVAC,284,0," ;"
DGMHVAC,285,0,"LASTACHK(DFN,ACTXT) ; Check if ACTXT contains the text matching the most recent ACTION entered for patient DFN"
DGMHVAC,286,36," N DGMATCH,DGLST5,DGLST1,DGL1TXT S DGMATCH=0,DGLST5="""""
DGMHVAC,287,36," D GETLACT^DGMHVUTL(DFN,.DGLST5) S DGLST1=$O(DGLST5($$NOW^XLFDT),-1)"
DGMHVAC,288,36," I $G(DGLST1) S DGL1TXT=$G(DGLST5(DGLST1,1,""TXT"",1))"
DGMHVAC,289,36," I $E($G(ACTXT),1,$L($G(ACTXT)))=$E($G(DGL1TXT),1,$L($G(ACTXT))) S DGMATCH=1"
DGMHVAC,290,36," Q $S($G(DGMATCH):1,1:0)"
Totals for DGMHVAC,,1717,
DGMHVUTL,1,0,"DGMHVUTL ;ALB/JCH - Patient MHV Enrollment - Utilities ;09/12/14 11:30am"
DGMHVUTL,2,0," ;;5.3;Registration;**903**;August 13, 1993;Build 53"
DGMHVUTL,3,0," ;"
DGMHVUTL,4,0," Q"
DGMHVUTL,5,7,"QUESUC(DFN,DGMHVOUT) ; If last action entered by clerk was one of the first four Socialization (MHV enrolled) actions,"
DGMHVUTL,6,0," ;                 display/prompt the ""were you successful"" message/question"
DGMHVUTL,7,0," ;"
DGMHVUTL,8,7," N DGSUPTXT"
DGMHVUTL,9,7," S DGSUPTXT=$$ENQACHK(DFN)"
DGMHVUTL,10,7," I DGSUPTXT]"""" D  Q"
DGMHVUTL,11,2," .Q:$P($G(^DPT(DFN,2)),""^"")"
DGMHVUTL,12,2," .N NXT,MARX,DIR,DGTXTCNT S DIR(0)=""YA"",DIR(""A"",1)="" Please read the following to the patient:"""
DGMHVUTL,13,2," .S DIR(""?"")="" Enter the patient's response to the question"""
DGMHVUTL,14,2," .D TXT^DGMHV(DGSUPTXT,55) S DGTXTCNT=0,NXT=3 F  S DGTXTCNT=$O(MARX(DGTXTCNT)) Q:'DGTXTCNT  D"
DGMHVUTL,15,4," ..I '$O(MARX(DGTXTCNT)) S DIR(""A"")=""       ""_MARX(DGTXTCNT)_""""""""_"" (Y/N): "" Q"
DGMHVUTL,16,2," ..S DIR(""A"",NXT)=""      """"""_MARX(DGTXTCNT),NXT=$G(NXT)+1"
DGMHVUTL,17,2," .W ! D ^DIR S DGMHVOUT=$S(Y=1:""E"",Y=0:""A"",1:"""")"
DGMHVUTL,18,2," .I $G(DGMHVOUT)=""E"" N DIE,DA S DIE=""^DPT("",DA=DFN,DR=""537027////1;537030////""_$$NOW^XLFDT D ^DIE"
DGMHVUTL,19,2," .H .5"
DGMHVUTL,20,5," Q"
DGMHVUTL,21,0," ;"
DGMHVUTL,22,26,"DSPENR(DFN,DGMHVFIN) ; Display patient's MHV enrollment information"
DGMHVUTL,23,0," ; This is the MHV enrollment pseudo-screen display; allow entry of 1 to edit the fields as a group, in sequence."
DGMHVUTL,24,26," N ACTION,ACTIONE,REASON,REASONE,MHVOK,MHVOKND,MHVEN,MHVEN,MHVAU,MHVMSG,DGRSNTXT"
DGMHVUTL,25,26," N X,Y,IORVON,IORVOFF,DIR,DIRUT,DGRSNCNT"
DGMHVUTL,26,0," ;"
DGMHVUTL,27,26," D HEADER(DFN)"
DGMHVUTL,28,26," K MHVOK N DIC,DA,DR S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537027:537040"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVOK"")"
DGMHVUTL,29,26," S MHVEN=$G(MHVOK(2,DFN_"","",537027,""I"")),MHVAU=$G(MHVOK(2,DFN_"","",537028,""I"")),MHVMSG=$G(MHVOK(2,DFN_"","",537029,""I""))"
DGMHVUTL,30,26," S X=""IORVON;IORVOFF"" D ENDR^%ZISS"
DGMHVUTL,31,26," W !!!,""[1]         Enrolled: "",$S(MHVEN=0:""NO"",MHVEN=1:""YES"",1:""UNANSWERED"") I MHVEN=1!(MHVEN=0) D"
DGMHVUTL,32,26," .N ENRDT S ENRDT=$$ENDATE(DFN) I ENRDT&(MHVEN=1) W ?44,""Confirmed: ""_ENRDT"
DGMHVUTL,33,26," I MHVEN=0 S REASON=$G(MHVOK(2,DFN_"","",537036,""I"")) I REASON W !?12,""Reason: "" S REASONE=$$LKUPRSN^DGMHVAC(REASON) D"
DGMHVUTL,34,0," .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT^DGMHVAC(DFN,2.1) I (REASONE=""Other"")&($L(DGRSNTXT)>2) S REASONE=REASONE_"" - ""_DGRSNTXT"
DGMHVUTL,35,0," .N MARX,I,LINE D TXT^DGMHV(REASONE,58) F I=1:1:$O(MARX(""""),-1) S LINE=$G(MARX(I)) D"
DGMHVUTL,36,0," ..I I=1 W LINE S DGRSNCNT=1 Q"
DGMHVUTL,37,0," ..W !?20,LINE"
DGMHVUTL,38,0," ;"
DGMHVUTL,39,26," W !!"
DGMHVUTL,40,26," I "",1,""[("",""_$G(MHVEN)_"","") W ""[2]"""
DGMHVUTL,41,26," W ?7,""Authenticated: "",$S(MHVAU=0:""NO"",MHVAU=1:""YES"",MHVAU=2:""ACTION/IN PROGRESS"",1:""UNANSWERED"") D"
DGMHVUTL,42,26," .I MHVAU!(MHVAU=0) N AUTHDT S AUTHDT=$$AUTHDATE(DFN) I AUTHDT&(MHVAU=1) W ?44,""Confirmed: ""_AUTHDT"
DGMHVUTL,43,26," I MHVAU=0,'$G(DGRSNCNT) S REASON=$G(MHVOK(2,DFN_"","",537037,""I"")) I REASON W !?12,""Reason: "" S REASONE=$$LKUPRSN^DGMHVAC(REASON) D"
DGMHVUTL,44,0," .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT^DGMHVAC(DFN,2.2) I (REASONE=""Other"")&($L(DGRSNTXT)>2) S REASONE=REASONE_"" - ""_DGRSNTXT"
DGMHVUTL,45,0," .N MARX,I,LINE D TXT^DGMHV(REASONE,58) F I=1:1:$O(MARX(""""),-1) S LINE=$G(MARX(I)) D"
DGMHVUTL,46,0," ..I I=1 W LINE S DGRSNCNT=1 Q"
DGMHVUTL,47,0," ..W !?21,LINE"
DGMHVUTL,48,26," I MHVAU=2 N ACTIEN S ACTIEN="""" F  S ACTIEN=$O(^DPT(DFN,4,""B"",ACTIEN)) Q:ACTIEN=""""  D"
DGMHVUTL,49,6," .N ACTTXT,LI S ACTTXT=$P($G(^DGMHV(390.02,+ACTIEN,3,1,0)),""^"") I ACTTXT]"""" D"
DGMHVUTL,50,6," ..N TXTND S TXTND=1 F  S TXTND=$O(^DGMHV(390.02,ACTIEN,3,TXTND)) Q:'TXTND  S ACTTXT=ACTTXT_"" ""_^DGMHV(390.02,ACTIEN,3,TXTND,0)"
DGMHVUTL,51,6," ..Q:$L(ACTTXT)<2  N MARX,INOD,LINE D TXT^DGMHV(ACTTXT,48) F INOD=1:1:$O(MARX(""""),-1) S LINE=$G(MARX(INOD)) D"
DGMHVUTL,52,12," ...I INOD=1 W !?14,""Action: "",LINE S DGRSNCNT=1 Q"
DGMHVUTL,53,6," ...W !?22,LINE"
DGMHVUTL,54,0," ;"
DGMHVUTL,55,26," W !!"
DGMHVUTL,56,26," I "",1,""[("",""_$G(MHVAU)_"","") W ""[3]"""
DGMHVUTL,57,26," W ?4,""Secure Messaging: "",$S(MHVMSG=0:""NO"",MHVMSG=1:""YES"",MHVMSG=2:""ACTION/IN PROGRESS"",1:""UNANSWERED"") D"
DGMHVUTL,58,26," .I MHVMSG!(MHVMSG=0) N MSGDT S MSGDT=$$MSGDATE(DFN) I MSGDT&(MHVMSG=1) W ?44,""Confirmed: ""_MSGDT"
DGMHVUTL,59,26," I MHVMSG=0,'$G(DGRSNCNT) S REASON=$G(MHVOK(2,DFN_"","",537038,""I"")) I REASON W !?12,""Reason: "" S REASONE=$$LKUPRSN^DGMHVAC(REASON) D"
DGMHVUTL,60,6," .N DGRSNTXT S DGRSNTXT=$$LKUPRTXT^DGMHVAC(DFN,2.3) I REASONE=""Other""&($L(DGRSNTXT)>2) S REASONE=REASONE_"" - ""_DGRSNTXT"
DGMHVUTL,61,6," .N MARX,I,LINE D TXT^DGMHV(REASONE,60) F I=1:1:$O(MARX(""""),-1) S LINE=$G(MARX(I)) D"
DGMHVUTL,62,6," ..I I=1 W LINE S DGRSNCNT=1 Q"
DGMHVUTL,63,0," ..W !?20,LINE"
DGMHVUTL,64,26," I MHVMSG=2 N ACTIEN S ACTIEN="""" F  S ACTIEN=$O(^DPT(DFN,3,""B"",ACTIEN)) Q:ACTIEN=""""  D"
DGMHVUTL,65,5," .N ACTTXT,LI S ACTTXT=$P($G(^DGMHV(390.02,+ACTIEN,3,1,0)),""^"") I ACTTXT]"""" D"
DGMHVUTL,66,5," ..N TXTND S TXTND=1 F  S TXTND=$O(^DGMHV(390.02,ACTIEN,3,TXTND)) Q:'TXTND  S ACTTXT=ACTTXT_"" ""_^DGMHV(390.02,ACTIEN,3,TXTND,0)"
DGMHVUTL,67,5," ..Q:$L(ACTTXT)<2  N MARX,INOD,LINE D TXT^DGMHV(ACTTXT,48) F INOD=1:1:$O(MARX(""""),-1) S LINE=$G(MARX(INOD)) D"
DGMHVUTL,68,10," ...I INOD=1 W !?14,""Action: "",LINE S DGRSNCNT=1 Q"
DGMHVUTL,69,5," ...W !?22,LINE"
DGMHVUTL,70,26," W !!!!!!!"
DGMHVUTL,71,26," K DIRUT S DGMHVOUT=0,DGMHVQ=0"
DGMHVUTL,72,26," K DGABB"
DGMHVUTL,73,26," S DGSCHTR=$$SELFLDS(DFN)"
DGMHVUTL,74,26," N DGDONE F  Q:$G(DGDONE)  D"
DGMHVUTL,75,26," .N DIR S DIR(""A"")=""Select an Enrollment step, or RETURN to continue: """
DGMHVUTL,76,26," .S DIR(0)=""SAO^1:Enrollment;2:Authentication;3:Secure Messaging"""
DGMHVUTL,77,26," .D ^DIR S DGRSPNS=Y I DGSCHTR[("",""_DGRSPNS_"","") S DGDONE=1 Q"
DGMHVUTL,78,15," .I DGRSPNS=""""!(DGRSPNS=""^"") S DGRSPNS="""" S DGDONE=1 Q"
DGMHVUTL,79,0," .W !,"" Not a valid response"",!"
DGMHVUTL,80,26," S DGMHVOUT=$S(DGSCHTR[("",""_DGRSPNS_"","")=1:0,1:1)"
DGMHVUTL,81,26," Q DGRSPNS"
DGMHVUTL,82,0," ;"
DGMHVUTL,83,7,"ENQACHK(DFN)  ; Return followup question in DGSUPTXT if last action taken for patient DFN was one of the 4 enrollment actions"
DGMHVUTL,84,9," N DGSUP1,DGSUP2,DGSUP3,DGACT1,DGACT2,DGACT3,DGACT4"
DGMHVUTL,85,9," S DGMHVOUT=$G(DGMHVOUT)"
DGMHVUTL,86,9," S DGACT1=""Helped patient to create"""
DGMHVUTL,87,9," S DGACT2=""Scheduled future appointment for patient to enroll"""
DGMHVUTL,88,9," S DGACT3=""Referred patient to the MHV office"""
DGMHVUTL,89,9," S DGACT4=""Gave patient MHV enrollment instructions"""
DGMHVUTL,90,9," S DGSUP1=""Were you successful in creating your My HealtheVet account?"""
DGMHVUTL,91,9," S DGSUP2=$P(DGSUP1,""?"")_"" during your last visit?"""
DGMHVUTL,92,9," S DGSUP3=""Were you able to create a My HealtheVet account from the enrollment instructions we gave you last time?"""
DGMHVUTL,93,9," S DGSUPTXT=$S($$LASTACHK^DGMHVAC(DFN,DGACT1)!$$LASTACHK^DGMHVAC(DFN,DGACT2):DGSUP2,$$LASTACHK^DGMHVAC(DFN,DGACT3):DGSUP1,$$LASTACHK^DGMHVAC(DFN,DGACT4):DGSUP3,1:"""")"
DGMHVUTL,94,9," Q DGSUPTXT"
DGMHVUTL,95,0," ;"
DGMHVUTL,96,56,"GETLACT(DFN,DGLACTS) ; Get most recent MHV actions entered by clerk for patient DFN"
DGMHVUTL,97,0," ; Input: DFN - Patient IEN"
DGMHVUTL,98,0," ; Output: DGLACTS - Array of MHV actions"
DGMHVUTL,99,0," ;"
DGMHVUTL,100,56," N DGOT,LASTCNT,ACTCNT,X,X1,Y,LASTDT,LASTACT,LASTIEN,ACTCNT,FNDACT,LIENOK S (LASTACT,LASTIEN,DGLACTS,LASTCNT)="""""
DGMHVUTL,101,56," S LASTDT="""" F LASTCNT=1:1 S LASTDT=$O(^DPT(DFN,1,""B"",LASTDT),-1) Q:'LASTDT!($G(DGOT)>4)  D"
DGMHVUTL,102,64," .F  S LASTIEN=$O(^DPT(DFN,1,""B"",LASTDT,LASTIEN)) Q:'LASTIEN  D"
DGMHVUTL,103,89," ..Q:'$O(^DPT(DFN,1,LASTIEN,1,0))  S ACTCNT(""DT"",LASTIEN)=LASTDT,FNDACT=1,LIENOK=LASTIEN,DGOT=$G(DGOT)+1"
DGMHVUTL,104,56," Q:'$G(LIENOK)"
DGMHVUTL,105,35," S LIENOK="""" F  S LIENOK=$O(ACTCNT(""DT"",LIENOK)) Q:'LIENOK  N LASTDT S LASTDT=$G(ACTCNT(""DT"",LIENOK)) D"
DGMHVUTL,106,35," .S ACTCNT=0 F  S ACTCNT=$O(^DPT(DFN,1,LIENOK,1,ACTCNT)) Q:'ACTCNT  S ACTCNT(LASTDT,ACTCNT)=^DPT(DFN,1,LIENOK,1,ACTCNT,0) D"
DGMHVUTL,107,35," ..N ACTTXT,ACTIEN S ACTIEN=+$G(ACTCNT(LASTDT,ACTCNT)) S ACTTXT=$G(^DGMHV(390.02,ACTIEN,3,1,0)) I ACTTXT]"""" D"
DGMHVUTL,108,35," ...N TXTND S TXTND=1 F  S TXTND=$O(^DGMHV(390.02,ACTIEN,3,TXTND)) Q:'TXTND  S ACTTXT=ACTTXT_"" ""_^DGMHV(390.02,ACTIEN,3,TXTND,0)"
DGMHVUTL,109,35," ...S ACTCNT(LASTDT,ACTCNT,""IEN"")=ACTCNT(LASTDT,ACTCNT)"
DGMHVUTL,110,35," ...N MARX D TXT^DGMHV(ACTTXT,60) M ACTCNT(LASTDT,ACTCNT,""TXT"")=MARX"
DGMHVUTL,111,35," S LASTDT=$O(ACTCNT(0)) I $O(ACTCNT(0)) M DGLACTS=ACTCNT"
DGMHVUTL,112,35," Q"
DGMHVUTL,113,0," ;"
DGMHVUTL,114,168,"ACTSCRN(ACTIEN,LOCLIST) ; Check on code/functional locations at which MHV actions are selectable"
DGMHVUTL,115,0," ; Accepts an ACTION (#390.02) file IEN, returns array LOCLIST(LOC) where LOC is a location at which the action is selectable"
DGMHVUTL,116,0," ;"
DGMHVUTL,117,168," Q:'$G(ACTIEN)  K LOCLIST S LOCLIST="""""
DGMHVUTL,118,168," N ACTLOCN Q:'$D(^DGMHV(390.02,+ACTIEN,1))"
DGMHVUTL,119,168," S ACTLOCN=0 F  S ACTLOCN=$O(^DGMHV(390.02,ACTIEN,1,ACTLOCN)) Q:'ACTLOCN  D"
DGMHVUTL,120,252," .S LOCLIST=$G(^DGMHV(390.02,ACTIEN,1,ACTLOCN,0)) I LOCLIST S LOCLIST=$P($G(^DGMHV(390.04,LOCLIST,0)),""^"") I LOCLIST]"""" S LOCLIST(LOCLIST)="""""
DGMHVUTL,121,168," Q"
DGMHVUTL,122,0," ;"
DGMHVUTL,123,26,"HEADER(DFN) ; Print simulated screen header"
DGMHVUTL,124,26," N DGPTINFO,DGSCST K ^UTILITY(""DIQ1"",$J)"
DGMHVUTL,125,26," N DIC,DA,DR S DIQ(0)=""E"",DIC=2,DA=DFN,DR="".01;391"" D EN^DIQ1 M DGPTINFO(DFN)=^UTILITY(""DIQ1"",$J,2,DFN)"
DGMHVUTL,126,26," D CLEAR^DGMHV"
DGMHVUTL,127,26," W !!?20,""MY HEALTHEVET ENROLLMENT STATUS"""
DGMHVUTL,128,26," S DGNMSSN=$$SSNNM^DGRPU(DFN)"
DGMHVUTL,129,26," W !!,DGNMSSN,?60,$G(DGPTINFO(DFN,391,""E""))"
DGMHVUTL,130,26," W !,""================================================================================"""
DGMHVUTL,131,26," K ^UTILITY(""DIQ1"",$J)"
DGMHVUTL,132,26," Q"
DGMHVUTL,133,0," ;"
DGMHVUTL,134,26,"SELFLDS(DFN) ; Get selectable enrollment fields based on values of other fields"
DGMHVUTL,135,0," ;"
DGMHVUTL,136,26," N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL"
DGMHVUTL,137,26," N DIC,DA,DR"
DGMHVUTL,138,26," S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537027:537040"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVFLDS"")"
DGMHVUTL,139,26," S MHVEN=$G(MHVFLDS(2,DFN_"","",537027,""I"")),MHVAU=$G(MHVFLDS(2,DFN_"","",537028,""I"")),MHVMSG=$G(MHVFLDS(2,DFN_"","",537029,""I""))"
DGMHVUTL,140,26," N DGFLDSEL S DGFLDSEL=1"
DGMHVUTL,141,26," I $S("",0,1,""[("",""_$G(MHVEN)_"",""):1,1:0) S DGFLDSEL=DGFLDSEL_"",2"""
DGMHVUTL,142,26," I $S("",0,1,""[("",""_$G(MHVAU)_"",""):1,1:0) S DGFLDSEL=DGFLDSEL_"",3"""
DGMHVUTL,143,26," S DGFLDSEL="",""_DGFLDSEL_"","""
DGMHVUTL,144,26," Q DGFLDSEL"
DGMHVUTL,145,0," ;"
DGMHVUTL,146,0,"ENTRYFLD(DFN,DGUNONLY) ; Get first non-firmly answered field either unanswered or action in progress"
DGMHVUTL,147,0," ;"
DGMHVUTL,148,2," N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL"
DGMHVUTL,149,2," N DIC,DA,DR"
DGMHVUTL,150,2," S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537027:537040"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVFLDS"")"
DGMHVUTL,151,2," S MHVEN=$G(MHVFLDS(2,DFN_"","",537027,""I"")),MHVAU=$G(MHVFLDS(2,DFN_"","",537028,""I"")),MHVMSG=$G(MHVFLDS(2,DFN_"","",537029,""I""))"
DGMHVUTL,152,2," N DGFLDSEL S DGFLDSEL="""""
DGMHVUTL,153,2," I '$G(DGUNONLY) D"
DGMHVUTL,154,2," .I MHVMSG=""""!(MHVMSG=2) S DGFLDSEL=3"
DGMHVUTL,155,2," .I MHVAU=""""!(MHVAU=2) S DGFLDSEL=2"
DGMHVUTL,156,2," .I MHVEN="""" S DGFLDSEL=1"
DGMHVUTL,157,2," I $G(DGUNONLY) D"
DGMHVUTL,158,0," .I MHVAU=2!(MHVMSG=2) Q"
DGMHVUTL,159,0," .I MHVMSG="""" S DGFLDSEL=3"
DGMHVUTL,160,0," .I MHVAU="""" S DGFLDSEL=2"
DGMHVUTL,161,0," .I MHVEN="""" S DGFLDSEL=1"
DGMHVUTL,162,2," Q DGFLDSEL"
DGMHVUTL,163,0," ;"
DGMHVUTL,164,20,"GETEN(DFN) ; Get value of MHV Enrolled"
DGMHVUTL,165,0," ;"
DGMHVUTL,166,31," N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL"
DGMHVUTL,167,31," N DIC,DA,DR"
DGMHVUTL,168,31," S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537027"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVFLDS"")"
DGMHVUTL,169,31," S MHVEN=$G(MHVFLDS(2,DFN_"","",537027,""I""))"
DGMHVUTL,170,31," Q MHVEN"
DGMHVUTL,171,0," ;"
DGMHVUTL,172,20,"GETAUTH(DFN) ; Get value of MHV Authenticated"
DGMHVUTL,173,0," ;"
DGMHVUTL,174,23," N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL"
DGMHVUTL,175,23," N DIC,DA,DR"
DGMHVUTL,176,23," S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537028"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVFLDS"")"
DGMHVUTL,177,23," S MHVAU=$G(MHVFLDS(2,DFN_"","",537028,""I""))"
DGMHVUTL,178,23," Q MHVAU"
DGMHVUTL,179,0," ;"
DGMHVUTL,180,20,"GETMSG(DFN) ; Get value of MHV Secure Messaging"
DGMHVUTL,181,0," ;"
DGMHVUTL,182,22," N MHVEN,MHVAU,MHVMSG,MHVFLDS,DGFLDSEL"
DGMHVUTL,183,22," N DIC,DA,DR"
DGMHVUTL,184,22," S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537029"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVFLDS"")"
DGMHVUTL,185,22," S MHVMSG=$G(MHVFLDS(2,DFN_"","",537029,""I""))"
DGMHVUTL,186,22," Q MHVMSG"
DGMHVUTL,187,0," ;"
DGMHVUTL,188,15,"CANTXT(DGMSG,CLEAR,CONT,DGTXTW) ; Display canned text to read to patient"
DGMHVUTL,189,19," Q:$G(DGMSG)']"""""
DGMHVUTL,190,19," N DGINDEN,TMPCAN,NEXT,CANTXT,MARX,I S CANTXT="""""
DGMHVUTL,191,19," F I=0:1 S TMPCAN=$T(@(DGMSG_""+""_I)) Q:TMPCAN'["";""  S CANTXT=CANTXT_$P(TMPCAN,"";"",2)"
DGMHVUTL,192,19," Q:CANTXT="""""
DGMHVUTL,193,19," I $G(CLEAR) D CLEAR^DGMHV"
DGMHVUTL,194,19," W !,""Please read the following to the patient"",!"
DGMHVUTL,195,19," S DGTXTW=$S($G(DGTXTW):DGTXTW,1:60)"
DGMHVUTL,196,19," D TXT^DGMHV(.CANTXT,DGTXTW)"
DGMHVUTL,197,19," S DGINDEN=(80-DGTXTW)/2"
DGMHVUTL,198,19," S NEXT=0 F  S NEXT=$O(MARX(NEXT)) Q:'NEXT  D"
DGMHVUTL,199,61," .W !?DGINDEN,MARX(NEXT)"
DGMHVUTL,200,19," I $G(CONT) W !! D CONT^DGMHV"
DGMHVUTL,201,19," Q"
DGMHVUTL,202,0," ;"
DGMHVUTL,203,0,"UP ;""Upgrade to an Authenticated My HealtheVet account to view parts of your VA health record. This requires one-time in-person identity verification (show photo ID). Read and sign this Release of Information form (10-5345a-MHV)."
DGMHVUTL,204,0," ; Photo ID required. (Instructions for optional online Authentication process are also available)"""
DGMHVUTL,205,0," Q"
DGMHVUTL,206,0,"SMSG ;""With Secure Messaging, Veterans can communicate online with VA health care teams about health questions, to request prescription renewals, or schedule appointments."""
DGMHVUTL,207,0," Q"
DGMHVUTL,208,0,"AUTH ;""With an Authenticated MHV account patients can view VA appointments, lab results and VA medical records online."""
DGMHVUTL,209,0," Q"
DGMHVUTL,210,1,"MHVPCHK(DFN) ; Consistency checker MHV update"
DGMHVUTL,211,0," ; Don't trigger update if MHV ENROLLED has not been answered, and enrollment socialization action is pending"
DGMHVUTL,212,1," N DGMHVOUT,DGMHVQ,DP,DG,DK,DH,DM,DQ,DR,DL,X,Y,DC,DE,DIC,DIE,DIIENS,DIFLD,DIETMP,DW,D,D0,DG,DI,DIEL,DU,DV"
DGMHVUTL,213,0," ;N (DUZ,DFN,U,DT)"
DGMHVUTL,214,1," S DGMHVOUT=0,DGMHVQ=0"
DGMHVUTL,215,1," S DGMHVACT=$$ENQACHK^DGMHVUTL(DFN) Q:(DGMHVACT]"""")&'$G(^DPT(DFN,2))"
DGMHVUTL,216,1," S DGMHVACT=$$ENTRYFLD^DGMHVUTL(DFN)"
DGMHVUTL,217,1," D MAIN^DGMHVAC(DFN,DGMHVACT)"
DGMHVUTL,218,1," S:'$$MHVOK^DGMHVAC(DFN) FILERR(315)="""""
DGMHVUTL,219,1," Q"
DGMHVUTL,220,0," ;"
DGMHVUTL,221,20,"GETFLDS(DFN,FLDARRAY) ; Get mhv enrollment status field and date values, place in array formatted for merging with historical action display"
DGMHVUTL,222,20," N DGEN,DGAUTH,DGMSG,DGENDT,DGAUDT,DGMSGDT"
DGMHVUTL,223,20," S DGEN=$$GETEN(DFN),DGAUTH=$$GETAUTH(DFN),DGMSG=$$GETMSG(DFN)"
DGMHVUTL,224,20," S DGENDT=$$ENDATE(DFN,1),DGAUDT=$$AUTHDATE(DFN,1),DGMSGDT=$$MSGDATE(DFN,1)"
DGMHVUTL,225,20," I DGENDT&($G(DGEN)=1) S FLDARRAY(DGENDT,1)="""",FLDARRAY(DGENDT,1,""TXT"")=1 D"
DGMHVUTL,226,5," .S FLDARRAY(DGENDT,1,""TXT"",1)=""MHV Enrollment ""_$S(DGEN=1:""confirmed."",1:"""")"
DGMHVUTL,227,20," I DGAUDT&($G(DGAUTH)=1) S FLDARRAY(DGAUDT,1)="""",FLDARRAY(DGAUDT,1,""TXT"")=1 D"
DGMHVUTL,228,3," .S FLDARRAY(DGAUDT,1,""TXT"",1)=""MHV Authenticated Upgrade ""_$S(DGAUTH=1:""confirmed."",1:"""")"
DGMHVUTL,229,20," I DGMSGDT&($G(DGMSG)=1) S FLDARRAY(DGMSGDT,1)="""",FLDARRAY(DGMSGDT,1,""TXT"")=1 D"
DGMHVUTL,230,0," .S FLDARRAY(DGMSGDT,1,""TXT"",1)=""MHV Secure Messaging  ""_$S(DGMSG=1:""confirmed."",1:"""")"
DGMHVUTL,231,20," Q"
DGMHVUTL,232,0,"CONSTAT(DFN,DGFLDNO) ; Write condensed patient MHV status"
DGMHVUTL,233,0," N DGEN,DGAUTH,DGMSG,DGMHVFLD"
DGMHVUTL,234,0," N DGENDT,DGAUTHDT,DGMSGDT"
DGMHVUTL,235,0," N DIQ,DIC,DA,DR,DGDTPC,DGTIMPC"
DGMHVUTL,236,0," S DGEN=$$GETEN(DFN)"
DGMHVUTL,237,0," S DGAUTH=$$GETAUTH(DFN)"
DGMHVUTL,238,0," S DGMSG=$$GETMSG(DFN)"
DGMHVUTL,239,0," N DGDASH S $P(DGDASH,""-"",78)=""-"""
DGMHVUTL,240,0," I $G(DGFLDNO(1))!$G(DGFLDNO(2))!$G(DGFLDNO(3)) W !?10,""MHV Enrollment Progress"" ;,?40,""Status"" D"
DGMHVUTL,241,0," W !,DGDASH"
DGMHVUTL,242,0," I $G(DGFLDNO(1)) W !,$$ENDATE(DFN),?10,""[Step 1 of 3]  My HealtheVet Enrollment: "",?56,$S(DGEN=1:""COMPLETED"",DGEN=2:""ACTION PENDING"",DGEN=0:""REFUSED"",1:""UNANSWERED"")"
DGMHVUTL,243,0," I $G(DGFLDNO(2)) W !,$$AUTHDATE(DFN),?10,""[Step 2 of 3]  Authentication Upgrade:"",?56,$S(DGAUTH=1:""COMPLETED: "",DGAUTH=2:""ACTION PENDING"",DGAUTH=0:""REFUSED"",1:""UNANSWERED"")"
DGMHVUTL,244,0," I $G(DGFLDNO(3)) W !,$$MSGDATE(DFN),?10,""[Step 3 of 3]  Secure Messaging Verification:"",?56,$S(DGMSG=1:"" COMPLETED: ""_$$MSGDATE(DFN),DGMSG=2:""ACTION PENDING"",DGMSG=0:""REFUSED:"",1:""UNANSWERED"")"
DGMHVUTL,245,0," ;W !,DGDASH"
DGMHVUTL,246,0," Q"
DGMHVUTL,247,46,"ENDATE(DFN,INTERNAL) ; Most recent date mhv enrollment was updated"
DGMHVUTL,248,46," N DGENDT,DGDTPC,DGTIMPC,DIQ,DIC,DA,DR,DGDTPC,DGTIMPC,MHVFLD"
DGMHVUTL,249,46," S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537030"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVFLD"")"
DGMHVUTL,250,46," S DGENDT=$G(MHVFLD(2,DFN_"","",537030,""I"")) I $G(INTERNAL) Q DGENDT"
DGMHVUTL,251,26," I DGENDT S DGENDT=$$FMTE^XLFDT(DGENDT,2)"
DGMHVUTL,252,26," S $P(DGENDT,""@"",2)=$P($P(DGENDT,""@"",2),"":"",1,2)"
DGMHVUTL,253,26," S DGENDT=$P(DGENDT,""@"")"
DGMHVUTL,254,26," Q DGENDT"
DGMHVUTL,255,39,"AUTHDATE(DFN,INTERNAL) ; Most recent date mhv authentication was updated"
DGMHVUTL,256,39," N DGAUTHDT,DGDTPC,DGTIMPC,DIQ,DIC,DA,DR,DGDTPC,DGTIMPC,MHVFLD"
DGMHVUTL,257,39," S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537031"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVFLD"")"
DGMHVUTL,258,39," S DGAUTHDT=$G(MHVFLD(2,DFN_"","",537031,""I"")) I DGAUTHDT S DGAUTHDT=$$FMTE^XLFDT(DGAUTHDT,2)"
DGMHVUTL,259,39," S $P(DGAUTHDT,""@"",2)=$P($P(DGAUTHDT,""@"",2),"":"",1,2)"
DGMHVUTL,260,39," S DGAUTHDT=$P(DGAUTHDT,""@"")"
DGMHVUTL,261,39," Q DGAUTHDT"
DGMHVUTL,262,33,"MSGDATE(DFN,INTERNAL) ; Most recent date mhv secure messaging was updated"
DGMHVUTL,263,33," N DGMSGDT,DGDTPC,DGTIMPC,DIQ,DIC,DA,DR,DGDTPC,DGTIMPC,MHVFLD"
DGMHVUTL,264,33," S DIQ(0)=""I"",DIC=2,DA=DFN,DR=""537032"" D GETS^DIQ(DIC,DFN,DR,""I"",""MHVFLD"")"
DGMHVUTL,265,33," S DGMSGDT=$G(MHVFLD(2,DFN_"","",537032,""I"")) I DGMSGDT S DGMSGDT=$$FMTE^XLFDT(DGMSGDT,2)"
DGMHVUTL,266,33," S $P(DGMSGDT,""@"",2)=$P($P(DGMSGDT,""@"",2),"":"",1,2)"
DGMHVUTL,267,33," S DGMSGDT=$P(DGMSGDT,""@"")"
DGMHVUTL,268,33," Q DGMSGDT"
Totals for DGMHVUTL,,5093,
DGPREP1,1,0,"DGPREP1 ;ALB/SCK - Program to Display Pre-Registration List Cont. 1 ; 12/9/03 3:22pm"
DGPREP1,2,0," ;;5.3;Registration;**109,136,574,903**;Aug 13, 1993;Build 53"
DGPREP1,3,0," Q"
DGPREP1,4,0,"EH ; Edit call log information"
DGPREP1,5,0," ;   Variables"
DGPREP1,6,0," ;     PTIFN - Patients IEN returned form the SELPAT procedure "
DGPREP1,7,0," ;"
DGPREP1,8,0," N PTIFN,D,X,DA,DR"
DGPREP1,9,0," S PTIFN="""""
DGPREP1,10,0," D SELPAT"
DGPREP1,11,0," Q:'$D(PTIFN)"
DGPREP1,12,0," S DIC=""^DGS(41.43,"",DIC(0)=""EQZ"""
DGPREP1,13,0," S X=PTIFN,D=""C"""
DGPREP1,14,0," S DIC(""A"")=""Select LOG ENTRY: """
DGPREP1,15,0," S DIC(""S"")=""I $P(^(0),U,2)=PTIFN"""
DGPREP1,16,0," ;"
DGPREP1,17,0," D IX^DIC K DIC"
DGPREP1,18,0," ;"
DGPREP1,19,0," I Y>0 D"
DGPREP1,20,0," . S DA=+Y"
DGPREP1,21,0," . S DIE=""^DGS(41.43,"""
DGPREP1,22,0," . S DR=""3;2///^S X=$P(^VA(200,DUZ,0),U)"""
DGPREP1,23,0," . D ^DIE K DIE"
DGPREP1,24,0," . I '$D(Y) D"
DGPREP1,25,0," .. S DGPDFN=PTIFN"
DGPREP1,26,0," .. D BLDHIST^DGPREP0"
DGPREP1,27,0," .. S X=$$SETSTR^VALM1(^TMP(""DGPRERG"",$J,DGPCH,0),"""",1,110)"
DGPREP1,28,0," .. S X=$$SETFLD^VALM1(DGPTAT,X,""HIST"")"
DGPREP1,29,0," .. S ^TMP(""DGPRERG"",$J,DGPCH,0)=X"
DGPREP1,30,0," S VALMBCK=""R"""
DGPREP1,31,0," Q"
DGPREP1,32,0," ;"
DGPREP1,33,0,"SELPAT ;  Select patient if no patient is passed in"
DGPREP1,34,0," N VALMI,VALMAT,VALMY,X"
DGPREP1,35,0," D FULL^VALM1"
DGPREP1,36,0," D EN^VALM2(XQORNOD(0),""S"") S VALMI=0"
DGPREP1,37,0," I '$D(VALMY) S VALMBCK=""R"" Q"
DGPREP1,38,0," S DGPN1="""",DGPCH=$O(VALMY(DGPN1))"
DGPREP1,39,0," S PTIFN="""",PTIFN=$O(^TMP(""DGPRERG"",$J,""DFN"",DGPCH,PTIFN))"
DGPREP1,40,0," Q"
DGPREP1,41,0," ;"
DGPREP1,42,0,"EDIT ;  Edit Patient Information"
DGPREP1,43,0," ;  Variables"
DGPREP1,44,0," ;   DGPDIV    - Division IEN from ^TMP"
DGPREP1,45,0," ;   DGPSTMP   - Date/Time stamp from UPDLOG function"
DGPREP1,46,0," ;   DGPIFN    - Patients IEN from ^TMP"
DGPREP1,47,0," ;   DGPP1-3,5 - Local Var's for $O"
DGPREP1,48,0," ;   DGPNEW    - "
DGPREP1,49,0," ;   DGPFLG    - Flag used to indicate a connect status of 'C'"
DGPREP1,50,0," ;   DGPST     - Call status returned by SELST function"
DGPREP1,51,0," ;   DGPDA     - IEN of Call log entry returned from UPDLOG function"
DGPREP1,52,0," ;   DGPCH     - Entry in the VALMY, selected entries, array"
DGPREP1,53,0," ;   "
DGPREP1,54,0," N VALMI,VALMAT,VALMY,X,DGPN5,DGPDIV,DGPSTMP,DGPIFN,DGPP1,DGPP2,DGPP3,DGPNEW,DGPFLG"
DGPREP1,55,0," ;"
DGPREP1,56,0," D FULL^VALM1"
DGPREP1,57,0," D EN^VALM2(XQORNOD(0),""S"") S VALMI=0"
DGPREP1,58,0," I '$D(VALMY) S VALMBCK=""R"" Q"
DGPREP1,59,0," S DGPN1="""",DGPCH=$O(VALMY(DGPN1))"
DGPREP1,60,0," S DGPIFN="""",DGPIFN=$O(^TMP(""DGPRERG"",$J,""DFN"",DGPCH,DGPIFN))"
DGPREP1,61,0," S DGPDIV="""",DGPDIV=$O(^TMP(""DGPRERG"",$J,""DIV"",DGPCH,DGPDIV))"
DGPREP1,62,0," S DGNEW=0,DGPFLG=0"
DGPREP1,63,0," ;"
DGPREP1,64,0," ; *** Check patient sensitivity before proceeding"
DGPREP1,65,0," S DIC=2,DIC(0)=""ENQ"",X=DGPIFN D ^DIC K DIC"
DGPREP1,66,0," Q:Y<0"
DGPREP1,67,0," ;"
DGPREP1,68,0," ; *** Check lock status before continuing"
DGPREP1,69,0," S DGPN5="""",DGPN5=$O(^DGS(41.42,""B"",DGPIFN,DGPN5))"
DGPREP1,70,0," I DGPN5]"""" L +^DGS(41.42,DGPN5):2 I '$T W *7,!,""Another User is Editing this Patient"" S VALMBCK=""R"" Q"
DGPREP1,71,0," ;"
DGPREP1,72,0," S (DA,DFN)=DGPIFN"
DGPREP1,73,0," ;"
DGPREP1,74,0," S DGPFLG=1"
DGPREP1,75,0," S DGPSTMP="""""
DGPREP1,76,0," D INITLE(.DGPSTMP)"
DGPREP1,77,0," ;"
DGPREP1,78,0," I DGPCH]""""&(DGPFLG) D"
DGPREP1,79,0," . S X=$$SETSTR^VALM1(^TMP(""DGPRERG"",$J,DGPCH,0),"""",1,110)"
DGPREP1,80,0," . ;S X=$$SETSTR^VALM1(""*"",X,8,1)"
DGPREP1,81,0," . I $G(DGPSTMP)]"""" S X=$$SETSTR^VALM1($$FMTE^XLFDT(DGPSTMP,""2D""),X,70,8)"
DGPREP1,82,0," . S ^TMP(""DGPRERG"",$J,DGPCH,0)=X"
DGPREP1,83,0," . S DIE=""^DGS(41.42,"",DA=DGPN5"
DGPREP1,84,0," . S DR=""4///Y"" I DGPSTMP]"""" S DR=DR_"";3///^S X=DGPSTMP"""
DGPREP1,85,0," . D ^DIE K DIE"
DGPREP1,86,0," L -^DGS(41.42,DGPN5)"
DGPREP1,87,0," K DGPENT,DGPN1,DGPCH,DGPLOC,DGPST,DGPN5,DGPFLG"
DGPREP1,88,0," Q"
DGPREP1,89,0," ;"
DGPREP1,90,22,"INITLE(DGPY) ; Initialize for Load/Edit"
DGPREP1,91,0," ;   Variables"
DGPREP1,92,0," ;     Input:"
DGPREP1,93,0," ;        DGPY - Null value"
DGPREP1,94,0," ;"
DGPREP1,95,0," ;     Returns:"
DGPREP1,96,0," ;        DGPY - Returns the date/time stamp entered into ^DGS(41.41,."
DGPREP1,97,0," ;"
DGPREP1,98,0," ;     Local:"
DGPREP1,99,0," ;        DGPRFLG - This flag is used by the Patient Load/Edit routines"
DGPREP1,100,0," ;                  to indicate they were called by preregistration"
DGPREP1,101,0," ;        DGPLOC  - Flag used by DG10 to indicate preselection of a patient"
DGPREP1,102,0," ;"
DGPREP1,103,22," N DGPRFLG"
DGPREP1,104,22," S (DGPRFLG,DGPLOC)=1"
DGPREP1,105,22," W !!"
DGPREP1,106,22," D ^DG10"
DGPREP1,107,21," Q:$G(DGPFLG)&($G(DGRPOUT))"
DGPREP1,108,0," ;"
DGPREP1,109,0," S DGPST=$$SELST"
DGPREP1,110,0," I DGPST']"""" S VALMBCK=""R"" Q"
DGPREP1,111,0," ;"
DGPREP1,112,0," I DGPST'=""L"" D"
DGPREP1,113,0," . S DGPDA=$$UPDLOG(DGPIFN,DGPST,DGPDIV) Q:DGPDA'>0"
DGPREP1,114,0," . I '$G(DGMODE),$P($G(^DGS(41.43,DGPDA,0)),U,4)]"""" D"
DGPREP1,115,0," .. S X=$$SETSTR^VALM1(^TMP(""DGPRERG"",$J,DGPCH,0),"""",1,110)"
DGPREP1,116,0," .. S DGPP1=$E(X,1,34),DGPP2=$E(X,35,38),DGPP3=$E(X,39,110)"
DGPREP1,117,0," .. S DGPP2=$P(^DGS(41.43,DGPDA,0),U,4)_DGPP2"
DGPREP1,118,0," .. S X=DGPP1_$E(DGPP2,1,4)_DGPP3"
DGPREP1,119,0," .. S ^TMP(""DGPRERG"",$J,DGPCH,0)=X"
DGPREP1,120,0," ;"
DGPREP1,121,0," W !"
DGPREP1,122,0," S DIR(0)=""YA"",DIR(""A"")=""Date/Time stamp this patient? "",DIR(""B"")=""YES"""
DGPREP1,123,0," D ^DIR K DIR"
DGPREP1,124,0," W !"
DGPREP1,125,0," I Y D"
DGPREP1,126,0," . K DD,DO"
DGPREP1,127,0," . S DGPY=$$NOW^XLFDT"
DGPREP1,128,0," . S DIC=""^DGS(41.41,"",DIC(0)=""EQZ"",X=DFN"
DGPREP1,129,0," . S DIC(""DR"")=""1///^S X=DGPY;2////^S X=DUZ"""
DGPREP1,130,0," . D FILE^DICN"
DGPREP1,131,0," . K DIC"
DGPREP1,132,0," ;"
DGPREP1,133,0," Q"
DGPREP1,134,0,"STAT ; Display call history"
DGPREP1,135,0," K PTIFN D SELPAT"
DGPREP1,136,0," I $D(PTIFN) D"
DGPREP1,137,0," . D EN^DGPREP2"
DGPREP1,138,0," K PTIFN"
DGPREP1,139,0," Q"
DGPREP1,140,0," ;"
DGPREP1,141,0,"SELST() ;  Function to select status for call log"
DGPREP1,142,0," ;   Returns:"
DGPREP1,143,0," ;       Status code as a SOC"
DGPREP1,144,0," ;"
DGPREP1,145,0," K DIRUT"
DGPREP1,146,0," N DIR"
DGPREP1,147,0," W !!"
DGPREP1,148,0," S DIR(0)=""41.43,3"""
DGPREP1,149,0," S DIR(""A"")=""STATUS OF CALL"",DIR(""B"")=""CONNECTED"""
DGPREP1,150,0," S DIR(""?"",1)=""Enter the status of the current call from the list below."""
DGPREP1,151,0," S DIR(""?"")=""Entries must be in uppercase, and match on of these codes."""
DGPREP1,152,0," D ^DIR K DIR"
DGPREP1,153,0," Q $G(Y)"
DGPREP1,154,0," ;"
DGPREP1,155,0,"UPDLOG(DFN,DGPS,DGPDV) ;  Update PRE-REGISTRATION CALL LOG File, #41.43"
DGPREP1,156,0," ;"
DGPREP1,157,0," ;  Variables"
DGPREP1,158,0," ;    Input:"
DGPREP1,159,0," ;       DFN   - The IEN of the patient being called"
DGPREP1,160,0," ;       DGPS  - Status of the call attempt"
DGPREP1,161,0," ;       DGPDV - Division IEN (used for sorting)"
DGPREP1,162,0," ;"
DGPREP1,163,0," ;    Returns:"
DGPREP1,164,0," ;        The IEN of the CALL LOG, File #41.43, entry that was added. "
DGPREP1,165,0," ;        0 is returned if the user ^'s out."
DGPREP1,166,0," ;"
DGPREP1,167,0," K DD,DO"
DGPREP1,168,0," S DIC=""^DGS(41.43,"""
DGPREP1,169,0," S DIC(0)=""L"""
DGPREP1,170,0," S X=$$NOW^XLFDT"
DGPREP1,171,0," D FILE^DICN"
DGPREP1,172,0," I Y<0 W *7,""Problem adding to file - PRE-REGISTRATION CALL LOG"""
DGPREP1,173,0," I Y'<0 D"
DGPREP1,174,0," . S DIE=""^DGS(41.43,"""
DGPREP1,175,0," . S DR=""1////^S X=DFN;2////^S X=DUZ;3///^S X=DGPS;5////^S X=$S(+DGPDV>0:DGPDV,1:"""""""")"""
DGPREP1,176,0," . S DA=+Y"
DGPREP1,177,0," . D ^DIE K DIE"
DGPREP1,178,0," . I $D(Y) D "
DGPREP1,179,0," .. S DIK=""^DGS(41.43,"" D ^DIK K DIK"
DGPREP1,180,0," Q +$G(DA)"
DGPREP1,181,0," ;"
DGPREP1,182,0,"DIREDT ;  Direct edit of a patient in the PRE-REGISTRATION CALL LIST, bypassing the call list."
DGPREP1,183,0," ;"
DGPREP1,184,0," ;  Variables"
DGPREP1,185,0," ;    DFN    - Patients IEN, set for Load/Edit"
DGPREP1,186,0," ;    DGPDIV - Division IEN from File #41.42"
DGPREP1,187,0," ;    DGPST  - Call Status"
DGPREP1,188,0," ;    DGPIDX - Call List IEN, File #41.42"
DGPREP1,189,0," ;    DGPFLG - Flag for direct patient edit, used for setting 'called' status"
DGPREP1,190,0," ;    DGPSTMP - Date/time stamp"
DGPREP1,191,0," ;"
DGPREP1,192,23," N DFN,DGPDIV,DGPST,DGPIDX,DGPFLG,DGNEW,DGPXX,DGPSTMP,DGPX,DGPIFN,DGMODE"
DGPREP1,193,23," N DGRPOUT,DGMHVOUT,DGMHVNOS"
DGPREP1,194,0," ;"
DGPREP1,195,23," K DTOUT,DUOUT,DIC"
DGPREP1,196,23," S DIC=2,DIC(0)=""AEQZM"""
DGPREP1,197,23," S DIC(""A"")=""Select Patient to Preregister: """
DGPREP1,198,23," S DIC(""?"")=""Select a patient whose preregistration information you want to edit."""
DGPREP1,199,23," D ^DIC K DIC"
DGPREP1,200,23," I $D(DTOUT)!($D(DUOUT))!(Y<0) Q"
DGPREP1,201,0," ;"
DGPREP1,202,23," S (DFN,DGPIFN)=+Y,DGPIDX="""""
DGPREP1,203,23," I $D(^DGS(41.42,""B"",DFN)) D  Q:$G(DGPX)"
DGPREP1,204,0," . S DGPIDX=$O(^DGS(41.42,""B"",DFN,DGPIDX))"
DGPREP1,205,0," . S DGPDIV=$P($G(^DGS(41.42,DGPIDX,0)),U,2)"
DGPREP1,206,0," . I DGPIDX]"""" L +^DGS(41.42,DGPIDX):2 I '$T W *7,!,""Another user is editing this patient."" S DGPX=1"
DGPREP1,207,0," ;"
DGPREP1,208,23," D"
DGPREP1,209,23," .N DGABB,DGMHVOUT"
DGPREP1,210,23," .I '$$MHVOK^DGMHVAC(DFN) D EN^DGMHV(DFN) Q"
DGPREP1,211,3," .D EN^DGMHVAC(DFN)"
DGPREP1,212,0," ;"
DGPREP1,213,22," S DGNEW=0,DGPFLG=1,DGPSTMP="""",DGMODE=1"
DGPREP1,214,0," ;"
DGPREP1,215,0," ;  ** Since this is a direct call for a patient, and the particular appt. is not known, set DGPDIV to primary medical center division."
DGPREP1,216,22," I $G(DGPDIV)']"""" D"
DGPREP1,217,22," . S DGPDIV=$$PRIM^VASITE"
DGPREP1,218,0," ;"
DGPREP1,219,22," D INITLE(.DGPSTMP)"
DGPREP1,220,0," ;"
DGPREP1,221,21," I $G(DGRPOUT) G UNLCK"
DGPREP1,222,0," ;"
DGPREP1,223,0," I $G(DGPFLG),DGPIDX]"""" D"
DGPREP1,224,0," . S DA=DGPIDX"
DGPREP1,225,0," . S DIE=""^DGS(41.42,"""
DGPREP1,226,0," . S DR=""4///Y"" I DGPSTMP]"""" S DR=DR_"";3///^S X=DGPSTMP"""
DGPREP1,227,0," . D ^DIE K DIE"
DGPREP1,228,0," ;"
DGPREP1,229,21,"UNLCK I $G(DGPIDX)]"""" L -^DGS(41.42,DGPIDX)"
DGPREP1,230,21," Q"
Totals for DGPREP1,,584,
DGRPC,1,0,"DGRPC    ;ALB/MRL/PJR/PHH/EG/BAJ,TDM,LBD - CHECK CONSISTENCY OF PATIENT DATA ; 6/29/11 3:50pm"
DGRPC,2,2," ;;5.3;Registration;**108,121,314,301,470,489,505,451,568,585,641,653,688,754,797,867,903**;Aug 13, 1993;Build 53"
DGRPC,3,0," ;"
DGRPC,4,0," ;linetags in routines correspond to IEN of file 38.6"
DGRPC,5,0," ;"
DGRPC,6,0," ;variables:  DGVT = 1 if VETERAN? = YES, 0 if NO"
DGRPC,7,0," ;    DGSC = 1 if SC? = YES, 0 if NO"
DGRPC,8,0," ;    DGCD = 0 node of file EC file (#8)"
DGRPC,9,0," ;        DGRPCOLD = old inconsistencies for pt (separated by ,s)"
DGRPC,10,0," ;   DGCHK = #s to check (separated by ,s)"
DGRPC,11,0," ;   DGLST = next # to check"
DGRPC,12,0," ;    DGER = inconsistencies found (separated by ,s)"
DGRPC,13,0," ;   DGNCK = 1 if missing key elig data...can't process further"
DGRPC,14,0," ;"
DGRPC,15,2," N ANYMSE,CONARR,CONCHK,CONERR,CONSPEC,LOC,I5,I6,DGPMSE"
DGRPC,16,2," N MSECHK,MSESET,MSERR,MSDATERR,RANGE,RANSET,OVER99"
DGRPC,17,2," D ON I $S(('$D(DFN)#2):1,'$D(^DPT(DFN,0)):1,DGER:1,1:0) G KVAR^DGRPCE:DGER"
DGRPC,18,2,"EN       S:'$D(DGEDCN)#2 DGEDCN=0 I DGEDCN W !!,""Checking data for consistency..."""
DGRPC,19,2," D START:DGEDCN"
DGRPC,20,2," F I=0,.13,.141,.121,.122,.22,.24,.3,.31,.311,.32,.321,.322,.33,.35,.36,.362,.38,.39,.52,.53,""TYPE"",""VET"" S DGP(I)=$G(^DPT(DFN,I))"
DGRPC,21,0," ;Get MSEs from MSE sub-file #2.3216 (DG*5.3*797)"
DGRPC,22,2," I '$D(^DPT(DFN,.3216)) D MOVMSE^DGMSEUTL(DFN)"
DGRPC,23,2," D GETMSE^DGMSEUTL(DFN,.DGPMSE)"
DGRPC,24,0," ;get old inconsistencies"
DGRPC,25,2," S DGRPCOLD="","" I $D(^DGIN(38.5,DFN)) F I=0:0 S I=$O(^DGIN(38.5,DFN,""I"",I)) Q:'I  S DGRPCOLD=DGRPCOLD_I_"","""
DGRPC,26,0," ;find consistencies to check/not check"
DGRPC,27,0," ; DG*5.3*653 modified to exclude checks numbered>99  BAJ  10/25/2005"
DGRPC,28,2," S DGCHK="","" F I=0:0 S I=$O(^DGIN(38.6,I)) Q:'I!(I=99)  I $D(^(I,0)),$S(I=2:0,I=51:0,I=9:1,I=10:1,I=13:1,I=14:1,I=22:1,I=52:1,I=53:1,'$P(^(0),""^"",5):1,1:0),I'=99 S DGCHK=DGCHK_I_"","""
DGRPC,29,2," S OVER99="",301,303,304,306,307,308,313,314,315,402,403,406,407,501,502,503,504,505,506,507,516,517,"""
DGRPC,30,2," S DGVT=$S(DGP(""VET"")=""Y"":1,1:0),DGSC=$S($P(DGP(.3),""^"",1)=""Y"":1,1:0),DGCD=$S($D(^DIC(8,+DGP(.36),0)):^(0),1:""""),(DGCT,DGER,DGNCK)="""" I 'DGVT,$D(^DG(391,+DGP(""TYPE""),0)),$P(^(0),""^"",2) S DGVT=2"
DGRPC,31,2," S DGLST=+$P(DGCHK,"","",2) G @DGLST"
DGRPC,32,2,"1        S DGD=$P(DGP(0),""^"",1) I DGD?1L.E!(DGD?.E1L.E)!(DGD="""") S X=1 D COMB,NEXT I +DGLST'=2 G @DGLST"
DGRPC,33,2," S I1=0 F I=1:1:$L(DGD) Q:I1  S J=$E(DGD,I) I J?1NP,$A(J)>32,J'="","",J'=""-"",J'=""."",J'=""'"" S I1=1"
DGRPC,34,2," I I1 S X=1 D COMB"
DGRPC,35,2," D NEXT I +DGLST'=2 G @DGLST"
DGRPC,36,0,"2        S I1=0 F I=0:0 S I=$O(^DPT(DFN,.01,I)) Q:'I!(I1)  I $P(^(I,0),""^"",1)'?1A.E S I1=1"
DGRPC,37,0," I I1 S X=2 D COMB"
DGRPC,38,0," D NEXT I +DGLST>7!('DGLST) G @DGLST"
DGRPC,39,0,"3        ;"
DGRPC,40,0,"4        ;"
DGRPC,41,0,"5        ;"
DGRPC,42,0,"6        ;"
DGRPC,43,2,"7        F I=2,3,5,8,9 I $P(DGP(0),""^"",I)="""" S X=$S(I=2:3,I=3:4,I=5:5,I=8:6,1:7) D COMB:DGCHK[("",""_X_"","")"
DGRPC,44,2," S DGLST=7 G:DGCHK'["",7,"" FIND^DGRPC2 D NEXT I +DGLST'=8 G @DGLST"
DGRPC,45,2,"8        S I1=0,DGD=$G(^DPT(DFN,.11)) I '$P(DGD,""^"",10) S I1=1,X=8 D COMB,NEXT G @DGLST"
DGRPC,46,2," I '$D(^HL(779.004,$P(DGD,""^"",10))) S I1=1,X=8 D COMB,NEXT G @DGLST"
DGRPC,47,2," N STR8 S STR8=""1,4,5,6,7"" I $$FORIEN^DGADDUTL($P(DGD,""^"",10)) S STR8=""1,4"""
DGRPC,48,2," F T=1:1:$L(STR8,"","") S I=$P(STR8,"","",T) Q:I1  I $P(DGD,""^"",I)="""" S I1=1"
DGRPC,49,2," I I1 S X=8 D COMB"
DGRPC,50,2," D NEXT I +DGLST'=9 G @DGLST"
DGRPC,51,2,"9        I DGP(""VET"")="""" S X=9,DGNCK=1 D COMB"
DGRPC,52,2," D NEXT I +DGLST'=10 G @DGLST"
DGRPC,53,2,"10       I $P(DGP(.3),""^"",1)="""" S X=10,DGNCK=1 D COMB"
DGRPC,54,2," D NEXT I +DGLST'=11 G @DGLST"
DGRPC,55,2,"11       I 'DGVT,DGSC S X=11 D COMB"
DGRPC,56,2," D NEXT I +DGLST'=12 G @DGLST"
DGRPC,57,2,"12       I DGSC,DGVT,$P(DGP(.3),""^"",2)="""" S X=12 D COMB"
DGRPC,58,2," D NEXT I +DGLST'=13 G @DGLST"
DGRPC,59,2,"13       I '$D(^DIC(21,+$P(DGP(.32),""^"",3),0)) S X=13,DGNCK=1 D COMB"
DGRPC,60,2," D NEXT I +DGLST'=14 G @DGLST"
DGRPC,61,2,"14       I $P(DGCD,""^"",1)="""" S X=14,DGNCK=1 D COMB"
DGRPC,62,0," ;"
DGRPC,63,0," ;Check Patient Eligibilities multiple if Primary Elig Code defined"
DGRPC,64,2," I DGP(.36),'$D(^DPT(DFN,""E"",+DGP(.36),0)) D PRI^VADPT60 ;5.3*301"
DGRPC,65,0," ;"
DGRPC,66,2," D NEXT I +DGLST'=15 G FIND^DGRPC2:+DGLST=35,@DGLST"
DGRPC,67,2,"15       I $P($G(^DPT(DFN,.15)),""^"",2)]"""",$P(DGP(.3),""^"",7)="""" S X=15 D COMB"
DGRPC,68,2," D NEXT I +DGLST'=16 G FIND^DGRPC2:+DGLST=35,@DGLST"
DGRPC,69,2,"16       D H^DGUTL I +DGP(.35)>DGTIME S X=16 D COMB"
DGRPC,70,2," D NEXT I +DGLST'=17 G FIND^DGRPC2:+DGLST=35,@DGLST"
DGRPC,71,2,"17       K DGDATE,DGTIME"
DGRPC,72,2," N SDARRAY,SDCLIEN,SDDATE"
DGRPC,73,2," S I1=0,DGD=DT"
DGRPC,74,2," S SDARRAY(""FLDS"")=3"
DGRPC,75,2," S SDARRAY(4)=DFN"
DGRPC,76,2," I +DGP(.35),$$SDAPI^SDAMA301(.SDARRAY) D"
DGRPC,77,0," .;if there is data hanging from the 101 subscript,"
DGRPC,78,0," .;then this is a valid appointment"
DGRPC,79,0," .;otherwise it is an error eg 01/21/2005"
DGRPC,80,0," .I $D(^TMP($J,""SDAMA301"",101))=1 Q"
DGRPC,81,0," .S SDCLIEN=0"
DGRPC,82,0," .F  S SDCLIEN=$O(^TMP($J,""SDAMA301"",DFN,SDCLIEN)) Q:'SDCLIEN!(I1)  D"
DGRPC,83,0," ..S SDDATE=0"
DGRPC,84,0," ..F  S SDDATE=$O(^TMP($J,""SDAMA301"",DFN,SDCLIEN,SDDATE)) Q:'SDDATE!(I1)  D"
DGRPC,85,0," ...S X=$P($P(^TMP($J,""SDAMA301"",DFN,SDCLIEN,SDDATE),""^"",3),"";"")"
DGRPC,86,0," ...I X=""""!(X=""I"") S I1=1"
DGRPC,87,2," K ^TMP($J,""SDAMA301"")"
DGRPC,88,2," I I1 S X=17 D COMB"
DGRPC,89,0," ;"
DGRPC,90,0,"END      ; end of routine...find next check to execute (or goto end)"
DGRPC,91,2," S:DGNCK DGLST=35 G:DGCHK'["",35,""&(DGNCK) FIND^DGRPC2 D NEXT G @DGLST"
DGRPC,92,0," ;"
DGRPC,93,0,"COMB     ;record inconsistency"
DGRPC,94,4," S DGCT=DGCT+1,DGER=DGER_X_"","",DGLST=X Q"
DGRPC,95,0," Q"
DGRPC,96,0," ;"
DGRPC,97,0,"NEXT     ; find the next consistency check to check (goto end if can't process further)"
DGRPC,98,22," S I=$F(DGCHK,("",""_DGLST_"","")),DGLST=+$E(DGCHK,I,999) I +DGLST,DGLST<18 Q"
DGRPC,99,0," I +DGLST,DGNCK,+DGLST>17,+DGLST<36 S DGLST=35 Q:DGCHK'["",35,""  G NEXT"
DGRPC,100,0," S:'+DGLST DGLST=""END^DGRPC3"" I +DGLST S DGLST=DGLST_""^DGRPC""_$S(+DGLST<43:1,+DGLST<79:2,1:3)"
DGRPC,101,0," Q"
DGRPC,102,0," ;"
DGRPC,103,0,"PAT      ;check inconsistencies for a selected patient"
DGRPC,104,0," D ON G KVAR^DGRPCE:DGER W !! S DIC=""^DPT("",DIC(0)=""AEQMZ"",DIC(""A"")=""Check consistency for which PATIENT: "" D ^DIC K DIC G KVAR^DGRPCE:Y'>0 S DFN=+Y,DGEDCN=1 D DGRPC G PAT"
DGRPC,105,0," ;"
DGRPC,106,0,"START    ;record start time for checker"
DGRPC,107,3," S DGSTART=$H Q"
DGRPC,108,0," ;"
DGRPC,109,0,"TIME     ;record end time for checker"
DGRPC,110,2," Q:'$D(DGSTART)#2  S DGEND=$H,X=$P(DGSTART,"","",2),X1=$P(DGEND,"","",2)"
DGRPC,111,2," I +DGSTART=+DGEND S DGTIME=X1-X"
DGRPC,112,2," E  S DGTIME=(5184000-X)+X1"
DGRPC,113,2," I $S(DGCT:0,DGCON=1:1,1:0) G TIMEQ"
DGRPC,114,2," W !!,""===> "",$S(DGCT:DGCT,DGCON<2:""No"",1:""All""),"" inconsistenc"",$S(DGCT=1:""y"",1:""ies""),"" "",$S('DGCON:""found"",DGCON=1:""filed"",1:""removed""),"" in "",DGTIME,"" second"",$S(DGTIME=1:"""",1:""s""),""..."" H 1"
DGRPC,115,2,"TIMEQ    K DGSTART,DGEND,DGTIME,X,X1,DGCON Q"
DGRPC,116,0," ;"
DGRPC,117,0,"ON       ;check if checker is on"
DGRPC,118,2," S DGER=0 I $S('$D(^DG(43,1,0)):1,'$P(^(0),""^"",37):1,1:0) S DGER=1"
DGRPC,119,2," S:'$D(DGEDCN) DGEDCN=0 W:DGER !!,""CONSISTENCY CHECKER TURNED OFF!!"",$C(7) Q"
Totals for DGRPC,,149,
DGRPC3,1,0,"DGRPC3   ;ALB/PJR,LBD,BAJ,TDM - CHECK CONSISTENCY OF PATIENT DATA (CONT) ; 10/20/10 3:40pm"
DGRPC3,2,0," ;;5.3;Registration;**451,632,673,657,688,754,797,867,903**;Aug 13, 1993;Build 53"
DGRPC3,3,0," ;"
DGRPC3,4,1,"79       ;; MSE Dates overlap"
DGRPC3,5,1," ;; Don't check if MSE Dates Incomplete or if MSE TO precedes FROM"
DGRPC3,6,1," ;; or unless at least 2 ranges"
DGRPC3,7,1," S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK I MSDATERR!($L(ANYMSE)<2) D NEXT G @DGLST"
DGRPC3,8,0," ;Use MSE data in DGPMSE array, if it exists (DG*5.3*797)"
DGRPC3,9,0," I $D(DGPMSE) D  D NEXT G @DGLST"
DGRPC3,10,0," .N MS,MSE,OUT S MS=0 F  S MS=$O(DGPMSE(MS)) Q:'MS!($G(OUT))  D"
DGRPC3,11,0," ..I $P(DGPMSE(MS),U,7) Q  ;Don't check MSE verified by HEC"
DGRPC3,12,0," ..S MSE=$O(DGPMSE(MS,0)) Q:'MSE"
DGRPC3,13,0," ..I '$$OVRLPCHK^DGRPDT(DFN,$P(DGPMSE(MS),U),$P(DGPMSE(MS),U,2),1,"""","""",MSE) S X=79 D COMB S (MSERR,OUT)=1 Q"
DGRPC3,14,0," ;Otherwise, use MSE data in DGP(.32)"
DGRPC3,15,0," I ANYMSE[1,'$$OVRLPCHK^DGRPDT(DFN,$P(DGP(.32),""^"",6),$P(DGP(.32),""^"",7),1,"".326^.327"") S X=79 D COMB S MSERR=1 D NEXT G @DGLST"
DGRPC3,16,0," I ANYMSE'[1,'$$OVRLPCHK^DGRPDT(DFN,$P(DGP(.32),""^"",11),$P(DGP(.32),""^"",12),1,"".3292^.3293"") S X=79 D COMB S MSERR=1 D NEXT G @DGLST"
DGRPC3,17,0," D NEXT G @DGLST"
DGRPC3,18,1,"80       ;; POW Dates not within MSE"
DGRPC3,19,1," ;; Check turned off by EVC project (DG*5.3*688)"
DGRPC3,20,1," D NEXT G @DGLST"
DGRPC3,21,1,"81       ;; Combat Dates not within MSE"
DGRPC3,22,1," I '$P(DGP(.52),""^"",12) D NEXT G @DGLST ;; Don't check if no COMBAT Data"
DGRPC3,23,0," ;; Don't check if COMBAT Data Incomplete or if COMBAT TO precedes FROM"
DGRPC3,24,0," I (("",""_DGER_"","")[("",39,""))!(("",""_DGER_"","")[("",40,"")) D NEXT G @DGLST"
DGRPC3,25,0," S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK S:'$G(MSESET) MSESET=$$MSFROMTO^DGMSCK"
DGRPC3,26,0," ;; If COMBAT, but no MSE, then Range is NOT within MSE"
DGRPC3,27,0," I 'ANYMSE S X=81 D COMB D NEXT G @DGLST"
DGRPC3,28,0," I '$$RWITHIN^DGRPDT($P(MSESET,""^"",1),$P(MSESET,""^"",2),$P(DGP(.52),""^"",13),$P(DGP(.52),""^"",14)) S X=81 D COMB"
DGRPC3,29,0," D NEXT G @DGLST"
DGRPC3,30,1,"82       ;; Conflict Dates not within MSE"
DGRPC3,31,1," S:'$G(CONCHK) CONCHK=$$CNCK^DGMSCK"
DGRPC3,32,1," S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK S:'$G(MSESET) MSESET=$$MSFROMTO^DGMSCK"
DGRPC3,33,1," S LOC="""",I2=0 F I1=1:1 S LOC=$O(CONSPEC(LOC)) Q:LOC=""""  I CONARR(LOC)=1 D"
DGRPC3,34,0," .N FROMDAT,FROMPC,TODAT,TOPC,NODE,DATA"
DGRPC3,35,0," .S DATA=CONSPEC(LOC)"
DGRPC3,36,0," .S NODE=$P(DATA,"","",1),FROMPC=$P(DATA,"","",3),TOPC=$P(DATA,"","",4)"
DGRPC3,37,0," .S FROMDAT=$P(DGP(NODE),""^"",FROMPC),TODAT=$P(DGP(NODE),""^"",TOPC)"
DGRPC3,38,0," .I '$$RWITHIN^DGRPDT($P(MSESET,""^"",1),$P(MSESET,""^"",2),FROMDAT,TODAT) S X=82 D COMB:'I2 S CONARR(LOC)=2,I2=1"
DGRPC3,39,0," .Q"
DGRPC3,40,0," ; Check OIF/OEF conflict dates"
DGRPC3,41,1," N DGOEIF D GET^DGENOEIF(DFN,.DGOEIF,0,"""",0)"
DGRPC3,42,1," I $G(DGOEIF(""COUNT"")),DGER'["",82,"" D"
DGRPC3,43,0," . N Z"
DGRPC3,44,0," . S Z=0 F  S Z=$O(DGOEIF(""IEN"",Z)) Q:'Z  D  Q:DGER["",82,"""
DGRPC3,45,0," .. S FROMDAT=$G(DGOEIF(""FR"",Z)),TODAT=$G(DGOEIF(""TO"",Z)),LOC=$G(DGOEIF(""LOC"",Z))"
DGRPC3,46,0," .. I '$$RWITHIN^DGRPDT($P(MSESET,""^"",1),$P(MSESET,""^"",2),FROMDAT,TODAT) S X=82 D COMB S I2=1"
DGRPC3,47,1," D NEXT G @DGLST"
DGRPC3,48,0,"83       ;Merchant Seaman or Filipino Vet BOS requires service dates during WWII"
DGRPC3,49,1," N BOS,BOSN,MS,MSE,OUT"
DGRPC3,50,0," ;Use MSE data from DGPMSE array, if it exists (DG*5.3*797)"
DGRPC3,51,1," I $D(DGPMSE) D  D NEXT G @DGLST"
DGRPC3,52,0," .S MS=0 F  S MS=$O(DGPMSE(MS)) Q:'MS!($G(OUT))  D"
DGRPC3,53,0," ..I $P(DGPMSE(MS),U,7) Q  ;Don't check MSE if verified by HEC"
DGRPC3,54,0," ..S BOS=$P(DGPMSE(MS),U,3) Q:'BOS  S BOSN=$P(^DIC(23,BOS,0),U)"
DGRPC3,55,0," ..S MSE=$O(DGPMSE(MS,0)) Q:'MSE  S MSE=""MSE-""_MSE"
DGRPC3,56,0," ..I $$BRANCH^DGRPMS(BOS_U_BOSN),'$$WWII^DGRPMS(DFN,"""",MSE) S X=83 D COMB S OUT=1 Q"
DGRPC3,57,0," ;Otherwise, get MSE data from DGP(.32)"
DGRPC3,58,1," F MS=1:1:3 D  Q:$G(OUT)"
DGRPC3,59,2," .I MS=2,$P(DGP(.32),U,19)'=""Y"" S OUT=1 Q"
DGRPC3,60,1," .I MS=3,$P(DGP(.32),U,20)'=""Y"" S OUT=1 Q"
DGRPC3,61,1," .S BOS=$P(DGP(.32),U,(5*MS)) Q:'BOS  S BOSN=$P($G(^DIC(23,BOS,0)),U)"
DGRPC3,62,0," .S MSE=$S(MS=1:""MSL"",MS=2:""MSNTL"",1:""MSNNTL"")"
DGRPC3,63,0," .I $$BRANCH^DGRPMS(BOS_U_BOSN),'$$WWII^DGRPMS(DFN,"""",MSE) S X=83 D COMB S OUT=1 Q"
DGRPC3,64,1," D NEXT G @DGLST"
DGRPC3,65,0,"84       ;Filipino Vet BOS requires Filipino Vet Proof"
DGRPC3,66,1," N MS,BOS,OUT,MSE"
DGRPC3,67,0," ;Use MSE data from DGPMSE array, if it exists (DG*5.3*797)"
DGRPC3,68,1," I $D(DGPMSE) D  D NEXT G @DGLST"
DGRPC3,69,0," .S MS=0 F  S MS=$O(DGPMSE(MS)) Q:'MS!($G(OUT))  D"
DGRPC3,70,0," ..I $P(DGPMSE(MS),U,7) Q  ;Don't check MSE if verified by HEC"
DGRPC3,71,0," ..S BOS=$P(DGPMSE(MS),U,3) Q:'BOS"
DGRPC3,72,0," ..I $$FV^DGRPMS(BOS)=1,$P(DGP(.321),U,14)="""" S X=84 D COMB S OUT=1 Q"
DGRPC3,73,0," ;Otherwise use MSE data in DGP(.32)"
DGRPC3,74,1," F MS=1:1:3 D  Q:$G(OUT)"
DGRPC3,75,2," .I MS=2,$P(DGP(.32),U,19)'=""Y"" S OUT=1 Q"
DGRPC3,76,1," .I MS=3,$P(DGP(.32),U,20)'=""Y"" S OUT=1 Q"
DGRPC3,77,1," .S BOS=$P(DGP(.32),U,(5*MS))"
DGRPC3,78,1," .I $$FV^DGRPMS(BOS)=1,$P(DGP(.321),U,14)="""" S X=84 D COMB S OUT=1 Q"
DGRPC3,79,1," D NEXT G @DGLST"
DGRPC3,80,0,"85       ;Eligible Filipino Vet should have Veteran status = 'YES'"
DGRPC3,81,0,"86       ;Ineligible Filipino Vet should have Veteran status = 'NO'"
DGRPC3,82,1," N MS,BOS,FV,FILV,NOTFV,MSE,OUT"
DGRPC3,83,0," ;Use MSE data from DGPMSE array, if it exists (DG*5.3*797)"
DGRPC3,84,1," I $D(DGPMSE) D"
DGRPC3,85,0," .S MS=0 F  S MS=$O(DGPMSE(MS)) Q:'MS!($G(OUT))  D"
DGRPC3,86,0," ..I $P(DGPMSE(MS),U,7) Q  ;Don't check MSE if verified by HEC"
DGRPC3,87,0," ..S BOS=$P(DGPMSE(MS),U,3),FV=$$FV^DGRPMS(BOS) I 'FV S NOTFV="""" Q"
DGRPC3,88,0," ..S MSE=$O(DGPMSE(MS,0)) Q:'MSE  S MSE=""MSE-""_MSE"
DGRPC3,89,0," ..I '$$WWII^DGRPMS(DFN,"""",MSE) S FILV(""I"")="""" Q"
DGRPC3,90,0," ..I FV=2 S FILV(""E"")="""" Q"
DGRPC3,91,0," ..I $P(DGP(.321),U,14)=""""!($P(DGP(.321),U,14)=""NO"") S FILV(""I"")="""" Q"
DGRPC3,92,0," ..S FILV(""E"")="""""
DGRPC3,93,0," ;Otherwise, get MSE data from DGP(.32)"
DGRPC3,94,1," E  F MS=1:1:3 D  Q:$G(OUT)"
DGRPC3,95,2," .I MS=2,$P(DGP(.32),U,19)'=""Y"" S OUT=1 Q"
DGRPC3,96,1," .I MS=3,$P(DGP(.32),U,20)'=""Y"" S OUT=1 Q"
DGRPC3,97,1," .S BOS=$P(DGP(.32),U,(5*MS)),FV=$$FV^DGRPMS(BOS) I 'FV S NOTFV="""" Q"
DGRPC3,98,0," .S MSE=$S(MS=1:""MSL"",MS=2:""MSNTL"",1:""MSNNTL"")"
DGRPC3,99,0," .I '$$WWII^DGRPMS(DFN,"""",MSE) S FILV(""I"")="""" Q"
DGRPC3,100,0," .I FV=2 S FILV(""E"")="""" Q"
DGRPC3,101,0," .I $P(DGP(.321),U,14)=""""!($P(DGP(.321),U,14)=""NO"") S FILV(""I"")="""" Q"
DGRPC3,102,0," .S FILV(""E"")="""""
DGRPC3,103,1," I $D(FILV) D"
DGRPC3,104,0," .I DGVT'=1,$D(FILV(""E"")) S X=85 D COMB Q"
DGRPC3,105,0," .I DGCHK'[("",86,"") Q"
DGRPC3,106,0," .I DGVT=1,'$D(NOTFV),'$D(FILV(""E"")),$D(FILV(""I"")) S X=86 D COMB"
DGRPC3,107,1," S DGLST=86"
DGRPC3,108,1," D NEXT G @DGLST"
DGRPC3,109,0,"87       ; DG*5.3*657 BAJ 11/24/2005 CC #87 added"
DGRPC3,110,0," ; SC Eligibility but no rated Disability Codes"
DGRPC3,111,0," ; 1. Svc Connected is answered ""YES"""
DGRPC3,112,0," ; 2. Eligibility code is either SC < 50% or SC 50-100%"
DGRPC3,113,0," ; 3. Svc connected %-age is 0 or greater"
DGRPC3,114,0," ; 4. Patient has no rated disabilities"
DGRPC3,115,0," ; .. VAEL(1) $P 1 = Primary Eligibility Code  $p 2 = Primary Elig External Value"
DGRPC3,116,0," ; .. VAEL(3) $P 1 = SERVICE CONNECTED? $P 2 = SC %"
DGRPC3,117,0," ; .. Rated Disabilities : ^DPT(DFN,.372,0) $P 4 is number of records  '($P($G(^DPT(DFN,.372,0)),""^"",4)) is TRUE"
DGRPC3,118,0," ;"
DGRPC3,119,0," ; Get Eligibility info"
DGRPC3,120,1," D ELIG^VADPT"
DGRPC3,121,0," ;"
DGRPC3,122,0," ; If not svc connected, don't check"
DGRPC3,123,1," I '$G(VAEL(3)) D NEXT G @DGLST"
DGRPC3,124,0," ;"
DGRPC3,125,0," I +VAEL(3)=1!(+VAEL(3)=3) D"
DGRPC3,126,0," . Q:$P(VAEL(3),""^"",2)<0"
DGRPC3,127,0," . Q:$P(VAEL(3),""^"",2)="""""
DGRPC3,128,0," . I '($P($G(^DPT(DFN,.372,0)),""^"",4)) S X=87 D COMB"
DGRPC3,129,0," D NEXT G @DGLST"
DGRPC3,130,0," ;"
DGRPC3,131,0,"88       ;Temporary Address check"
DGRPC3,132,1," N STR88,J,DGI,DGERR,START,END"
DGRPC3,133,1," S DGERR=0"
DGRPC3,134,1," I $P(DGP(.121),U,9)=""Y"" D"
DGRPC3,135,0," . ;check only if current date is within effective range"
DGRPC3,136,0," . S START=$P(DGP(.121),U,7),END=$P(DGP(.121),U,8)"
DGRPC3,137,0," . Q:START=""""  I END="""" S END=9999999"
DGRPC3,138,0," . ; quit if current date is not within range"
DGRPC3,139,0," . I '(DT'<START&(DT'>END)) Q"
DGRPC3,140,0," . ; country is either NULL or non-numeric"
DGRPC3,141,0," . I '$P(DGP(.122),U,3) S DGERR=1 Q"
DGRPC3,142,0," . ; country is not in Country file"
DGRPC3,143,0," . I '$D(^HL(779.004,$P(DGP(.122),U,3))) S DGERR=1 Q"
DGRPC3,144,0," . S STR88=""1,4,5,6"" I $$FORIEN^DGADDUTL($P(DGP(.122),""^"",3)) S STR88=""1,4"""
DGRPC3,145,0," . F J=1:1:$L(STR88,"","") S DGI=$P(STR88,"","",J) Q:DGERR  I $P(DGP(.121),U,DGI)="""" S DGERR=1"
DGRPC3,146,1," I DGERR S X=88 D COMB"
DGRPC3,147,1," D NEXT G @DGLST"
DGRPC3,148,0,"99       ; synonymous with END"
DGRPC3,149,1,"END      I DGNCK S X=99 D COMB"
DGRPC3,150,1," D OVER99CK"
DGRPC3,151,1," I DGEDCN S DGCON=0 D TIME^DGRPC"
DGRPC3,152,1," K C,C1,C2,DGCD,DGD,DGD1,DGD2,DGDATE,DGDEP,DGCHK,DGFL,DGINC,DGISYR,DGLST,DGMS,DGNCK,DGP,DGPMSE,DGPTYP,DGREL,DGSCT,DGT,DGTIME,DGTOT,DGVT,I,I2,I2,J,VAIN,X,X1"
DGRPC3,153,1," G ^DGRPCF"
DGRPC3,154,0," ;"
DGRPC3,155,3,"COMB     S DGCT=DGCT+1,DGER=DGER_X_"","",DGLST=X Q"
DGRPC3,156,0," ;;"
DGRPC3,157,9,"NEXT     S I=$F(DGCHK,("",""_+DGLST_"","")),DGLST=+$E(DGCHK,I,999) S:'DGLST DGLST=""END"""
DGRPC3,158,9," Q"
DGRPC3,159,0," ;"
DGRPC3,160,1,"OVER99CK N DGP,DGSD,RULE,FILERR"
DGRPC3,161,1," D LOADPT^IVMZ07C(DFN,.DGP),LOADSD^IVMZ072(DFN,.DGSD)"
DGRPC3,162,1," F RULE=301,303,304,306:1:308 S DGLST=RULE_""^IVMZ7CD"" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB"
DGRPC3,163,1," F RULE=402,403,406,407 S DGLST=RULE_""^IVMZ7CE"" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB"
DGRPC3,164,1," F RULE=501:1:507,516,517 S DGLST=RULE_""^IVMZ7CS"" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB"
DGRPC3,165,1," F RULE=313 S DGLST=RULE_""^DGRPC3"" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB"
DGRPC3,166,1," F RULE=314 S DGLST=RULE_""^DGRPC3"" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB"
DGRPC3,167,1," F RULE=315 S DGLST=RULE_""^DGRPC3"" D @DGLST I $D(FILERR(RULE)) S X=RULE D COMB"
DGRPC3,168,1," S DGLST=""END"""
DGRPC3,169,1," Q"
DGRPC3,170,0," ;"
DGRPC3,171,0,"313 ; NEWBORN REQUIRES SPONSOR"
DGRPC3,172,1," N X"
DGRPC3,173,1," S DOB=$P(^DPT(DFN,0),""^"",3)"
DGRPC3,174,1," D NOW^%DTC"
DGRPC3,175,1," S NOW=X"
DGRPC3,176,1," I $$FMDIFF^XLFDT(NOW,DOB,1)>365 Q  ;NOT A NEWBORN"
DGRPC3,177,0," I $D(^IBA(355.81,""B"",DFN)) Q  ;already has a sponsor"
DGRPC3,178,0," S FILERR(RULE)="""""
DGRPC3,179,0," Q"
DGRPC3,180,0," ; "
DGRPC3,181,0,"314  ;NEWBORN SPONSOR MUST BE ELIGIBLE"
DGRPC3,182,1," I '$D(^IBA(355.81,""B"",DFN)) Q  ;Does not have a sponsor"
DGRPC3,183,0," N X"
DGRPC3,184,0," S DOB=$P(^DPT(DFN,0),""^"",3)"
DGRPC3,185,0," D NOW^%DTC"
DGRPC3,186,0," S NOW=X"
DGRPC3,187,0," I $$FMDIFF^XLFDT(NOW,DOB,1)>365 Q  ;NOT A NEWBORN"
DGRPC3,188,0," N RELIEN,SPNIEN,SPNDFN,ELIG"
DGRPC3,189,0," ;NEED TO FIND SPONSOR IN PATIENT FILE"
DGRPC3,190,0," S RELIEN="""",SPNIEN="""",SPNDFN="""",ELIG="""""
DGRPC3,191,0," S RELIEN=$O(^IBA(355.81,""B"",DFN,RELIEN))"
DGRPC3,192,0," S SPNIEN=$$GET1^DIQ(355.81,RELIEN,.02,""I"")"
DGRPC3,193,0," S SPNDFN=$$GET1^DIQ(355.8,SPNIEN,.01,""I"")"
DGRPC3,194,0," S SPNDFN=$P(SPNDFN,"";"",1)"
DGRPC3,195,0," S ELIG=$$GET1^DIQ(2,SPNDFN,.3611,""I"")"
DGRPC3,196,0," I ELIG'="""" Q  ;sponsor has an eligibility status"
DGRPC3,197,0," S FILERR(RULE)="""""
DGRPC3,198,0," Q"
DGRPC3,199,0," ;"
DGRPC3,200,0,"315  ; MHV"
DGRPC3,201,1," Q:'$G(DFN)!'$G(DGPRFLG)"
DGRPC3,202,1," N DGFLDCHK,DGMHVACT,DGMHVOUT,DGMHVQ,X,Y"
DGRPC3,203,1," Q:$$MHVOK^DGMHVAC(DFN) "
DGRPC3,204,0," ;S DGFLDCHK=$$GETEN^DGMHVUTL(DFN)"
DGRPC3,205,0," ;I DGFLDCHK'="""" S DGFLDCHK=$$GETAUTH^DGMHVUTL(DFN)"
DGRPC3,206,0," ;I DGFLDCHK'="""" S DGFLDCHK=$$GETMSG^DGMHVUTL(DFN)"
DGRPC3,207,0," ;Q:DGFLDCHK'="""""
DGRPC3,208,0," ; Quit if MHV ENROLLED has not been answered, and enrollment action is pending"
DGRPC3,209,1," S DGMHVACT=$$ENQACHK^DGMHVUTL(DFN) Q:(DGMHVACT]"""")&'$G(^DPT(DFN,2))"
DGRPC3,210,1," S DGMHVACT=$$ENTRYFLD^DGMHVUTL(DFN)"
DGRPC3,211,0," ;D MAIN^DGMHVAC(DFN,DGMHVACT,1)"
DGRPC3,212,1," S:'$$MHVOK^DGMHVAC(DFN) FILERR(315)="""""
DGRPC3,213,0," ;S FILERR(315)="""""
DGRPC3,214,1," Q"
Totals for DGRPC3,,99,
DGRPCE1,1,0,"DGRPCE1 ;ALB/MIR/BRM/LBD,BAJ,TDM - CONSISTENCY CHECKER EDIT ; 10/20/10 4:16pm"
DGRPCE1,2,2," ;;5.3;Registration;**108,226,470,454,489,505,522,451,632,689,657,688,804,754,797,903**;Aug 13, 1993;Build 53"
DGRPCE1,3,2," N DGMSERR S DGMSERR="""" I $$NEWMSE(DFN) S DGMSERR="",67,72,73,79,81,83,"""
DGRPCE1,4,2," N I,J F I=1:1:8,16,53,57,58,61:1:88 D SASK"
DGRPCE1,5,2," F I=301,303,304,306:1:308,315,402,403,406,407,501:1:507,516,517 D SASK"
DGRPCE1,6,0," ;F I=49,50,52 D SASK ;BELOW REPLACED WITH ^IBCNSP2 CALL"
DGRPCE1,7,0," ;OLDS DR(2,2.312)=""S DGRPADI="""""""";.01;1;2;15;8;7;3;6;S DGRPADI=X;I DGRPADI'=""""v"""" S Y=""""@2312"""";17///^S X=""""`""""_DFN;16///^S X=""""01"""";S Y=""""@23121"""";@2312;17;16//^S X=$S(DGRPADI=""""s"""":""""02"""",1:"""""""");@23121;9:14;"""
DGRPCE1,8,2," Q"
DGRPCE1,9,120,"SASK I DGER[("",""_I_"",""),DGASK'[("",""_I_"",""),DGMSERR'[("",""_I_"","") F J=I,I*1000:1 Q:'$T(@J)  S DGD=DGD_$P($T(@J),"";;"",2,999) D SAVE"
DGRPCE1,10,120," S DGASK=DGASK_I_"","""
DGRPCE1,11,120," Q"
DGRPCE1,12,5,"SAVE I $L(@DGDR)+$L(DGD)<241 S @DGDR=@DGDR_DGD,DGD="""" Q"
DGRPCE1,13,0," S DGDRC=DGDRC+1,DGDR=""DR(1,2,""_DGDRC_"")"",@DGDR=DGD,DGD="""" Q"
DGRPCE1,14,0," ;"
DGRPCE1,15,0," ;"
DGRPCE1,16,0,"ELIG ;eligibility code...if M11+, use compiled template, otherwise DR string"
DGRPCE1,17,1," I ^%ZOSF(""OS"")'[""M/11+"" S DGD=$P($T(14),"";;"",2,999) D SAVE Q"
DGRPCE1,18,0," N DA,DIE,DR S DIE=""^DPT("",DA=DFN,DR=""[DG CONSISTENCY CHECKER]"" D ^DIE"
DGRPCE1,19,0," Q"
DGRPCE1,20,0," ;"
DGRPCE1,21,0," ;"
DGRPCE1,22,0,"1 ;;.01;"
DGRPCE1,23,0,"2 ;;1;"
DGRPCE1,24,0,"3 ;;.02;"
DGRPCE1,25,0,"4 ;;.03;"
DGRPCE1,26,0,"5 ;;.05;"
DGRPCE1,27,0,"6 ;;.08;"
DGRPCE1,28,0,"7 ;;.09;"
DGRPCE1,29,0,"8 ;;N FLG S FLG(2)=1 S:$G(DGER)["",61,"" FLG(1)=1 D EN^DGREGAED(DFN,.FLG);"
DGRPCE1,30,0,"14 ;;.361;S DGECODE=$S($D(^DIC(8,+X,0)):$P(^(0),""^"",1),1:"""");S:$S(DGECODE[""ALLIED"":0,DGECODE[""FEDERAL"":0,1:1) Y=.323;.309;.323;D ^DGYZODS;S:'DGODS Y=""@14"";11500.02;11500.03;@14;"
DGRPCE1,31,0,"16 ;;.351;"
DGRPCE1,32,0,"53 ;;.07;.31115;I $S(X']"""":1,X=3:1,X=9:1,1:0) S Y=""@53"";.3111;S:X']"""" Y=""@53"";.3113;S:X']"""" Y=.3116;.3114;S:X']"""" Y=.3116;.3115:.3117;.2205;.3119;@53;"
DGRPCE1,33,0,"57 ;;.381;.382///NOW;"
DGRPCE1,34,0,"58 ;;.322013;S:X'=""Y"" Y=""@589"";.322014;.322015;.32201;S:X'=""Y"" Y=""@581"";.322011;.322012;@581;.322016;S:X'=""Y"" Y=""@589"";.322017;.322018;@589;"
DGRPCE1,35,0,"61 ;;S:$G(DGER)["",8,"" Y=""@619"";.132;@619;"
DGRPCE1,36,0,"62 ;;.331;"
DGRPCE1,37,0,"63 ;;D EN^DGREGTED(DFN,""CONF"");"
DGRPCE1,38,0,"64 ;;.092;.093;"
DGRPCE1,39,0,"65 ;;.2403;"
DGRPCE1,40,0,"66 ;;.09;"
DGRPCE1,41,0,"67 ;;S:$$DGERCK^DGRPCE1(""73^79^80^81^82"",.DGER) Y=""@67"";W !!,$C(7),""SERVICE SEPARATION DATE [LAST] must be a precise date to determine CV Elig"",!;.325;.32911;.326;.327;@67;"
DGRPCE1,42,0,"68 ;;S:$$DGERCK^DGRPCE1(""39^40"",.DGER) Y=""@68"";W !!,$C(7),""COMBAT TO DATE must be a precise date to determine CV Eligibility"",!;.5291;S:X'=""Y"" Y=""@68"";.5292;.5293;.5294;@68;"
DGRPCE1,43,0,"69 ;;S:$$DGERCK^DGRPCE1(""74^75^76"",.DGER) Y=""@69"";W !!,$C(7),""YUGOSLAVIA TO DATE must be a precise date to determine CV Eligibility"",!;.322019;S:X'=""Y"" Y=""@69"";.32202;.322021;@69;"
DGRPCE1,44,0,"70 ;;S:$$DGERCK^DGRPCE1(""74^75^76"",.DGER) Y=""@70"";W !!,$C(7),""SOMALIA TO DATE must be a precise date to determine CV Eligibility"",!;.322016;S:X'=""Y"" Y=""@70"";.322017;.322018,@70;"
DGRPCE1,45,0,"71 ;;S:$$DGERCK^DGRPCE1(""74^75^76"",.DGER) Y=""@71"";W !!,$C(7),""PERSIAN GULF TO DATE must be a precise date to determine CV Eligibility"",!;.32201;S:X'=""Y"" Y=""@71"";.322011;.322012;@71;"
DGRPCE1,46,0,"72 ;;.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y=""@7201"";.3291;.32912;.3292;.3293;.329;@7201;S:'$$YN^DGRPCE1(.32945) Y=""@7202"";.3296;.32913;.3297;.3298;.3295;@7202;"
DGRPCE1,47,0," ;"
DGRPCE1,48,0,"73 ;;S:$$DGERCK^DGRPCE1(72,.DGER) Y=""@7302"";.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y=""@7301"";.3291;.32912;.3292;.3293;.329;@7301;S:'$$YN^DGRPCE1(.32945) Y=""@7302"";.3296;.32913;.3297;.3298;.3295;@7302;"
DGRPCE1,49,0,"74 ;;S:'$$YN^DGRPCE1(.32101) Y=""@7401"";.32101;S:X'=""Y"" Y=""@7401"";.32104;.32105;@7401;S:'$$YN^DGRPCE1(.322016) Y=""@7402"";.322016;S:X'=""Y"" Y=""@7402"";.322017;.322018;@7402;"
DGRPCE1,50,0,"74000 ;;S:'$$YN^DGRPCE1(.322019) Y=""@7403"";.322019;S:X'=""Y"" Y=""@7403"";.32202;.322021;@7403;S:'$$YN^DGRPCE1(.3221) Y=""@7404"";.3221;S:X'=""Y"" Y=""@7404"";.3222;.3223;@7404;"
DGRPCE1,51,0,"74001 ;;S:'$$YN^DGRPCE1(.3224) Y=""@7405"";.3224;S:X'=""Y"" Y=""@7405"";.3225;.3226;@7405;S:'$$YN^DGRPCE1(.3227) Y=""@7406"";.3227;S:X'=""Y"" Y=""@7406"";.3228;.3229;@7406;"
DGRPCE1,52,0,"74002 ;;S:'$$YN^DGRPCE1(.32201) Y=""@7407"";.32201;S:X'=""Y"" Y=""@7407"";.322011;.322012;@7407;"
DGRPCE1,53,0,"75 ;;S:$$DGERCK^DGRPCE1(74,.DGER) Y=""@7507"";S:'$$YN^DGRPCE1(.32101) Y=""@7501"";.32101;S:X'=""Y"" Y=""@7501"";.32104;.32105;@7501;S:'$$YN^DGRPCE1(.322016) Y=""@7502"";.322016;S:X'=""Y"" Y=""@7502"";.322017;.322018;@7502;"
DGRPCE1,54,0,"75000 ;;S:'$$YN^DGRPCE1(.322019) Y=""@7503"";.322019;S:X'=""Y"" Y=""@7503"";.32202;.322021;@7503;S:'$$YN^DGRPCE1(.3221) Y=""@7504"";.3221;S:X'=""Y"" Y=""@7504"";.3222;.3223;@7504;"
DGRPCE1,55,0,"75001 ;;S:'$$YN^DGRPCE1(.3224) Y=""@7505"";.3224;S:X'=""Y"" Y=""@7505"";.3225;.3226;@7505;S:'$$YN^DGRPCE1(.3227) Y=""@7506"";.3227;S:X'=""Y"" Y=""@7506"";.3228;.3229;@7506;"
DGRPCE1,56,0,"75002 ;;S:'$$YN^DGRPCE1(.32201) Y=""@7507"";.32201;S:X'=""Y"" Y=""@7507"";.322011;.322012;@7507;"
DGRPCE1,57,0,"76 ;;S:$$DGERCK^DGRPCE1(""74^75"",.DGER) Y=""@7607"";S:'$$YN^DGRPCE1(.32101) Y=""@7601"";.32101;S:X'=""Y"" Y=""@7601"";.32104;.32105;@7601;S:'$$YN^DGRPCE1(.322016) Y=""@7602"";.322016;S:X'=""Y"" Y=""@7602"";.322017;.322018;@7602;"
DGRPCE1,58,0,"76000 ;;S:'$$YN^DGRPCE1(.322019) Y=""@7603"";.322019;S:X'=""Y"" Y=""@7603"";.32202;.322021;@7603;S:'$$YN^DGRPCE1(.3221) Y=""@7604"";.3221;S:X'=""Y"" Y=""@7604"";.3222;.3223;@7604;"
DGRPCE1,59,0,"76001 ;;S:'$$YN^DGRPCE1(.3224) Y=""@7605"";.3224;S:X'=""Y"" Y=""@7605"";.3225;.3226;@7605;S:'$$YN^DGRPCE1(.3227) Y=""@7606"";.3227;S:X'=""Y"" Y=""@7606"";.3228;.3229;@7606;"
DGRPCE1,60,0,"76002 ;;S:'$$YN^DGRPCE1(.32201) Y=""@7607"";.32201;S:X'=""Y"" Y=""@7607"";.322011;.322012;@7607;"
DGRPCE1,61,0,"77 ;;S:(($$DGERCK^DGRPCE1(""37^38"",.DGER))!('$$YN^DGRPCE1(.525))) Y=""@77"";.525;S:X'=""Y"" Y=""@77"";.526;.527;.528;@77;"
DGRPCE1,62,0,"78 ;;S:(($$DGERCK^DGRPCE1(""39^40^68"",.DGER))!('$$YN^DGRPCE1(.5291))) Y=""@78"";.5291;S:X'=""Y"" Y=""@78"";.5292;.5293;.5294;@78;"
DGRPCE1,63,0,"79 ;;S:$$DGERCK^DGRPCE1(""72^73"",.DGER) Y=""@7902"";.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y=""@7901"";.3291;.32912;.3292;.3293;.329;@7901;S:'$$YN^DGRPCE1(.32945) Y=""@7902"";.3296;.32913;.3297;.3298;.3295;@7902;"
DGRPCE1,64,0,"80 ;;S:(($$DGERCK^DGRPCE1(""37^38^77"",.DGER))!('$$YN^DGRPCE1(.525))) Y=""@8001"";.525;S:X'=""Y"" Y=""@8001"";.526;.527;.528;@8001;S:$$DGERCK^DGRPCE1(""72^73^79"",.DGER) Y=""@8003"";"
DGRPCE1,65,0,"80000 ;;.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y=""@8002"";.3291;.32912;.3292;.3293;.329;@8002;S:'$$YN^DGRPCE1(.32945) Y=""@8003"";.3296;.32913;.3297;.3298;.3295;@8003;"
DGRPCE1,66,0,"81 ;;S:(($$DGERCK^DGRPCE1(""39^40^78"",.DGER))!('$$YN^DGRPCE1(.5291))) Y=""@8101"";.5291;S:X'=""Y"" Y=""@8101"";.5292;.5293;.5294;@8101;S:$$DGERCK^DGRPCE1(""72^73^79^80"",.DGER) Y=""@8103"";"
DGRPCE1,67,0,"81000 ;;.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y=""@8102"";.3291;.32912;.3292;.3293;.329;@8102;S:'$$YN^DGRPCE1(.32945) Y=""@8103"";.3296;.32913;.3297;.3298;.3295;@8103;"
DGRPCE1,68,0,"82 ;;S:($$DGERCK^DGRPCE1(""74^75^76"",.DGER)) Y=""@8207"";S:'$$YN^DGRPCE1(.32101) Y=""@8201"";.32101;S:X'=""Y"" Y=""@8201"";.32104;.32105;@8201;S:'$$YN^DGRPCE1(.322016) Y=""@8202"";.322016;"
DGRPCE1,69,0,"82000 ;;S:X'=""Y"" Y=""@8202"";.322017;.322018;@8202;S:'$$YN^DGRPCE1(.322019) Y=""@8203"";.322019;S:X'=""Y"" Y=""@8203"";.32202;.322021;@8203;S:'$$YN^DGRPCE1(.3221) Y=""@8204"";.3221;"
DGRPCE1,70,0,"82001 ;;S:X'=""Y"" Y=""@8204"";.3222;.3223;@8204;S:'$$YN^DGRPCE1(.3224) Y=""@8205"";.3224;S:X'=""Y"" Y=""@8205"";.3225;.3226;@8205;S:'$$YN^DGRPCE1(.3227) Y=""@8206"";.3227;S:X'=""Y"" Y=""@8206"";"
DGRPCE1,71,0,"82002 ;;.3228;.3229;@8206;S:'$$YN^DGRPCE1(.32201) Y=""@8207"";.32201;S:X'=""Y"" Y=""@8207"";.322011;.322012;@8207;S:($$DGERCK^DGRPCE1(""72^73^79^80^81"",.DGER)) Y=""@8209"";"
DGRPCE1,72,0,"82003 ;;S:$$NEWMSE^DGRPCE1(DFN) Y=""@8209"";.325;.32911;.326;.327;.324;S:'$$YN^DGRPCE1(.3285) Y=""@8208"";.3291;.32912;.3292;.3293;.329;@8208;S:'$$YN^DGRPCE1(.32945) Y=""@8209"";.3296;.32913;.3297;.3298;.3295;@8209;"
DGRPCE1,73,0,"83 ;;S:$$DGERCK^DGRPCE1(73,.DGER) Y=""@83"";@8295;D SET32^DGRPE(DA,.DIPA,1);.325;S DIPA(""X1"")=X S:X']"""" Y=""@83"";S:$$FV^DGRPMS(X)'=1 Y=""@8296"";.3214;I X']"""" W !?4,$C(7),""Proof is required for Filipino Vet."" S Y=""@8295"";"
DGRPCE1,74,0,"83000 ;;@8296;D:DIPA(""X1"")'="""" WARN32^DGRPE(DIPA(""X1""),.DIPA,1,.Y) S:$E(Y,1,4)=""@601"" Y=.326;.32911;.326;.327;"
DGRPCE1,75,0,"83001 ;;.3285//NO;S:X'=""Y"" Y=""@83"";D SET32^DGRPE(DA,.DIPA,2);.3291;S DIPA(""X2"")=X S:X']"""" Y=""@83"";S:$$FV^DGRPMS(X)'=1 Y=""@832"";.3214;I X']"""" W !?4,$C(7),""Proof is required for Filipino Vet."" S Y="".3291"";S Y=.3292;"
DGRPCE1,76,0,"83002 ;;@832;D:DIPA(""X2"")'="""" WARN32^DGRPE(DIPA(""X2""),.DIPA,2,.Y) S:$E(Y,1,4)=""@601"" Y=.3292;.32912;.3292;.3293;"
DGRPCE1,77,0,"83003 ;;.32945//NO;S:X'=""Y"" Y=""@83"";D SET32^DGRPE(DA,.DIPA,3);.3296;S DIPA(""X3"")=X S:X']"""" Y=""@83"";S:$$FV^DGRPMS(X)'=1 Y=""@833"";.3214;I X']"""" W !?4,$C(7),""Proof is required for Filipino Vet."" S Y="".3296"";S Y=.3297;@833;"
DGRPCE1,78,0,"83004 ;;D:DIPA(""X3"")'="""" WARN32^DGRPE(DIPA(""X3""),.DIPA,3,.Y) S:$E(Y,1,4)=""@601"" Y=.3297;.32913;.3297;.3298;@83;"
DGRPCE1,79,0,"84 ;;.3214;"
DGRPCE1,80,0,"85 ;;1901;"
DGRPCE1,81,0,"86 ;;1901;"
DGRPCE1,82,0,"87 ;;D VETTYPE^DGRPE1;D MSG^DGRPE1 S Y=0;@114;K DGRDCHG;D DR^DGRPE1;.302;.3721;D EFF^DGRPE1;D:$G(DGRDCHG) BULL^DGRPE1;K DGRDCHG;"
DGRPCE1,83,0,"88 ;;D EN^DGREGTED(DFN,""TEMP"");"
DGRPCE1,84,0,"301 ;;.01;"
DGRPCE1,85,0,"303 ;;.02;"
DGRPCE1,86,0,"304 ;;.02;"
DGRPCE1,87,0,"306 ;;.09;"
DGRPCE1,88,0,"307 ;;.0906;"
DGRPCE1,89,0,"308 ;;.351;"
DGRPCE1,90,0,"315 ;;D MHVPCHK^DGMHVUTL(DFN);"
DGRPCE1,91,0,"402 ;;.381;"
DGRPCE1,92,0,"403 ;;.382;"
DGRPCE1,93,0,"406 ;;.313;"
DGRPCE1,94,0,"407 ;;.3611;"
DGRPCE1,95,0,"501 ;;.525;"
DGRPCE1,96,0,"502 ;;.3602;"
DGRPCE1,97,0,"503 ;;.3603;"
DGRPCE1,98,0,"504 ;;.32102;"
DGRPCE1,99,0,"505 ;;.32103;"
DGRPCE1,100,0,"506 ;;.322013;"
DGRPCE1,101,0,"507 ;;.32103;.3212;"
DGRPCE1,102,0,"516 ;;.03;"
DGRPCE1,103,0,"517 ;;.03;"
DGRPCE1,104,0," ;"
DGRPCE1,105,0,"YN(FLD,DFN,FILE) ; return binary for YES/NO flds in the Patient (#2) file"
DGRPCE1,106,0," N RTN"
DGRPCE1,107,0," Q:$G(FLD)']"""" """""
DGRPCE1,108,0," S:$G(FILE)="""" FILE=2 S:$G(DFN)="""" DFN=$G(DA) Q:$G(DFN)']"""" """""
DGRPCE1,109,0," S RTN=$$GET1^DIQ(FILE,DFN_"","",FLD,""I"")"
DGRPCE1,110,0," Q $S(RTN=1:1,RTN=0:0,RTN=""Y"":1,RTN=""N"":0,1:"""")"
DGRPCE1,111,0," ;"
DGRPCE1,112,0,"DGERCK(STR,DGER) ;do any of the STR errors exist in DGER?"
DGRPCE1,113,0," N RTN,X"
DGRPCE1,114,0," Q:$G(STR)']"""" 0  Q:$G(DGER)']"""" 0"
DGRPCE1,115,0," S RTN=0 F X=1:1 Q:RTN!($P(STR,""^"",X)="""")  I DGER[("",""_$P(STR,""^"",X)_"","") S RTN=1"
DGRPCE1,116,0," Q RTN"
DGRPCE1,117,0," ;"
DGRPCE1,118,2,"NEWMSE(DFN) ;Is there data in the new MSE sub-file #2.3216?"
DGRPCE1,119,2," I $G(DFN)="""" S DFN=$G(DA)"
DGRPCE1,120,2," Q:$G(DFN)="""" 0"
DGRPCE1,121,2," I $O(^DPT(DFN,.3216,0)) Q 1"
DGRPCE1,122,2," Q 0"
DGRPCE1,123,0," ;"
DGRPCE1,124,0,"MSERR() ;Are there MSE data inconsistencies?"
DGRPCE1,125,1," N ERR,RTN"
DGRPCE1,126,1," S RTN=0"
DGRPCE1,127,1," F ERR=67,72,73,79,81,82,83 I DGER[ERR S RTN=1"
DGRPCE1,128,1," Q RTN"
Totals for DGRPCE1,,390,